var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n)),l=o((exports=>{var t=exports,n=/`/g,r=/\./g,i=/[\0\b\t\n\r\x1a\"\'\\]/g,a={"\0":`\\0`,"\b":`\\b`,"	":`\\t`,"\n":`\\n`,"\r":`\\r`,"":`\\Z`,'"':`\\"`,"'":`\\'`,"\\":`\\\\`};t.escapeId=function(e,i){if(Array.isArray(e)){for(var a=``,o=0;o<e.length;o++)a+=(o===0?``:`, `)+t.escapeId(e[o],i);return a}else if(i)return"`"+String(e).replace(n,"``")+"`";else return"`"+String(e).replace(n,"``").replace(r,"`.`")+"`"},t.escape=function(e,n,r){if(e==null)return`NULL`;switch(typeof e){case`boolean`:return e?`true`:`false`;case`number`:return e+``;case`object`:return Object.prototype.toString.call(e)===`[object Date]`?t.dateToString(e,r||`local`):Array.isArray(e)?t.arrayToList(e,r):Buffer.isBuffer(e)?t.bufferToString(e):typeof e.toSqlString==`function`?String(e.toSqlString()):n?o(e.toString()):t.objectToValues(e,r);default:return o(e)}},t.arrayToList=function(e,n){for(var r=``,i=0;i<e.length;i++){var a=e[i];Array.isArray(a)?r+=(i===0?``:`, `)+`(`+t.arrayToList(a,n)+`)`:r+=(i===0?``:`, `)+t.escape(a,!0,n)}return r},t.format=function(e,n,r,i){if(n==null)return e;Array.isArray(n)||(n=[n]);for(var a=0,o=/\?+/g,s=``,c=0,l;c<n.length&&(l=o.exec(e));){var u=l[0].length;if(!(u>2)){var d=u===2?t.escapeId(n[c]):t.escape(n[c],r,i);s+=e.slice(a,l.index)+d,a=o.lastIndex,c++}}return a===0?e:a<e.length?s+e.slice(a):s},t.dateToString=function(e,t){var n=new Date(e);if(isNaN(n.getTime()))return`NULL`;var r,i,a,l,u,d,f;if(t===`local`)r=n.getFullYear(),i=n.getMonth()+1,a=n.getDate(),l=n.getHours(),u=n.getMinutes(),d=n.getSeconds(),f=n.getMilliseconds();else{var p=c(t);p!==!1&&p!==0&&n.setTime(n.getTime()+p*6e4),r=n.getUTCFullYear(),i=n.getUTCMonth()+1,a=n.getUTCDate(),l=n.getUTCHours(),u=n.getUTCMinutes(),d=n.getUTCSeconds(),f=n.getUTCMilliseconds()}var m=s(r,4)+`-`+s(i,2)+`-`+s(a,2)+` `+s(l,2)+`:`+s(u,2)+`:`+s(d,2)+`.`+s(f,3);return o(m)},t.bufferToString=function(e){return`X`+o(e.toString(`hex`))},t.objectToValues=function(e,n){var r=``;for(var i in e){var a=e[i];if(typeof a==`function`)continue;r+=(r.length===0?``:`, `)+t.escapeId(i)+` = `+t.escape(a,!0,n)}return r},t.raw=function(e){if(typeof e!=`string`)throw TypeError(`argument sql must be a string`);return{toSqlString:function(){return e}}};function o(e){for(var t=i.lastIndex=0,n=``,r;r=i.exec(e);)n+=e.slice(t,r.index)+a[r[0]],t=i.lastIndex;return t===0?`'`+e+`'`:t<e.length?`'`+n+e.slice(t)+`'`:`'`+n+`'`}function s(e,t){for(e=e.toString();e.length<t;)e=`0`+e;return e}function c(e){if(e===`Z`)return 0;var t=e.match(/([\+\-\s])(\d\d):?(\d\d)?/);return t?(t[1]===`-`?-1:1)*(parseInt(t[2],10)+(t[3]?parseInt(t[3],10):0)/60)*60:!1}})),u=c(o(((exports,t)=>{t.exports=l()}))(),1);const d=async({newRecord:e,client:t})=>{let n=await t.execOne(u.default.format(`select * from User where id = ?`,[e.id]));console.log(`New user created: ${n.name} (${n.email})`)},f=async e=>{let t=e?new tailordb.Client({namespace:e}):{connect:()=>{},end:()=>{}};await t.connect();let n={async exec(e,n){return(await t.queryObject(e,n??[])).rows},async execOne(e,n){return(await t.queryObject(e,n??[])).rows[0]}};return{...n,async transaction(e){try{await n.exec(`BEGIN`);let t=await e(n);return await n.exec(`COMMIT`),t}catch(e){console.error(`Transaction failed:`,e);try{await n.exec(`ROLLBACK`)}catch(e){console.error(`Failed to rollback transaction:`,e)}}},async end(){try{await t.end()}catch(e){console.error(`Error ending connection:`,e)}}}};globalThis.main=await(async(e,t)=>async n=>{let r=await f(e);try{return await t({...n,client:r})}finally{await r.end()}})(`tailordb`,d);
//# sourceMappingURL=user-created.js.map