{"version":3,"file":"user-created.js","names":["e"],"sources":["user-created.transformed.js","../executor_steps/user-created.js"],"sourcesContent":["//#region constants.ts\nconst defaultMachineUserRole = \"4293a799-4398-55e6-a19a-fe8427d1a415\";\n\n//#endregion\n//#region tailordb/permissions.ts\nconst defaultMachineUser = [\n\t{ user: \"roleId\" },\n\t\"=\",\n\tdefaultMachineUserRole\n];\nconst loggedIn = [\n\t{ user: \"_loggedIn\" },\n\t\"=\",\n\ttrue\n];\nconst defaultPermission = {\n\tcreate: [defaultMachineUser],\n\tread: [defaultMachineUser, loggedIn],\n\tupdate: [defaultMachineUser],\n\tdelete: [defaultMachineUser]\n};\nconst defaultGqlPermission = [{\n\tconditions: [defaultMachineUser],\n\tactions: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\",\n\t\t\"aggregate\",\n\t\t\"bulkUpsert\"\n\t],\n\tpermit: true\n}, {\n\tconditions: [loggedIn],\n\tactions: [\"read\"],\n\tpermit: true\n}];\n\n//#endregion\n//#region tailordb/role.ts\n\n//#endregion\n//#region tailordb/user.ts\n\n//#endregion\n//#region executors/userRecordLog.ts\nvar userRecordLog_default = async ({ newRecord, client }) => {\n\tconst record = await client.execOne(`select * from User where id = ?`, [newRecord.id]);\n\tconsole.log(`New user created: ${record.name} (${record.email})`);\n};\n\n//#endregion\n//#region executors/userCreated.ts\n\n//#endregion\n\n// Export the executor function\nexport const __executor_function = async (args) => {\n\t\tawait userRecordLog_default(args);\n\t};","import { __executor_function } from \"../executors/user-created.transformed.js\";\n\nconst $connect_tailordb = async (namespace) => {\n  const baseClient = namespace ? new tailordb.Client({ namespace }) : { connect: () => {}, end: () => {} };\n  await baseClient.connect();\n\n  const client = {\n    async exec(query, params) {\n      const result = await baseClient.queryObject(query, params ?? []);\n      return result.rows;\n    },\n    async execOne(query, params) {\n      const result = await baseClient.queryObject(query, params ?? []);\n      return result.rows[0];\n    },\n  };\n  return {\n    ...client,\n    async transaction(callback) {\n      try {\n        await client.exec(\"BEGIN\");\n        const result = await callback(client);\n        await client.exec(\"COMMIT\");\n        return result;\n      } catch (e) {\n        console.error(\"Transaction failed:\", e);\n        try {\n          await client.exec(\"ROLLBACK\");\n        } catch (e) {\n          console.error(\"Failed to rollback transaction:\", e);\n        }\n      }\n    },\n    async end() {\n      try {\n        await baseClient.end();\n      } catch (e) {\n        console.error(\"Error ending connection:\", e);\n      }\n    }\n  };\n};\n\nconst $tailor_db_wrapper = async (namespace, fn) => {\n  return async (args) => {\n    const client = await $connect_tailordb(namespace);\n    try {\n      return await fn({ ...args, client });\n    } finally {\n      await client.end();\n    }\n  };\n};\nglobalThis.main = await $tailor_db_wrapper(\"tailordb\", __executor_function);"],"mappings":"AA8CA,IAAI,EAAwB,MAAO,CAAE,YAAW,YAAa,CAC5D,IAAM,EAAS,MAAM,EAAO,QAAQ,kCAAmC,CAAC,EAAU,GAAG,CAAC,CACtF,QAAQ,IAAI,qBAAqB,EAAO,KAAK,IAAI,EAAO,MAAM,GAAG,EASlE,MAAa,EAAsB,KAAO,IAAS,CACjD,MAAM,EAAsB,EAAK,ECxD7B,EAAoB,KAAO,IAAc,CAC7C,IAAM,EAAa,EAAY,IAAI,SAAS,OAAO,CAAE,YAAW,CAAC,CAAG,CAAE,YAAe,GAAI,QAAW,GAAI,CACxG,MAAM,EAAW,SAAS,CAE1B,IAAM,EAAS,CACb,MAAM,KAAK,EAAO,EAAQ,CAExB,OADe,MAAM,EAAW,YAAY,EAAO,GAAU,EAAE,CAAC,EAClD,MAEhB,MAAM,QAAQ,EAAO,EAAQ,CAE3B,OADe,MAAM,EAAW,YAAY,EAAO,GAAU,EAAE,CAAC,EAClD,KAAK,IAEtB,CACD,MAAO,CACL,GAAG,EACH,MAAM,YAAY,EAAU,CAC1B,GAAI,CACF,MAAM,EAAO,KAAK,QAAQ,CAC1B,IAAM,EAAS,MAAM,EAAS,EAAO,CAErC,OADA,MAAM,EAAO,KAAK,SAAS,CACpB,QACA,EAAG,CACV,QAAQ,MAAM,sBAAuB,EAAE,CACvC,GAAI,CACF,MAAM,EAAO,KAAK,WAAW,OACtBA,EAAG,CACV,QAAQ,MAAM,kCAAmCA,EAAE,IAIzD,MAAM,KAAM,CACV,GAAI,CACF,MAAM,EAAW,KAAK,OACf,EAAG,CACV,QAAQ,MAAM,2BAA4B,EAAE,GAGjD,EAaH,WAAW,KAAO,MAVS,MAAO,EAAW,IACpC,KAAO,IAAS,CACrB,IAAM,EAAS,MAAM,EAAkB,EAAU,CACjD,GAAI,CACF,OAAO,MAAM,EAAG,CAAE,GAAG,EAAM,SAAQ,CAAC,QAC5B,CACR,MAAM,EAAO,KAAK,IAImB,WAAY,EAAoB"}