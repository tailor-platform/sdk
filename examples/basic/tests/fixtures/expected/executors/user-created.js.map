{"version":3,"file":"user-created.js","names":["sql","sql","e"],"sources":["../../../../../../node_modules/sqlstring/lib/SqlString.js","../../../../../../node_modules/sqlstring/index.js","user-created.transformed.js","../executor_steps/user-created.js"],"sourcesContent":["var SqlString  = exports;\n\nvar ID_GLOBAL_REGEXP    = /`/g;\nvar QUAL_GLOBAL_REGEXP  = /\\./g;\nvar CHARS_GLOBAL_REGEXP = /[\\0\\b\\t\\n\\r\\x1a\\\"\\'\\\\]/g; // eslint-disable-line no-control-regex\nvar CHARS_ESCAPE_MAP    = {\n  '\\0'   : '\\\\0',\n  '\\b'   : '\\\\b',\n  '\\t'   : '\\\\t',\n  '\\n'   : '\\\\n',\n  '\\r'   : '\\\\r',\n  '\\x1a' : '\\\\Z',\n  '\"'    : '\\\\\"',\n  '\\''   : '\\\\\\'',\n  '\\\\'   : '\\\\\\\\'\n};\n\nSqlString.escapeId = function escapeId(val, forbidQualified) {\n  if (Array.isArray(val)) {\n    var sql = '';\n\n    for (var i = 0; i < val.length; i++) {\n      sql += (i === 0 ? '' : ', ') + SqlString.escapeId(val[i], forbidQualified);\n    }\n\n    return sql;\n  } else if (forbidQualified) {\n    return '`' + String(val).replace(ID_GLOBAL_REGEXP, '``') + '`';\n  } else {\n    return '`' + String(val).replace(ID_GLOBAL_REGEXP, '``').replace(QUAL_GLOBAL_REGEXP, '`.`') + '`';\n  }\n};\n\nSqlString.escape = function escape(val, stringifyObjects, timeZone) {\n  if (val === undefined || val === null) {\n    return 'NULL';\n  }\n\n  switch (typeof val) {\n    case 'boolean': return (val) ? 'true' : 'false';\n    case 'number': return val + '';\n    case 'object':\n      if (Object.prototype.toString.call(val) === '[object Date]') {\n        return SqlString.dateToString(val, timeZone || 'local');\n      } else if (Array.isArray(val)) {\n        return SqlString.arrayToList(val, timeZone);\n      } else if (Buffer.isBuffer(val)) {\n        return SqlString.bufferToString(val);\n      } else if (typeof val.toSqlString === 'function') {\n        return String(val.toSqlString());\n      } else if (stringifyObjects) {\n        return escapeString(val.toString());\n      } else {\n        return SqlString.objectToValues(val, timeZone);\n      }\n    default: return escapeString(val);\n  }\n};\n\nSqlString.arrayToList = function arrayToList(array, timeZone) {\n  var sql = '';\n\n  for (var i = 0; i < array.length; i++) {\n    var val = array[i];\n\n    if (Array.isArray(val)) {\n      sql += (i === 0 ? '' : ', ') + '(' + SqlString.arrayToList(val, timeZone) + ')';\n    } else {\n      sql += (i === 0 ? '' : ', ') + SqlString.escape(val, true, timeZone);\n    }\n  }\n\n  return sql;\n};\n\nSqlString.format = function format(sql, values, stringifyObjects, timeZone) {\n  if (values == null) {\n    return sql;\n  }\n\n  if (!Array.isArray(values)) {\n    values = [values];\n  }\n\n  var chunkIndex        = 0;\n  var placeholdersRegex = /\\?+/g;\n  var result            = '';\n  var valuesIndex       = 0;\n  var match;\n\n  while (valuesIndex < values.length && (match = placeholdersRegex.exec(sql))) {\n    var len = match[0].length;\n\n    if (len > 2) {\n      continue;\n    }\n\n    var value = len === 2\n      ? SqlString.escapeId(values[valuesIndex])\n      : SqlString.escape(values[valuesIndex], stringifyObjects, timeZone);\n\n    result += sql.slice(chunkIndex, match.index) + value;\n    chunkIndex = placeholdersRegex.lastIndex;\n    valuesIndex++;\n  }\n\n  if (chunkIndex === 0) {\n    // Nothing was replaced\n    return sql;\n  }\n\n  if (chunkIndex < sql.length) {\n    return result + sql.slice(chunkIndex);\n  }\n\n  return result;\n};\n\nSqlString.dateToString = function dateToString(date, timeZone) {\n  var dt = new Date(date);\n\n  if (isNaN(dt.getTime())) {\n    return 'NULL';\n  }\n\n  var year;\n  var month;\n  var day;\n  var hour;\n  var minute;\n  var second;\n  var millisecond;\n\n  if (timeZone === 'local') {\n    year        = dt.getFullYear();\n    month       = dt.getMonth() + 1;\n    day         = dt.getDate();\n    hour        = dt.getHours();\n    minute      = dt.getMinutes();\n    second      = dt.getSeconds();\n    millisecond = dt.getMilliseconds();\n  } else {\n    var tz = convertTimezone(timeZone);\n\n    if (tz !== false && tz !== 0) {\n      dt.setTime(dt.getTime() + (tz * 60000));\n    }\n\n    year       = dt.getUTCFullYear();\n    month       = dt.getUTCMonth() + 1;\n    day         = dt.getUTCDate();\n    hour        = dt.getUTCHours();\n    minute      = dt.getUTCMinutes();\n    second      = dt.getUTCSeconds();\n    millisecond = dt.getUTCMilliseconds();\n  }\n\n  // YYYY-MM-DD HH:mm:ss.mmm\n  var str = zeroPad(year, 4) + '-' + zeroPad(month, 2) + '-' + zeroPad(day, 2) + ' ' +\n    zeroPad(hour, 2) + ':' + zeroPad(minute, 2) + ':' + zeroPad(second, 2) + '.' +\n    zeroPad(millisecond, 3);\n\n  return escapeString(str);\n};\n\nSqlString.bufferToString = function bufferToString(buffer) {\n  return 'X' + escapeString(buffer.toString('hex'));\n};\n\nSqlString.objectToValues = function objectToValues(object, timeZone) {\n  var sql = '';\n\n  for (var key in object) {\n    var val = object[key];\n\n    if (typeof val === 'function') {\n      continue;\n    }\n\n    sql += (sql.length === 0 ? '' : ', ') + SqlString.escapeId(key) + ' = ' + SqlString.escape(val, true, timeZone);\n  }\n\n  return sql;\n};\n\nSqlString.raw = function raw(sql) {\n  if (typeof sql !== 'string') {\n    throw new TypeError('argument sql must be a string');\n  }\n\n  return {\n    toSqlString: function toSqlString() { return sql; }\n  };\n};\n\nfunction escapeString(val) {\n  var chunkIndex = CHARS_GLOBAL_REGEXP.lastIndex = 0;\n  var escapedVal = '';\n  var match;\n\n  while ((match = CHARS_GLOBAL_REGEXP.exec(val))) {\n    escapedVal += val.slice(chunkIndex, match.index) + CHARS_ESCAPE_MAP[match[0]];\n    chunkIndex = CHARS_GLOBAL_REGEXP.lastIndex;\n  }\n\n  if (chunkIndex === 0) {\n    // Nothing was escaped\n    return \"'\" + val + \"'\";\n  }\n\n  if (chunkIndex < val.length) {\n    return \"'\" + escapedVal + val.slice(chunkIndex) + \"'\";\n  }\n\n  return \"'\" + escapedVal + \"'\";\n}\n\nfunction zeroPad(number, length) {\n  number = number.toString();\n  while (number.length < length) {\n    number = '0' + number;\n  }\n\n  return number;\n}\n\nfunction convertTimezone(tz) {\n  if (tz === 'Z') {\n    return 0;\n  }\n\n  var m = tz.match(/([\\+\\-\\s])(\\d\\d):?(\\d\\d)?/);\n  if (m) {\n    return (m[1] === '-' ? -1 : 1) * (parseInt(m[2], 10) + ((m[3] ? parseInt(m[3], 10) : 0) / 60)) * 60;\n  }\n  return false;\n}\n","module.exports = require('./lib/SqlString');\n","import sql from \"/Users/kiichi_isobe/ghq/github.com/tailor-platform/tailor-sdk/node_modules/sqlstring/index.js\";\n\n//#region constants.ts\nconst defaultMachineUserRole = \"4293a799-4398-55e6-a19a-fe8427d1a415\";\n\n//#endregion\n//#region tailordb/permissions.ts\nconst defaultMachineUser = [\n\t{ user: \"roleId\" },\n\t\"=\",\n\tdefaultMachineUserRole\n];\nconst loggedIn = [\n\t{ user: \"_loggedIn\" },\n\t\"=\",\n\ttrue\n];\nconst defaultPermission = {\n\tcreate: [defaultMachineUser],\n\tread: [defaultMachineUser, loggedIn],\n\tupdate: [defaultMachineUser],\n\tdelete: [defaultMachineUser]\n};\nconst defaultGqlPermission = [{\n\tconditions: [defaultMachineUser],\n\tactions: [\n\t\t\"create\",\n\t\t\"read\",\n\t\t\"update\",\n\t\t\"delete\",\n\t\t\"aggregate\",\n\t\t\"bulkUpsert\"\n\t],\n\tpermit: true\n}, {\n\tconditions: [loggedIn],\n\tactions: [\"read\"],\n\tpermit: true\n}];\n\n//#endregion\n//#region tailordb/role.ts\n\n//#endregion\n//#region tailordb/user.ts\n\n//#endregion\n//#region executors/userCreated.ts\n\n//#endregion\n\n// Export the executor function\nexport const __executor_function = async({newRecord,client})=>{const record=await client.execOne(sql.format(`select * from User where id = ?`,[newRecord.id]));console.log(`New user created: ${record.name} (${record.email})`)};","import { __executor_function } from \"../executors/user-created.transformed.js\";\n\nconst $connect_tailordb = async (namespace) => {\n  const baseClient = namespace ? new tailordb.Client({ namespace }) : { connect: () => {}, end: () => {} };\n  await baseClient.connect();\n\n  const client = {\n    async exec(query, params) {\n      const result = await baseClient.queryObject(query, params ?? []);\n      return result.rows;\n    },\n    async execOne(query, params) {\n      const result = await baseClient.queryObject(query, params ?? []);\n      return result.rows[0];\n    },\n  };\n  return {\n    ...client,\n    async transaction(callback) {\n      try {\n        await client.exec(\"BEGIN\");\n        const result = await callback(client);\n        await client.exec(\"COMMIT\");\n        return result;\n      } catch (e) {\n        console.error(\"Transaction failed:\", e);\n        try {\n          await client.exec(\"ROLLBACK\");\n        } catch (e) {\n          console.error(\"Failed to rollback transaction:\", e);\n        }\n      }\n    },\n    async end() {\n      try {\n        await baseClient.end();\n      } catch (e) {\n        console.error(\"Error ending connection:\", e);\n      }\n    }\n  };\n};\n\nconst $tailor_db_wrapper = async (namespace, fn) => {\n  return async (args) => {\n    const client = await $connect_tailordb(namespace);\n    try {\n      return await fn({ ...args, client });\n    } finally {\n      await client.end();\n    }\n  };\n};\nglobalThis.main = await $tailor_db_wrapper(\"tailordb\", __executor_function);"],"x_google_ignoreList":[0,1],"mappings":"uiBAAA,IAAI,EAAa,QAEb,EAAsB,KACtB,EAAsB,MACtB,EAAsB,0BACtB,EAAsB,CACxB,KAAS,MACT,KAAS,MACT,IAAS,MACT,KAAS,MACT,KAAS,MACT,IAAS,MACT,IAAS,MACT,IAAS,MACT,KAAS,OACV,CAED,EAAU,SAAW,SAAkB,EAAK,EAAiB,CAC3D,GAAI,MAAM,QAAQ,EAAI,CAAE,CAGtB,IAAK,IAFDC,EAAM,GAED,EAAI,EAAG,EAAI,EAAI,OAAQ,IAC9B,IAAQ,IAAM,EAAI,GAAK,MAAQ,EAAU,SAAS,EAAI,GAAI,EAAgB,CAG5E,OAAOA,UACE,EACT,MAAO,IAAM,OAAO,EAAI,CAAC,QAAQ,EAAkB,KAAK,CAAG,SAE3D,MAAO,IAAM,OAAO,EAAI,CAAC,QAAQ,EAAkB,KAAK,CAAC,QAAQ,EAAoB,MAAM,CAAG,KAIlG,EAAU,OAAS,SAAgB,EAAK,EAAkB,EAAU,CAClE,GAAI,GAA6B,KAC/B,MAAO,OAGT,OAAQ,OAAO,EAAf,CACE,IAAK,UAAW,OAAQ,EAAO,OAAS,QACxC,IAAK,SAAU,OAAO,EAAM,GAC5B,IAAK,SAYD,OAXE,OAAO,UAAU,SAAS,KAAK,EAAI,GAAK,gBACnC,EAAU,aAAa,EAAK,GAAY,QAAQ,CAC9C,MAAM,QAAQ,EAAI,CACpB,EAAU,YAAY,EAAK,EAAS,CAClC,OAAO,SAAS,EAAI,CACtB,EAAU,eAAe,EAAI,CAC3B,OAAO,EAAI,aAAgB,WAC7B,OAAO,EAAI,aAAa,CAAC,CACvB,EACF,EAAa,EAAI,UAAU,CAAC,CAE5B,EAAU,eAAe,EAAK,EAAS,CAElD,QAAS,OAAO,EAAa,EAAI,GAIrC,EAAU,YAAc,SAAqB,EAAO,EAAU,CAG5D,IAAK,IAFDA,EAAM,GAED,EAAI,EAAG,EAAI,EAAM,OAAQ,IAAK,CACrC,IAAI,EAAM,EAAM,GAEZ,MAAM,QAAQ,EAAI,CACpB,IAAQ,IAAM,EAAI,GAAK,MAAQ,IAAM,EAAU,YAAY,EAAK,EAAS,CAAG,IAE5E,IAAQ,IAAM,EAAI,GAAK,MAAQ,EAAU,OAAO,EAAK,GAAM,EAAS,CAIxE,OAAOA,GAGT,EAAU,OAAS,SAAgB,EAAK,EAAQ,EAAkB,EAAU,CAC1E,GAAI,GAAU,KACZ,OAAOA,EAGJ,MAAM,QAAQ,EAAO,GACxB,EAAS,CAAC,EAAO,EASnB,IANA,IAAI,EAAoB,EACpB,EAAoB,OACpB,EAAoB,GACpB,EAAoB,EACpB,EAEG,EAAc,EAAO,SAAW,EAAQ,EAAkB,KAAKA,EAAI,GAAG,CAC3E,IAAI,EAAM,EAAM,GAAG,OAEf,OAAM,GAIV,KAAI,EAAQ,IAAQ,EAChB,EAAU,SAAS,EAAO,GAAa,CACvC,EAAU,OAAO,EAAO,GAAc,EAAkB,EAAS,CAErE,GAAUA,EAAI,MAAM,EAAY,EAAM,MAAM,CAAG,EAC/C,EAAa,EAAkB,UAC/B,KAYF,OATI,IAAe,EAEVA,EAGL,EAAaA,EAAI,OACZ,EAASA,EAAI,MAAM,EAAW,CAGhC,GAGT,EAAU,aAAe,SAAsB,EAAM,EAAU,CAC7D,IAAI,EAAK,IAAI,KAAK,EAAK,CAEvB,GAAI,MAAM,EAAG,SAAS,CAAC,CACrB,MAAO,OAGT,IAAI,EACA,EACA,EACA,EACA,EACA,EACA,EAEJ,GAAI,IAAa,QACf,EAAc,EAAG,aAAa,CAC9B,EAAc,EAAG,UAAU,CAAG,EAC9B,EAAc,EAAG,SAAS,CAC1B,EAAc,EAAG,UAAU,CAC3B,EAAc,EAAG,YAAY,CAC7B,EAAc,EAAG,YAAY,CAC7B,EAAc,EAAG,iBAAiB,KAC7B,CACL,IAAI,EAAK,EAAgB,EAAS,CAE9B,IAAO,IAAS,IAAO,GACzB,EAAG,QAAQ,EAAG,SAAS,CAAI,EAAK,IAAO,CAGzC,EAAa,EAAG,gBAAgB,CAChC,EAAc,EAAG,aAAa,CAAG,EACjC,EAAc,EAAG,YAAY,CAC7B,EAAc,EAAG,aAAa,CAC9B,EAAc,EAAG,eAAe,CAChC,EAAc,EAAG,eAAe,CAChC,EAAc,EAAG,oBAAoB,CAIvC,IAAI,EAAM,EAAQ,EAAM,EAAE,CAAG,IAAM,EAAQ,EAAO,EAAE,CAAG,IAAM,EAAQ,EAAK,EAAE,CAAG,IAC7E,EAAQ,EAAM,EAAE,CAAG,IAAM,EAAQ,EAAQ,EAAE,CAAG,IAAM,EAAQ,EAAQ,EAAE,CAAG,IACzE,EAAQ,EAAa,EAAE,CAEzB,OAAO,EAAa,EAAI,EAG1B,EAAU,eAAiB,SAAwB,EAAQ,CACzD,MAAO,IAAM,EAAa,EAAO,SAAS,MAAM,CAAC,EAGnD,EAAU,eAAiB,SAAwB,EAAQ,EAAU,CACnE,IAAIA,EAAM,GAEV,IAAK,IAAI,KAAO,EAAQ,CACtB,IAAI,EAAM,EAAO,GAEjB,GAAI,OAAO,GAAQ,WACjB,SAGF,IAAQA,EAAI,SAAW,EAAI,GAAK,MAAQ,EAAU,SAAS,EAAI,CAAG,MAAQ,EAAU,OAAO,EAAK,GAAM,EAAS,CAGjH,OAAOA,GAGT,EAAU,IAAM,SAAa,EAAK,CAChC,GAAI,OAAOA,GAAQ,SACjB,MAAU,UAAU,gCAAgC,CAGtD,MAAO,CACL,YAAa,UAAuB,CAAE,OAAOA,GAC9C,EAGH,SAAS,EAAa,EAAK,CAKzB,IAJA,IAAI,EAAa,EAAoB,UAAY,EAC7C,EAAa,GACb,EAEI,EAAQ,EAAoB,KAAK,EAAI,EAC3C,GAAc,EAAI,MAAM,EAAY,EAAM,MAAM,CAAG,EAAiB,EAAM,IAC1E,EAAa,EAAoB,UAYnC,OATI,IAAe,EAEV,IAAM,EAAM,IAGjB,EAAa,EAAI,OACZ,IAAM,EAAa,EAAI,MAAM,EAAW,CAAG,IAG7C,IAAM,EAAa,IAG5B,SAAS,EAAQ,EAAQ,EAAQ,CAE/B,IADA,EAAS,EAAO,UAAU,CACnB,EAAO,OAAS,GACrB,EAAS,IAAM,EAGjB,OAAO,EAGT,SAAS,EAAgB,EAAI,CAC3B,GAAI,IAAO,IACT,MAAO,GAGT,IAAI,EAAI,EAAG,MAAM,4BAA4B,CAI7C,OAHI,GACM,EAAE,KAAO,IAAM,GAAK,IAAM,SAAS,EAAE,GAAI,GAAG,EAAK,EAAE,GAAK,SAAS,EAAE,GAAI,GAAG,CAAG,GAAK,IAAO,GAE5F,4BC3OT,EAAO,QAAA,GAAA,SCoDP,MAAa,EAAsB,MAAM,CAAC,YAAU,YAAU,CAAC,IAAM,EAAO,MAAM,EAAO,QAAQA,EAAAA,QAAI,OAAO,kCAAkC,CAAC,EAAU,GAAG,CAAC,CAAC,CAAC,QAAQ,IAAI,qBAAqB,EAAO,KAAK,IAAI,EAAO,MAAM,GAAG,EClD1N,EAAoB,KAAO,IAAc,CAC7C,IAAM,EAAa,EAAY,IAAI,SAAS,OAAO,CAAE,YAAW,CAAC,CAAG,CAAE,YAAe,GAAI,QAAW,GAAI,CACxG,MAAM,EAAW,SAAS,CAE1B,IAAM,EAAS,CACb,MAAM,KAAK,EAAO,EAAQ,CAExB,OADe,MAAM,EAAW,YAAY,EAAO,GAAU,EAAE,CAAC,EAClD,MAEhB,MAAM,QAAQ,EAAO,EAAQ,CAE3B,OADe,MAAM,EAAW,YAAY,EAAO,GAAU,EAAE,CAAC,EAClD,KAAK,IAEtB,CACD,MAAO,CACL,GAAG,EACH,MAAM,YAAY,EAAU,CAC1B,GAAI,CACF,MAAM,EAAO,KAAK,QAAQ,CAC1B,IAAM,EAAS,MAAM,EAAS,EAAO,CAErC,OADA,MAAM,EAAO,KAAK,SAAS,CACpB,QACA,EAAG,CACV,QAAQ,MAAM,sBAAuB,EAAE,CACvC,GAAI,CACF,MAAM,EAAO,KAAK,WAAW,OACtBC,EAAG,CACV,QAAQ,MAAM,kCAAmCA,EAAE,IAIzD,MAAM,KAAM,CACV,GAAI,CACF,MAAM,EAAW,KAAK,OACf,EAAG,CACV,QAAQ,MAAM,2BAA4B,EAAE,GAGjD,EAaH,WAAW,KAAO,MAVS,MAAO,EAAW,IACpC,KAAO,IAAS,CACrB,IAAM,EAAS,MAAM,EAAkB,EAAU,CACjD,GAAI,CACF,OAAO,MAAM,EAAG,CAAE,GAAG,EAAM,SAAQ,CAAC,QAC5B,CACR,MAAM,EAAO,KAAK,IAImB,WAAY,EAAoB"}