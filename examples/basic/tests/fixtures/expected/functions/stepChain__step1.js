var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,ee=c.length,u;l<ee;l++)u=c[l],!a.call(e,u)&&u!==o&&t(e,u,{get:(e=>i[e]).bind(null,u),enumerable:!(s=n(i,u))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));function l(e){return e==null||typeof e!=`object`&&typeof e!=`function`}function ee(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function u(e){if(l(e))return e;if(Array.isArray(e)||ee(e)||e instanceof ArrayBuffer||typeof SharedArrayBuffer<`u`&&e instanceof SharedArrayBuffer)return e.slice(0);let t=Object.getPrototypeOf(e),n=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new n(e);if(e instanceof RegExp){let t=new n(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new n(e.buffer.slice(0));if(e instanceof Error){let t=new n(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}if(typeof File<`u`&&e instanceof File)return new n([e],e.name,{type:e.type,lastModified:e.lastModified});if(typeof e==`object`){let n=Object.create(t);return Object.assign(n,e)}return e}var te=o((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.camelize=n;let t={plural:{men:RegExp(`^(m|wom)en$`,`gi`),people:RegExp(`(pe)ople$`,`gi`),children:RegExp(`(child)ren$`,`gi`),tia:RegExp(`([ti])a$`,`gi`),analyses:RegExp(`((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$`,`gi`),databases:RegExp(`(database)s$`,`gi`),drives:RegExp(`(drive)s$`,`gi`),hives:RegExp(`(hi|ti)ves$`,`gi`),curves:RegExp(`(curve)s$`,`gi`),lrves:RegExp(`([lr])ves$`,`gi`),aves:RegExp(`([a])ves$`,`gi`),foves:RegExp(`([^fo])ves$`,`gi`),movies:RegExp(`(m)ovies$`,`gi`),aeiouyies:RegExp(`([^aeiouy]|qu)ies$`,`gi`),series:RegExp(`(s)eries$`,`gi`),xes:RegExp(`(x|ch|ss|sh)es$`,`gi`),mice:RegExp(`([m|l])ice$`,`gi`),buses:RegExp(`(bus)es$`,`gi`),oes:RegExp(`(o)es$`,`gi`),shoes:RegExp(`(shoe)s$`,`gi`),crises:RegExp(`(cris|ax|test)es$`,`gi`),octopuses:RegExp(`(octop|vir)uses$`,`gi`),aliases:RegExp(`(alias|canvas|status|campus)es$`,`gi`),summonses:RegExp(`^(summons|bonus)es$`,`gi`),oxen:RegExp(`^(ox)en`,`gi`),matrices:RegExp(`(matr)ices$`,`gi`),vertices:RegExp(`(vert|ind)ices$`,`gi`),feet:RegExp(`^feet$`,`gi`),teeth:RegExp(`^teeth$`,`gi`),geese:RegExp(`^geese$`,`gi`),quizzes:RegExp(`(quiz)zes$`,`gi`),whereases:RegExp(`^(whereas)es$`,`gi`),criteria:RegExp(`^(criteri)a$`,`gi`),genera:RegExp(`^genera$`,`gi`),ss:RegExp(`ss$`,`gi`),s:RegExp(`s$`,`gi`)},singular:{man:RegExp(`^(m|wom)an$`,`gi`),person:RegExp(`(pe)rson$`,`gi`),child:RegExp(`(child)$`,`gi`),drive:RegExp(`(drive)$`,`gi`),ox:RegExp(`^(ox)$`,`gi`),axis:RegExp(`(ax|test)is$`,`gi`),octopus:RegExp(`(octop|vir)us$`,`gi`),alias:RegExp(`(alias|status|canvas|campus)$`,`gi`),summons:RegExp(`^(summons|bonus)$`,`gi`),bus:RegExp(`(bu)s$`,`gi`),buffalo:RegExp(`(buffal|tomat|potat)o$`,`gi`),tium:RegExp(`([ti])um$`,`gi`),sis:RegExp(`sis$`,`gi`),ffe:RegExp(`(?:([^f])fe|([lr])f)$`,`gi`),focus:RegExp(`^(focus)$`,`gi`),hive:RegExp(`(hi|ti)ve$`,`gi`),aeiouyy:RegExp(`([^aeiouy]|qu)y$`,`gi`),x:RegExp(`(x|ch|ss|sh)$`,`gi`),matrix:RegExp(`(matr)ix$`,`gi`),vertex:RegExp(`(vert|ind)ex$`,`gi`),mouse:RegExp(`([m|l])ouse$`,`gi`),foot:RegExp(`^foot$`,`gi`),tooth:RegExp(`^tooth$`,`gi`),goose:RegExp(`^goose$`,`gi`),quiz:RegExp(`(quiz)$`,`gi`),whereas:RegExp(`^(whereas)$`,`gi`),criterion:RegExp(`^(criteri)on$`,`gi`),genus:RegExp(`^genus$`,`gi`),s:RegExp(`s$`,`gi`),common:RegExp(`$`,`gi`)}};t.plural.men,t.plural.people,t.plural.children,t.plural.tia,t.plural.analyses,t.plural.databases,t.plural.drives,t.plural.hives,t.plural.curves,t.plural.lrves,t.plural.foves,t.plural.aeiouyies,t.plural.series,t.plural.movies,t.plural.xes,t.plural.mice,t.plural.buses,t.plural.oes,t.plural.shoes,t.plural.crises,t.plural.octopuses,t.plural.aliases,t.plural.summonses,t.plural.oxen,t.plural.matrices,t.plural.feet,t.plural.teeth,t.plural.geese,t.plural.quizzes,t.plural.whereases,t.plural.criteria,t.plural.genera,t.singular.man,t.singular.person,t.singular.child,t.singular.drive,t.singular.ox,t.singular.axis,t.singular.octopus,t.singular.alias,t.singular.summons,t.singular.bus,t.singular.buffalo,t.singular.tium,t.singular.sis,t.singular.ffe,t.singular.focus,t.singular.hive,t.singular.aeiouyy,t.singular.matrix,t.singular.vertex,t.singular.x,t.singular.mouse,t.singular.foot,t.singular.tooth,t.singular.goose,t.singular.quiz,t.singular.whereas,t.singular.criterion,t.singular.genus,t.singular.s,t.singular.common,t.singular.man,t.singular.person,t.singular.child,t.singular.drive,t.singular.ox,t.singular.axis,t.singular.octopus,t.singular.alias,t.singular.summons,t.singular.bus,t.singular.buffalo,t.singular.tium,t.singular.sis,t.singular.ffe,t.singular.focus,t.singular.hive,t.singular.aeiouyy,t.singular.x,t.singular.matrix,t.singular.mouse,t.singular.foot,t.singular.tooth,t.singular.goose,t.singular.quiz,t.singular.whereas,t.singular.criterion,t.singular.genus,t.plural.men,t.plural.people,t.plural.children,t.plural.databases,t.plural.drives,t.plural.genera,t.plural.criteria,t.plural.tia,t.plural.analyses,t.plural.hives,t.plural.curves,t.plural.lrves,t.plural.aves,t.plural.foves,t.plural.movies,t.plural.aeiouyies,t.plural.series,t.plural.xes,t.plural.mice,t.plural.buses,t.plural.oes,t.plural.shoes,t.plural.crises,t.plural.octopuses,t.plural.aliases,t.plural.summonses,t.plural.oxen,t.plural.matrices,t.plural.vertices,t.plural.feet,t.plural.teeth,t.plural.geese,t.plural.quizzes,t.plural.whereases,t.plural.ss,t.plural.s;function n(e,t){let n=e.split(`/`),r=n.length,i,a,o,s;for(let e=0;e<r;e++){for(i=n[e].split(`_`),a=0,o=i.length;a<o;a++)a!==0&&(i[a]=i[a].toLowerCase()),s=i[a].charAt(0),s=t&&e===0&&a===0?s.toLowerCase():s.toUpperCase(),i[a]=s+i[a].substring(1);n[e]=i.join(``)}return n.join(`::`)}}));Object.freeze({status:`aborted`});function d(e,t,n){function r(n,r){var i;for(let a in Object.defineProperty(n,`_zod`,{value:n._zod??{},enumerable:!1}),(i=n._zod).traits??(i.traits=new Set),n._zod.traits.add(e),t(n,r),o.prototype)a in n||Object.defineProperty(n,a,{value:o.prototype[a].bind(n)});n._zod.constr=o,n._zod.def=r}let i=n?.Parent??Object;class a extends i{}Object.defineProperty(a,`name`,{value:e});function o(e){var t;let i=n?.Parent?new a:this;r(i,e),(t=i._zod).deferred??(t.deferred=[]);for(let e of i._zod.deferred)e();return i}return Object.defineProperty(o,`init`,{value:r}),Object.defineProperty(o,Symbol.hasInstance,{value:t=>n?.Parent&&t instanceof n.Parent?!0:t?._zod?.traits?.has(e)}),Object.defineProperty(o,`name`,{value:e}),o}var ne=class extends Error{constructor(){super(`Encountered Promise during synchronous parse. Use .parseAsync() instead.`)}},re=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name=`ZodEncodeError`}};const ie={};function ae(e){return e&&Object.assign(ie,e),ie}function oe(e){let t=Object.values(e).filter(e=>typeof e==`number`);return Object.entries(e).filter(([e,n])=>t.indexOf(+e)===-1).map(([e,t])=>t)}function se(e,t){return typeof t==`bigint`?t.toString():t}function ce(e){return{get value(){{let t=e();return Object.defineProperty(this,`value`,{value:t}),t}throw Error(`cached value already set`)}}}function le(e){return e==null}function ue(e){let t=e.startsWith(`^`)?1:0,n=e.endsWith(`$`)?e.length-1:e.length;return e.slice(t,n)}const de=Symbol(`evaluating`);function f(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==de)return r===void 0&&(r=de,r=n()),r},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function fe(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function pe(...e){let t={};for(let n of e){let e=Object.getOwnPropertyDescriptors(n);Object.assign(t,e)}return Object.defineProperties({},t)}function me(e){return JSON.stringify(e)}const he=`captureStackTrace`in Error?Error.captureStackTrace:(...e)=>{};function ge(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}const _e=ce(()=>{if(typeof navigator<`u`&&navigator?.userAgent?.includes(`Cloudflare`))return!1;try{return Function(``),!0}catch{return!1}});function ve(e){if(ge(e)===!1)return!1;let t=e.constructor;if(t===void 0)return!0;let n=t.prototype;return!(ge(n)===!1||Object.prototype.hasOwnProperty.call(n,`isPrototypeOf`)===!1)}function ye(e){return ve(e)?{...e}:Array.isArray(e)?[...e]:e}const be=new Set([`string`,`number`,`symbol`]);function xe(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function Se(e,t,n){let r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}function p(e){let t=e;if(!t)return{};if(typeof t==`string`)return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error==`string`?{...t,error:()=>t.error}:t}function Ce(e){return Object.keys(e).filter(t=>e[t]._zod.optin===`optional`&&e[t]._zod.optout===`optional`)}-Number.MAX_VALUE,Number.MAX_VALUE;function we(e,t){let n=e._zod.def,r=pe(e._zod.def,{get shape(){let e={};for(let r in t){if(!(r in n.shape))throw Error(`Unrecognized key: "${r}"`);if(!t[r])continue;e[r]=n.shape[r]}return fe(this,`shape`,e),e},checks:[]});return Se(e,r)}function Te(e,t){let n=e._zod.def,r=pe(e._zod.def,{get shape(){let r={...e._zod.def.shape};for(let e in t){if(!(e in n.shape))throw Error(`Unrecognized key: "${e}"`);if(!t[e])continue;delete r[e]}return fe(this,`shape`,r),r},checks:[]});return Se(e,r)}function Ee(e,t){if(!ve(t))throw Error(`Invalid input to extend: expected a plain object`);let n=e._zod.def.checks;if(n&&n.length>0)throw Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let r=pe(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t};return fe(this,`shape`,n),n},checks:[]});return Se(e,r)}function De(e,t){if(!ve(t))throw Error(`Invalid input to safeExtend: expected a plain object`);let n={...e._zod.def,get shape(){let n={...e._zod.def.shape,...t};return fe(this,`shape`,n),n},checks:e._zod.def.checks};return Se(e,n)}function Oe(e,t){let n=pe(e._zod.def,{get shape(){let n={...e._zod.def.shape,...t._zod.def.shape};return fe(this,`shape`,n),n},get catchall(){return t._zod.def.catchall},checks:[]});return Se(e,n)}function ke(e,t,n){let r=pe(t._zod.def,{get shape(){let r=t._zod.def.shape,i={...r};if(n)for(let t in n){if(!(t in r))throw Error(`Unrecognized key: "${t}"`);if(!n[t])continue;i[t]=e?new e({type:`optional`,innerType:r[t]}):r[t]}else for(let t in r)i[t]=e?new e({type:`optional`,innerType:r[t]}):r[t];return fe(this,`shape`,i),i},checks:[]});return Se(t,r)}function Ae(e,t,n){let r=pe(t._zod.def,{get shape(){let r=t._zod.def.shape,i={...r};if(n)for(let t in n){if(!(t in i))throw Error(`Unrecognized key: "${t}"`);if(!n[t])continue;i[t]=new e({type:`nonoptional`,innerType:r[t]})}else for(let t in r)i[t]=new e({type:`nonoptional`,innerType:r[t]});return fe(this,`shape`,i),i},checks:[]});return Se(t,r)}function je(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function Me(e,t){return t.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(e),t})}function Ne(e){return typeof e==`string`?e:e?.message}function Pe(e,t,n){let r={...e,path:e.path??[]};return e.message||(r.message=Ne(e.inst?._zod.def?.error?.(e))??Ne(t?.error?.(e))??Ne(n.customError?.(e))??Ne(n.localeError?.(e))??`Invalid input`),delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function Fe(e){return Array.isArray(e)?`array`:typeof e==`string`?`string`:`unknown`}function Ie(...e){let[t,n,r]=e;return typeof t==`string`?{message:t,code:`custom`,input:n,inst:r}:{...t}}const Le=(e,t)=>{e.name=`$ZodError`,Object.defineProperty(e,`_zod`,{value:e._zod,enumerable:!1}),Object.defineProperty(e,`issues`,{value:t,enumerable:!1}),e.message=JSON.stringify(t,se,2),Object.defineProperty(e,`toString`,{value:()=>e.message,enumerable:!1})},Re=d(`$ZodError`,Le),ze=d(`$ZodError`,Le,{Parent:Error});function Be(e,t=e=>e.message){let n={},r=[];for(let i of e.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:n}}function Ve(e,t){let n=t||function(e){return e.message},r={_errors:[]},i=e=>{for(let t of e.issues)if(t.code===`invalid_union`&&t.errors.length)t.errors.map(e=>i({issues:e}));else if(t.code===`invalid_key`)i({issues:t.issues});else if(t.code===`invalid_element`)i({issues:t.issues});else if(t.path.length===0)r._errors.push(n(t));else{let e=r,i=0;for(;i<t.path.length;){let r=t.path[i];i===t.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(n(t))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(e),r}const He=e=>(t,n,r,i)=>{let a=r?Object.assign(r,{async:!1}):{async:!1},o=t._zod.run({value:n,issues:[]},a);if(o instanceof Promise)throw new ne;if(o.issues.length){let t=new(i?.Err??e)(o.issues.map(e=>Pe(e,a,ae())));throw he(t,i?.callee),t}return o.value},Ue=e=>async(t,n,r,i)=>{let a=r?Object.assign(r,{async:!0}):{async:!0},o=t._zod.run({value:n,issues:[]},a);if(o instanceof Promise&&(o=await o),o.issues.length){let t=new(i?.Err??e)(o.issues.map(e=>Pe(e,a,ae())));throw he(t,i?.callee),t}return o.value},We=e=>(t,n,r)=>{let i=r?{...r,async:!1}:{async:!1},a=t._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new ne;return a.issues.length?{success:!1,error:new(e??Re)(a.issues.map(e=>Pe(e,i,ae())))}:{success:!0,data:a.value}},Ge=We(ze),Ke=e=>async(t,n,r)=>{let i=r?Object.assign(r,{async:!0}):{async:!0},a=t._zod.run({value:n,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(e=>Pe(e,i,ae())))}:{success:!0,data:a.value}},qe=Ke(ze),Je=e=>(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return He(e)(t,n,i)},Ye=e=>(t,n,r)=>He(e)(t,n,r),Xe=e=>async(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Ue(e)(t,n,i)},Ze=e=>async(t,n,r)=>Ue(e)(t,n,r),Qe=e=>(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return We(e)(t,n,i)},$e=e=>(t,n,r)=>We(e)(t,n,r),et=e=>async(t,n,r)=>{let i=r?Object.assign(r,{direction:`backward`}):{direction:`backward`};return Ke(e)(t,n,i)},tt=e=>async(t,n,r)=>Ke(e)(t,n,r),nt=/^[cC][^\s-]{8,}$/,rt=/^[0-9a-z]+$/,it=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,at=/^[0-9a-vA-V]{20}$/,ot=/^[A-Za-z0-9]{27}$/,st=/^[a-zA-Z0-9_-]{21}$/,ct=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,lt=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ut=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,dt=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function ft(){return RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`)}const pt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,mt=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,ht=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,gt=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_t=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,vt=/^[A-Za-z0-9_-]*$/,yt=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,bt=/^\+(?:[0-9]){6,14}[0-9]$/,xt=`(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))`,St=RegExp(`^${xt}$`);function Ct(e){let t=`(?:[01]\\d|2[0-3]):[0-5]\\d`;return typeof e.precision==`number`?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function wt(e){return RegExp(`^${Ct(e)}$`)}function Tt(e){let t=Ct({precision:e.precision}),n=[`Z`];e.local&&n.push(``),e.offset&&n.push(`([+-](?:[01]\\d|2[0-3]):[0-5]\\d)`);let r=`${t}(?:${n.join(`|`)})`;return RegExp(`^${xt}T(?:${r})$`)}const Et=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??``}}`:`[\\s\\S]*`;return RegExp(`^${t}$`)},Dt=/^(?:true|false)$/i,Ot=/^[^A-Z]*$/,kt=/^[^a-z]*$/,At=d(`$ZodCheck`,(e,t)=>{var n;e._zod??={},e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),jt=d(`$ZodCheckMaxLength`,(e,t)=>{var n;At.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!le(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag.maximum??1/0;t.maximum<n&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{let r=n.value;if(r.length<=t.maximum)return;let i=Fe(r);n.issues.push({origin:i,code:`too_big`,maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Mt=d(`$ZodCheckMinLength`,(e,t)=>{var n;At.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!le(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag.minimum??-1/0;t.minimum>n&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{let r=n.value;if(r.length>=t.minimum)return;let i=Fe(r);n.issues.push({origin:i,code:`too_small`,minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Nt=d(`$ZodCheckLengthEquals`,(e,t)=>{var n;At.init(e,t),(n=e._zod.def).when??(n.when=e=>{let t=e.value;return!le(t)&&t.length!==void 0}),e._zod.onattach.push(e=>{let n=e._zod.bag;n.minimum=t.length,n.maximum=t.length,n.length=t.length}),e._zod.check=n=>{let r=n.value,i=r.length;if(i===t.length)return;let a=Fe(r),o=i>t.length;n.issues.push({origin:a,...o?{code:`too_big`,maximum:t.length}:{code:`too_small`,minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Pt=d(`$ZodCheckStringFormat`,(e,t)=>{var n,r;At.init(e,t),e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,t.pattern&&(n.patterns??=new Set,n.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:`string`,code:`invalid_format`,format:t.format,input:n.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),Ft=d(`$ZodCheckRegex`,(e,t)=>{Pt.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:`string`,code:`invalid_format`,format:`regex`,input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),It=d(`$ZodCheckLowerCase`,(e,t)=>{t.pattern??=Ot,Pt.init(e,t)}),Lt=d(`$ZodCheckUpperCase`,(e,t)=>{t.pattern??=kt,Pt.init(e,t)}),Rt=d(`$ZodCheckIncludes`,(e,t)=>{At.init(e,t);let n=xe(t.includes),r=new RegExp(typeof t.position==`number`?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(r)}),e._zod.check=n=>{n.value.includes(t.includes,t.position)||n.issues.push({origin:`string`,code:`invalid_format`,format:`includes`,includes:t.includes,input:n.value,inst:e,continue:!t.abort})}}),zt=d(`$ZodCheckStartsWith`,(e,t)=>{At.init(e,t);let n=RegExp(`^${xe(t.prefix)}.*`);t.pattern??=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(n)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:`string`,code:`invalid_format`,format:`starts_with`,prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),Bt=d(`$ZodCheckEndsWith`,(e,t)=>{At.init(e,t);let n=RegExp(`.*${xe(t.suffix)}$`);t.pattern??=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??=new Set,t.patterns.add(n)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:`string`,code:`invalid_format`,format:`ends_with`,suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),Vt=d(`$ZodCheckOverwrite`,(e,t)=>{At.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});var Ht=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),--this.indent}write(e){if(typeof e==`function`){e(this,{execution:`sync`}),e(this,{execution:`async`});return}let t=e.split(`
`).filter(e=>e),n=Math.min(...t.map(e=>e.length-e.trimStart().length)),r=t.map(e=>e.slice(n)).map(e=>` `.repeat(this.indent*2)+e);for(let e of r)this.content.push(e)}compile(){let e=Function,t=this?.args,n=[...(this?.content??[``]).map(e=>`  ${e}`)];return new e(...t,n.join(`
`))}};const Ut={major:4,minor:1,patch:11},m=d(`$ZodType`,(e,t)=>{var n;e??={},e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Ut;let r=[...e._zod.def.checks??[]];e._zod.traits.has(`$ZodCheck`)&&r.unshift(e);for(let t of r)for(let n of t._zod.onattach)n(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,n)=>{let r=je(e),i;for(let a of t){if(a._zod.def.when){if(!a._zod.def.when(e))continue}else if(r)continue;let t=e.issues.length,o=a._zod.check(e);if(o instanceof Promise&&n?.async===!1)throw new ne;if(i||o instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await o,e.issues.length!==t&&(r||=je(e,t))});else{if(e.issues.length===t)continue;r||=je(e,t)}}return i?i.then(()=>e):e},n=(n,i,a)=>{if(je(n))return n.aborted=!0,n;let o=t(i,r,a);if(o instanceof Promise){if(a.async===!1)throw new ne;return o.then(t=>e._zod.parse(t,a))}return e._zod.parse(o,a)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction===`backward`){let t=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return t instanceof Promise?t.then(e=>n(e,i,a)):n(t,i,a)}let o=e._zod.parse(i,a);if(o instanceof Promise){if(a.async===!1)throw new ne;return o.then(e=>t(e,r,a))}return t(o,r,a)}}e[`~standard`]={validate:t=>{try{let n=Ge(e,t);return n.success?{value:n.data}:{issues:n.error?.issues}}catch{return qe(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:`zod`,version:1}}),Wt=d(`$ZodString`,(e,t)=>{m.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Et(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value==`string`||n.issues.push({expected:`string`,code:`invalid_type`,input:n.value,inst:e}),n}}),h=d(`$ZodStringFormat`,(e,t)=>{Pt.init(e,t),Wt.init(e,t)}),Gt=d(`$ZodGUID`,(e,t)=>{t.pattern??=lt,h.init(e,t)}),Kt=d(`$ZodUUID`,(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(e===void 0)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??=ut(e)}else t.pattern??=ut();h.init(e,t)}),qt=d(`$ZodEmail`,(e,t)=>{t.pattern??=dt,h.init(e,t)}),Jt=d(`$ZodURL`,(e,t)=>{h.init(e,t),e._zod.check=n=>{try{let r=n.value.trim(),i=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||n.issues.push({code:`invalid_format`,format:`url`,note:`Invalid hostname`,pattern:yt.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(`:`)?i.protocol.slice(0,-1):i.protocol)||n.issues.push({code:`invalid_format`,format:`url`,note:`Invalid protocol`,pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=i.href:n.value=r;return}catch{n.issues.push({code:`invalid_format`,format:`url`,input:n.value,inst:e,continue:!t.abort})}}}),Yt=d(`$ZodEmoji`,(e,t)=>{t.pattern??=ft(),h.init(e,t)}),Xt=d(`$ZodNanoID`,(e,t)=>{t.pattern??=st,h.init(e,t)}),Zt=d(`$ZodCUID`,(e,t)=>{t.pattern??=nt,h.init(e,t)}),Qt=d(`$ZodCUID2`,(e,t)=>{t.pattern??=rt,h.init(e,t)}),$t=d(`$ZodULID`,(e,t)=>{t.pattern??=it,h.init(e,t)}),en=d(`$ZodXID`,(e,t)=>{t.pattern??=at,h.init(e,t)}),tn=d(`$ZodKSUID`,(e,t)=>{t.pattern??=ot,h.init(e,t)}),nn=d(`$ZodISODateTime`,(e,t)=>{t.pattern??=Tt(t),h.init(e,t)}),rn=d(`$ZodISODate`,(e,t)=>{t.pattern??=St,h.init(e,t)}),an=d(`$ZodISOTime`,(e,t)=>{t.pattern??=wt(t),h.init(e,t)}),on=d(`$ZodISODuration`,(e,t)=>{t.pattern??=ct,h.init(e,t)}),sn=d(`$ZodIPv4`,(e,t)=>{t.pattern??=pt,h.init(e,t),e._zod.onattach.push(e=>{let t=e._zod.bag;t.format=`ipv4`})}),cn=d(`$ZodIPv6`,(e,t)=>{t.pattern??=mt,h.init(e,t),e._zod.onattach.push(e=>{let t=e._zod.bag;t.format=`ipv6`}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:`invalid_format`,format:`ipv6`,input:n.value,inst:e,continue:!t.abort})}}}),ln=d(`$ZodCIDRv4`,(e,t)=>{t.pattern??=ht,h.init(e,t)}),un=d(`$ZodCIDRv6`,(e,t)=>{t.pattern??=gt,h.init(e,t),e._zod.check=n=>{let r=n.value.split(`/`);try{if(r.length!==2)throw Error();let[e,t]=r;if(!t)throw Error();let n=Number(t);if(`${n}`!==t||n<0||n>128)throw Error();new URL(`http://[${e}]`)}catch{n.issues.push({code:`invalid_format`,format:`cidrv6`,input:n.value,inst:e,continue:!t.abort})}}});function dn(e){if(e===``)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const fn=d(`$ZodBase64`,(e,t)=>{t.pattern??=_t,h.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding=`base64`}),e._zod.check=n=>{dn(n.value)||n.issues.push({code:`invalid_format`,format:`base64`,input:n.value,inst:e,continue:!t.abort})}});function pn(e){if(!vt.test(e))return!1;let t=e.replace(/[-_]/g,e=>e===`-`?`+`:`/`),n=t.padEnd(Math.ceil(t.length/4)*4,`=`);return dn(n)}const mn=d(`$ZodBase64URL`,(e,t)=>{t.pattern??=vt,h.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding=`base64url`}),e._zod.check=n=>{pn(n.value)||n.issues.push({code:`invalid_format`,format:`base64url`,input:n.value,inst:e,continue:!t.abort})}}),hn=d(`$ZodE164`,(e,t)=>{t.pattern??=bt,h.init(e,t)});function gn(e,t=null){try{let n=e.split(`.`);if(n.length!==3)return!1;let[r]=n;if(!r)return!1;let i=JSON.parse(atob(r));return!(`typ`in i&&i?.typ!==`JWT`||!i.alg||t&&(!(`alg`in i)||i.alg!==t))}catch{return!1}}const _n=d(`$ZodJWT`,(e,t)=>{h.init(e,t),e._zod.check=n=>{gn(n.value,t.alg)||n.issues.push({code:`invalid_format`,format:`jwt`,input:n.value,inst:e,continue:!t.abort})}}),vn=d(`$ZodBoolean`,(e,t)=>{m.init(e,t),e._zod.pattern=Dt,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}let i=n.value;return typeof i==`boolean`||n.issues.push({expected:`boolean`,code:`invalid_type`,input:i,inst:e}),n}}),yn=d(`$ZodAny`,(e,t)=>{m.init(e,t),e._zod.parse=e=>e}),bn=d(`$ZodUnknown`,(e,t)=>{m.init(e,t),e._zod.parse=e=>e}),xn=d(`$ZodNever`,(e,t)=>{m.init(e,t),e._zod.parse=(t,n)=>(t.issues.push({expected:`never`,code:`invalid_type`,input:t.value,inst:e}),t)});function Sn(e,t,n){e.issues.length&&t.issues.push(...Me(n,e.issues)),t.value[n]=e.value}const Cn=d(`$ZodArray`,(e,t)=>{m.init(e,t),e._zod.parse=(n,r)=>{let i=n.value;if(!Array.isArray(i))return n.issues.push({expected:`array`,code:`invalid_type`,input:i,inst:e}),n;n.value=Array(i.length);let a=[];for(let e=0;e<i.length;e++){let o=i[e],s=t.element._zod.run({value:o,issues:[]},r);s instanceof Promise?a.push(s.then(t=>Sn(t,n,e))):Sn(s,n,e)}return a.length?Promise.all(a).then(()=>n):n}});function wn(e,t,n,r){e.issues.length&&t.issues.push(...Me(n,e.issues)),e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function Tn(e){let t=Object.keys(e.shape);for(let n of t)if(!e.shape?.[n]?._zod?.traits?.has(`$ZodType`))throw Error(`Invalid element at key "${n}": expected a Zod schema`);let n=Ce(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function En(e,t,n,r,i,a){let o=[],s=i.keySet,c=i.catchall._zod,l=c.def.type;for(let i of Object.keys(t)){if(s.has(i))continue;if(l===`never`){o.push(i);continue}let a=c.run({value:t[i],issues:[]},r);a instanceof Promise?e.push(a.then(e=>wn(e,n,i,t))):wn(a,n,i,t)}return o.length&&n.issues.push({code:`unrecognized_keys`,keys:o,input:t,inst:a}),e.length?Promise.all(e).then(()=>n):n}const Dn=d(`$ZodObject`,(e,t)=>{if(m.init(e,t),!Object.getOwnPropertyDescriptor(t,`shape`)?.get){let e=t.shape;Object.defineProperty(t,`shape`,{get:()=>{let n={...e};return Object.defineProperty(t,`shape`,{value:n}),n}})}let n=ce(()=>Tn(t));f(e._zod,`propValues`,()=>{let e=t.shape,n={};for(let t in e){let r=e[t]._zod;if(r.values){n[t]??(n[t]=new Set);for(let e of r.values)n[t].add(e)}}return n});let r=ge,i=t.catchall,a;e._zod.parse=(t,o)=>{a??=n.value;let s=t.value;if(!r(s))return t.issues.push({expected:`object`,code:`invalid_type`,input:s,inst:e}),t;t.value={};let c=[],l=a.shape;for(let e of a.keys){let n=l[e]._zod.run({value:s[e],issues:[]},o);n instanceof Promise?c.push(n.then(n=>wn(n,t,e,s))):wn(n,t,e,s)}return i?En(c,s,t,o,n.value,e):c.length?Promise.all(c).then(()=>t):t}}),On=d(`$ZodObjectJIT`,(e,t)=>{Dn.init(e,t);let n=e._zod.parse,r=ce(()=>Tn(t)),i=e=>{let t=new Ht([`shape`,`payload`,`ctx`]),n=r.value,i=e=>{let t=me(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write(`const input = payload.value;`);let a=Object.create(null),o=0;for(let e of n.keys)a[e]=`key_${o++}`;t.write(`const newResult = {};`);for(let e of n.keys){let n=a[e],r=me(e);t.write(`const ${n} = ${i(e)};`),t.write(`
        if (${n}.issues.length) {
          payload.issues = payload.issues.concat(${n}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${r}, ...iss.path] : [${r}]
          })));
        }
        
        
        if (${n}.value === undefined) {
          if (${r} in input) {
            newResult[${r}] = undefined;
          }
        } else {
          newResult[${r}] = ${n}.value;
        }
        
      `)}t.write(`payload.value = newResult;`),t.write(`return payload;`);let s=t.compile();return(t,n)=>s(e,t,n)},a,o=ge,s=!ie.jitless,c=s&&_e.value,l=t.catchall,ee;e._zod.parse=(u,te)=>{ee??=r.value;let d=u.value;return o(d)?s&&c&&te?.async===!1&&te.jitless!==!0?(a||=i(t.shape),u=a(u,te),l?En([],d,u,te,ee,e):u):n(u,te):(u.issues.push({expected:`object`,code:`invalid_type`,input:d,inst:e}),u)}});function kn(e,t,n,r){for(let n of e)if(n.issues.length===0)return t.value=n.value,t;let i=e.filter(e=>!je(e));return i.length===1?(t.value=i[0].value,i[0]):(t.issues.push({code:`invalid_union`,input:t.value,inst:n,errors:e.map(e=>e.issues.map(e=>Pe(e,r,ae())))}),t)}const An=d(`$ZodUnion`,(e,t)=>{m.init(e,t),f(e._zod,`optin`,()=>t.options.some(e=>e._zod.optin===`optional`)?`optional`:void 0),f(e._zod,`optout`,()=>t.options.some(e=>e._zod.optout===`optional`)?`optional`:void 0),f(e._zod,`values`,()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),f(e._zod,`pattern`,()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>ue(e.source)).join(`|`)})$`)}});let n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(i,a)=>{if(n)return r(i,a);let o=!1,s=[];for(let e of t.options){let t=e._zod.run({value:i.value,issues:[]},a);if(t instanceof Promise)s.push(t),o=!0;else{if(t.issues.length===0)return t;s.push(t)}}return o?Promise.all(s).then(t=>kn(t,i,e,a)):kn(s,i,e,a)}}),jn=d(`$ZodIntersection`,(e,t)=>{m.init(e,t),e._zod.parse=(e,n)=>{let r=e.value,i=t.left._zod.run({value:r,issues:[]},n),a=t.right._zod.run({value:r,issues:[]},n);return i instanceof Promise||a instanceof Promise?Promise.all([i,a]).then(([t,n])=>Nn(e,t,n)):Nn(e,i,a)}});function Mn(e,t){if(e===t||e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(ve(e)&&ve(t)){let n=Object.keys(t),r=Object.keys(e).filter(e=>n.indexOf(e)!==-1),i={...e,...t};for(let n of r){let r=Mn(e[n],t[n]);if(!r.valid)return{valid:!1,mergeErrorPath:[n,...r.mergeErrorPath]};i[n]=r.data}return{valid:!0,data:i}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};let n=[];for(let r=0;r<e.length;r++){let i=e[r],a=t[r],o=Mn(i,a);if(!o.valid)return{valid:!1,mergeErrorPath:[r,...o.mergeErrorPath]};n.push(o.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Nn(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),je(e))return e;let r=Mn(t.value,n.value);if(!r.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const Pn=d(`$ZodRecord`,(e,t)=>{m.init(e,t),e._zod.parse=(n,r)=>{let i=n.value;if(!ve(i))return n.issues.push({expected:`record`,code:`invalid_type`,input:i,inst:e}),n;let a=[];if(t.keyType._zod.values){let o=t.keyType._zod.values;n.value={};for(let e of o)if(typeof e==`string`||typeof e==`number`||typeof e==`symbol`){let o=t.valueType._zod.run({value:i[e],issues:[]},r);o instanceof Promise?a.push(o.then(t=>{t.issues.length&&n.issues.push(...Me(e,t.issues)),n.value[e]=t.value})):(o.issues.length&&n.issues.push(...Me(e,o.issues)),n.value[e]=o.value)}let s;for(let e in i)o.has(e)||(s??=[],s.push(e));s&&s.length>0&&n.issues.push({code:`unrecognized_keys`,input:i,inst:e,keys:s})}else{n.value={};for(let o of Reflect.ownKeys(i)){if(o===`__proto__`)continue;let s=t.keyType._zod.run({value:o,issues:[]},r);if(s instanceof Promise)throw Error(`Async schemas not supported in object keys currently`);if(s.issues.length){n.issues.push({code:`invalid_key`,origin:`record`,issues:s.issues.map(e=>Pe(e,r,ae())),input:o,path:[o],inst:e}),n.value[s.value]=s.value;continue}let c=t.valueType._zod.run({value:i[o],issues:[]},r);c instanceof Promise?a.push(c.then(e=>{e.issues.length&&n.issues.push(...Me(o,e.issues)),n.value[s.value]=e.value})):(c.issues.length&&n.issues.push(...Me(o,c.issues)),n.value[s.value]=c.value)}}return a.length?Promise.all(a).then(()=>n):n}}),Fn=d(`$ZodEnum`,(e,t)=>{m.init(e,t);let n=oe(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=RegExp(`^(${n.filter(e=>be.has(typeof e)).map(e=>typeof e==`string`?xe(e):e.toString()).join(`|`)})$`),e._zod.parse=(t,i)=>{let a=t.value;return r.has(a)||t.issues.push({code:`invalid_value`,values:n,input:a,inst:e}),t}}),In=d(`$ZodLiteral`,(e,t)=>{if(m.init(e,t),t.values.length===0)throw Error(`Cannot create literal schema with no valid values`);e._zod.values=new Set(t.values),e._zod.pattern=RegExp(`^(${t.values.map(e=>typeof e==`string`?xe(e):e?xe(e.toString()):String(e)).join(`|`)})$`),e._zod.parse=(n,r)=>{let i=n.value;return e._zod.values.has(i)||n.issues.push({code:`invalid_value`,values:t.values,input:i,inst:e}),n}}),Ln=d(`$ZodTransform`,(e,t)=>{m.init(e,t),e._zod.parse=(n,r)=>{if(r.direction===`backward`)throw new re(e.constructor.name);let i=t.transform(n.value,n);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(e=>(n.value=e,n));if(i instanceof Promise)throw new ne;return n.value=i,n}});function Rn(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const zn=d(`$ZodOptional`,(e,t)=>{m.init(e,t),e._zod.optin=`optional`,e._zod.optout=`optional`,f(e._zod,`values`,()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),f(e._zod,`pattern`,()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${ue(e.source)})?$`):void 0}),e._zod.parse=(e,n)=>{if(t.innerType._zod.optin===`optional`){let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(t=>Rn(t,e.value)):Rn(r,e.value)}return e.value===void 0?e:t.innerType._zod.run(e,n)}}),Bn=d(`$ZodNullable`,(e,t)=>{m.init(e,t),f(e._zod,`optin`,()=>t.innerType._zod.optin),f(e._zod,`optout`,()=>t.innerType._zod.optout),f(e._zod,`pattern`,()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${ue(e.source)}|null)$`):void 0}),f(e._zod,`values`,()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,n)=>e.value===null?e:t.innerType._zod.run(e,n)}),Vn=d(`$ZodDefault`,(e,t)=>{m.init(e,t),e._zod.optin=`optional`,f(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);if(e.value===void 0)return e.value=t.defaultValue,e;let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(e=>Hn(e,t)):Hn(r,t)}});function Hn(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Un=d(`$ZodPrefault`,(e,t)=>{m.init(e,t),e._zod.optin=`optional`,f(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>(n.direction===`backward`||e.value===void 0&&(e.value=t.defaultValue),t.innerType._zod.run(e,n))}),Wn=d(`$ZodNonOptional`,(e,t)=>{m.init(e,t),f(e._zod,`values`,()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>e!==void 0)):void 0}),e._zod.parse=(n,r)=>{let i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(t=>Gn(t,e)):Gn(i,e)}});function Gn(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:`invalid_type`,expected:`nonoptional`,input:e.value,inst:t}),e}const Kn=d(`$ZodCatch`,(e,t)=>{m.init(e,t),f(e._zod,`optin`,()=>t.innerType._zod.optin),f(e._zod,`optout`,()=>t.innerType._zod.optout),f(e._zod,`values`,()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(r=>(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>Pe(e,n,ae()))},input:e.value}),e.issues=[]),e)):(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>Pe(e,n,ae()))},input:e.value}),e.issues=[]),e)}}),qn=d(`$ZodPipe`,(e,t)=>{m.init(e,t),f(e._zod,`values`,()=>t.in._zod.values),f(e._zod,`optin`,()=>t.in._zod.optin),f(e._zod,`optout`,()=>t.out._zod.optout),f(e._zod,`propValues`,()=>t.in._zod.propValues),e._zod.parse=(e,n)=>{if(n.direction===`backward`){let r=t.out._zod.run(e,n);return r instanceof Promise?r.then(e=>Jn(e,t.in,n)):Jn(r,t.in,n)}let r=t.in._zod.run(e,n);return r instanceof Promise?r.then(e=>Jn(e,t.out,n)):Jn(r,t.out,n)}});function Jn(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const Yn=d(`$ZodReadonly`,(e,t)=>{m.init(e,t),f(e._zod,`propValues`,()=>t.innerType._zod.propValues),f(e._zod,`values`,()=>t.innerType._zod.values),f(e._zod,`optin`,()=>t.innerType._zod.optin),f(e._zod,`optout`,()=>t.innerType._zod.optout),e._zod.parse=(e,n)=>{if(n.direction===`backward`)return t.innerType._zod.run(e,n);let r=t.innerType._zod.run(e,n);return r instanceof Promise?r.then(Xn):Xn(r)}});function Xn(e){return e.value=Object.freeze(e.value),e}const Zn=d(`$ZodCustom`,(e,t)=>{At.init(e,t),m.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=n=>{let r=n.value,i=t.fn(r);if(i instanceof Promise)return i.then(t=>Qn(t,n,r,e));Qn(i,n,r,e)}});function Qn(e,t,n,r){if(!e){let e={code:`custom`,input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(e.params=r._zod.def.params),t.issues.push(Ie(e))}}var $n=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let n=t[0];if(this._map.set(e,n),n&&typeof n==`object`&&`id`in n){if(this._idmap.has(n.id))throw Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t==`object`&&`id`in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n={...this.get(t)??{}};delete n.id;let r={...n,...this._map.get(e)};return Object.keys(r).length?r:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function er(){return new $n}const tr=er();function nr(e,t){return new e({type:`string`,...p(t)})}function rr(e,t){return new e({type:`string`,format:`email`,check:`string_format`,abort:!1,...p(t)})}function ir(e,t){return new e({type:`string`,format:`guid`,check:`string_format`,abort:!1,...p(t)})}function ar(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,...p(t)})}function or(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v4`,...p(t)})}function sr(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v6`,...p(t)})}function cr(e,t){return new e({type:`string`,format:`uuid`,check:`string_format`,abort:!1,version:`v7`,...p(t)})}function lr(e,t){return new e({type:`string`,format:`url`,check:`string_format`,abort:!1,...p(t)})}function ur(e,t){return new e({type:`string`,format:`emoji`,check:`string_format`,abort:!1,...p(t)})}function dr(e,t){return new e({type:`string`,format:`nanoid`,check:`string_format`,abort:!1,...p(t)})}function fr(e,t){return new e({type:`string`,format:`cuid`,check:`string_format`,abort:!1,...p(t)})}function pr(e,t){return new e({type:`string`,format:`cuid2`,check:`string_format`,abort:!1,...p(t)})}function mr(e,t){return new e({type:`string`,format:`ulid`,check:`string_format`,abort:!1,...p(t)})}function hr(e,t){return new e({type:`string`,format:`xid`,check:`string_format`,abort:!1,...p(t)})}function gr(e,t){return new e({type:`string`,format:`ksuid`,check:`string_format`,abort:!1,...p(t)})}function _r(e,t){return new e({type:`string`,format:`ipv4`,check:`string_format`,abort:!1,...p(t)})}function vr(e,t){return new e({type:`string`,format:`ipv6`,check:`string_format`,abort:!1,...p(t)})}function yr(e,t){return new e({type:`string`,format:`cidrv4`,check:`string_format`,abort:!1,...p(t)})}function br(e,t){return new e({type:`string`,format:`cidrv6`,check:`string_format`,abort:!1,...p(t)})}function xr(e,t){return new e({type:`string`,format:`base64`,check:`string_format`,abort:!1,...p(t)})}function Sr(e,t){return new e({type:`string`,format:`base64url`,check:`string_format`,abort:!1,...p(t)})}function Cr(e,t){return new e({type:`string`,format:`e164`,check:`string_format`,abort:!1,...p(t)})}function wr(e,t){return new e({type:`string`,format:`jwt`,check:`string_format`,abort:!1,...p(t)})}function Tr(e,t){return new e({type:`string`,format:`datetime`,check:`string_format`,offset:!1,local:!1,precision:null,...p(t)})}function Er(e,t){return new e({type:`string`,format:`date`,check:`string_format`,...p(t)})}function Dr(e,t){return new e({type:`string`,format:`time`,check:`string_format`,precision:null,...p(t)})}function Or(e,t){return new e({type:`string`,format:`duration`,check:`string_format`,...p(t)})}function kr(e,t){return new e({type:`boolean`,...p(t)})}function Ar(e){return new e({type:`any`})}function jr(e){return new e({type:`unknown`})}function Mr(e,t){return new e({type:`never`,...p(t)})}function Nr(e,t){return new jt({check:`max_length`,...p(t),maximum:e})}function Pr(e,t){return new Mt({check:`min_length`,...p(t),minimum:e})}function Fr(e,t){return new Nt({check:`length_equals`,...p(t),length:e})}function Ir(e,t){return new Ft({check:`string_format`,format:`regex`,...p(t),pattern:e})}function Lr(e){return new It({check:`string_format`,format:`lowercase`,...p(e)})}function Rr(e){return new Lt({check:`string_format`,format:`uppercase`,...p(e)})}function zr(e,t){return new Rt({check:`string_format`,format:`includes`,...p(t),includes:e})}function Br(e,t){return new zt({check:`string_format`,format:`starts_with`,...p(t),prefix:e})}function Vr(e,t){return new Bt({check:`string_format`,format:`ends_with`,...p(t),suffix:e})}function Hr(e){return new Vt({check:`overwrite`,tx:e})}function Ur(e){return Hr(t=>t.normalize(e))}function Wr(){return Hr(e=>e.trim())}function Gr(){return Hr(e=>e.toLowerCase())}function Kr(){return Hr(e=>e.toUpperCase())}function qr(e,t,n){return new e({type:`array`,element:t,...p(n)})}function Jr(e,t,n){return new e({type:`custom`,check:`custom`,fn:t,...p(n)})}function Yr(e){let t=Xr(n=>(n.addIssue=e=>{if(typeof e==`string`)n.issues.push(Ie(e,n.value,t._zod.def));else{let r=e;r.fatal&&(r.continue=!1),r.code??=`custom`,r.input??=n.value,r.inst??=t,r.continue??=!t._zod.def.abort,n.issues.push(Ie(r))}},e(n.value,n)));return t}function Xr(e,t){let n=new At({check:`custom`,...p(t)});return n._zod.check=e,n}const Zr=d(`ZodISODateTime`,(e,t)=>{nn.init(e,t),y.init(e,t)});function Qr(e){return Tr(Zr,e)}const $r=d(`ZodISODate`,(e,t)=>{rn.init(e,t),y.init(e,t)});function ei(e){return Er($r,e)}const ti=d(`ZodISOTime`,(e,t)=>{an.init(e,t),y.init(e,t)});function ni(e){return Dr(ti,e)}const ri=d(`ZodISODuration`,(e,t)=>{on.init(e,t),y.init(e,t)});function ii(e){return Or(ri,e)}const ai=(e,t)=>{Re.init(e,t),e.name=`ZodError`,Object.defineProperties(e,{format:{value:t=>Ve(e,t)},flatten:{value:t=>Be(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,se,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,se,2)}},isEmpty:{get(){return e.issues.length===0}}})};d(`ZodError`,ai);const g=d(`ZodError`,ai,{Parent:Error}),oi=He(g),si=Ue(g),ci=We(g),li=Ke(g),ui=Je(g),di=Ye(g),fi=Xe(g),pi=Ze(g),mi=Qe(g),hi=$e(g),gi=et(g),_i=tt(g),_=d(`ZodType`,(e,t)=>(m.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,`_def`,{value:t}),e.check=(...n)=>e.clone(pe(t,{checks:[...t.checks??[],...n.map(e=>typeof e==`function`?{_zod:{check:e,def:{check:`custom`},onattach:[]}}:e)]})),e.clone=(t,n)=>Se(e,t,n),e.brand=()=>e,e.register=((t,n)=>(t.add(e,n),e)),e.parse=(t,n)=>oi(e,t,n,{callee:e.parse}),e.safeParse=(t,n)=>ci(e,t,n),e.parseAsync=async(t,n)=>si(e,t,n,{callee:e.parseAsync}),e.safeParseAsync=async(t,n)=>li(e,t,n),e.spa=e.safeParseAsync,e.encode=(t,n)=>ui(e,t,n),e.decode=(t,n)=>di(e,t,n),e.encodeAsync=async(t,n)=>fi(e,t,n),e.decodeAsync=async(t,n)=>pi(e,t,n),e.safeEncode=(t,n)=>mi(e,t,n),e.safeDecode=(t,n)=>hi(e,t,n),e.safeEncodeAsync=async(t,n)=>gi(e,t,n),e.safeDecodeAsync=async(t,n)=>_i(e,t,n),e.refine=(t,n)=>e.check(Sa(t,n)),e.superRefine=t=>e.check(Ca(t)),e.overwrite=t=>e.check(Hr(t)),e.optional=()=>oa(e),e.nullable=()=>ca(e),e.nullish=()=>oa(ca(e)),e.nonoptional=t=>ma(e,t),e.array=()=>x(e),e.or=t=>Yi([e,t]),e.and=t=>Zi(e,t),e.transform=t=>va(e,ia(t)),e.default=t=>ua(e,t),e.prefault=t=>fa(e,t),e.catch=t=>ga(e,t),e.pipe=t=>va(e,t),e.readonly=()=>ba(e),e.describe=t=>{let n=e.clone();return tr.add(n,{description:t}),n},Object.defineProperty(e,`description`,{get(){return tr.get(e)?.description},configurable:!0}),e.meta=(...t)=>{if(t.length===0)return tr.get(e);let n=e.clone();return tr.add(n,t[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),vi=d(`_ZodString`,(e,t)=>{Wt.init(e,t),_.init(e,t);let n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...t)=>e.check(Ir(...t)),e.includes=(...t)=>e.check(zr(...t)),e.startsWith=(...t)=>e.check(Br(...t)),e.endsWith=(...t)=>e.check(Vr(...t)),e.min=(...t)=>e.check(Pr(...t)),e.max=(...t)=>e.check(Nr(...t)),e.length=(...t)=>e.check(Fr(...t)),e.nonempty=(...t)=>e.check(Pr(1,...t)),e.lowercase=t=>e.check(Lr(t)),e.uppercase=t=>e.check(Rr(t)),e.trim=()=>e.check(Wr()),e.normalize=(...t)=>e.check(Ur(...t)),e.toLowerCase=()=>e.check(Gr()),e.toUpperCase=()=>e.check(Kr())}),yi=d(`ZodString`,(e,t)=>{Wt.init(e,t),vi.init(e,t),e.email=t=>e.check(rr(bi,t)),e.url=t=>e.check(lr(Ci,t)),e.jwt=t=>e.check(wr(Ri,t)),e.emoji=t=>e.check(ur(wi,t)),e.guid=t=>e.check(ir(xi,t)),e.uuid=t=>e.check(ar(Si,t)),e.uuidv4=t=>e.check(or(Si,t)),e.uuidv6=t=>e.check(sr(Si,t)),e.uuidv7=t=>e.check(cr(Si,t)),e.nanoid=t=>e.check(dr(Ti,t)),e.guid=t=>e.check(ir(xi,t)),e.cuid=t=>e.check(fr(Ei,t)),e.cuid2=t=>e.check(pr(Di,t)),e.ulid=t=>e.check(mr(Oi,t)),e.base64=t=>e.check(xr(Fi,t)),e.base64url=t=>e.check(Sr(Ii,t)),e.xid=t=>e.check(hr(ki,t)),e.ksuid=t=>e.check(gr(Ai,t)),e.ipv4=t=>e.check(_r(ji,t)),e.ipv6=t=>e.check(vr(Mi,t)),e.cidrv4=t=>e.check(yr(Ni,t)),e.cidrv6=t=>e.check(br(Pi,t)),e.e164=t=>e.check(Cr(Li,t)),e.datetime=t=>e.check(Qr(t)),e.date=t=>e.check(ei(t)),e.time=t=>e.check(ni(t)),e.duration=t=>e.check(ii(t))});function v(e){return nr(yi,e)}const y=d(`ZodStringFormat`,(e,t)=>{h.init(e,t),vi.init(e,t)}),bi=d(`ZodEmail`,(e,t)=>{qt.init(e,t),y.init(e,t)}),xi=d(`ZodGUID`,(e,t)=>{Gt.init(e,t),y.init(e,t)}),Si=d(`ZodUUID`,(e,t)=>{Kt.init(e,t),y.init(e,t)}),Ci=d(`ZodURL`,(e,t)=>{Jt.init(e,t),y.init(e,t)}),wi=d(`ZodEmoji`,(e,t)=>{Yt.init(e,t),y.init(e,t)}),Ti=d(`ZodNanoID`,(e,t)=>{Xt.init(e,t),y.init(e,t)}),Ei=d(`ZodCUID`,(e,t)=>{Zt.init(e,t),y.init(e,t)}),Di=d(`ZodCUID2`,(e,t)=>{Qt.init(e,t),y.init(e,t)}),Oi=d(`ZodULID`,(e,t)=>{$t.init(e,t),y.init(e,t)}),ki=d(`ZodXID`,(e,t)=>{en.init(e,t),y.init(e,t)}),Ai=d(`ZodKSUID`,(e,t)=>{tn.init(e,t),y.init(e,t)}),ji=d(`ZodIPv4`,(e,t)=>{sn.init(e,t),y.init(e,t)}),Mi=d(`ZodIPv6`,(e,t)=>{cn.init(e,t),y.init(e,t)}),Ni=d(`ZodCIDRv4`,(e,t)=>{ln.init(e,t),y.init(e,t)}),Pi=d(`ZodCIDRv6`,(e,t)=>{un.init(e,t),y.init(e,t)}),Fi=d(`ZodBase64`,(e,t)=>{fn.init(e,t),y.init(e,t)}),Ii=d(`ZodBase64URL`,(e,t)=>{mn.init(e,t),y.init(e,t)}),Li=d(`ZodE164`,(e,t)=>{hn.init(e,t),y.init(e,t)}),Ri=d(`ZodJWT`,(e,t)=>{_n.init(e,t),y.init(e,t)}),zi=d(`ZodBoolean`,(e,t)=>{vn.init(e,t),_.init(e,t)});function Bi(e){return kr(zi,e)}const Vi=d(`ZodAny`,(e,t)=>{yn.init(e,t),_.init(e,t)});function b(){return Ar(Vi)}const Hi=d(`ZodUnknown`,(e,t)=>{bn.init(e,t),_.init(e,t)});function Ui(){return jr(Hi)}const Wi=d(`ZodNever`,(e,t)=>{xn.init(e,t),_.init(e,t)});function Gi(e){return Mr(Wi,e)}const Ki=d(`ZodArray`,(e,t)=>{Cn.init(e,t),_.init(e,t),e.element=t.element,e.min=(t,n)=>e.check(Pr(t,n)),e.nonempty=t=>e.check(Pr(1,t)),e.max=(t,n)=>e.check(Nr(t,n)),e.length=(t,n)=>e.check(Fr(t,n)),e.unwrap=()=>e.element});function x(e,t){return qr(Ki,e,t)}const qi=d(`ZodObject`,(e,t)=>{On.init(e,t),_.init(e,t),f(e,`shape`,()=>t.shape),e.keyof=()=>ta(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Ui()}),e.loose=()=>e.clone({...e._zod.def,catchall:Ui()}),e.strict=()=>e.clone({...e._zod.def,catchall:Gi()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>Ee(e,t),e.safeExtend=t=>De(e,t),e.merge=t=>Oe(e,t),e.pick=t=>we(e,t),e.omit=t=>Te(e,t),e.partial=(...t)=>ke(aa,e,t[0]),e.required=(...t)=>Ae(pa,e,t[0])});function S(e,t){let n={type:`object`,shape:e??{},...p(t)};return new qi(n)}const Ji=d(`ZodUnion`,(e,t)=>{An.init(e,t),_.init(e,t),e.options=t.options});function Yi(e,t){return new Ji({type:`union`,options:e,...p(t)})}const Xi=d(`ZodIntersection`,(e,t)=>{jn.init(e,t),_.init(e,t)});function Zi(e,t){return new Xi({type:`intersection`,left:e,right:t})}const Qi=d(`ZodRecord`,(e,t)=>{Pn.init(e,t),_.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function $i(e,t,n){return new Qi({type:`record`,keyType:e,valueType:t,...p(n)})}const ea=d(`ZodEnum`,(e,t)=>{Fn.init(e,t),_.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);let n=new Set(Object.keys(t.entries));e.extract=(e,r)=>{let i={};for(let r of e)if(n.has(r))i[r]=t.entries[r];else throw Error(`Key ${r} not found in enum`);return new ea({...t,checks:[],...p(r),entries:i})},e.exclude=(e,r)=>{let i={...t.entries};for(let t of e)if(n.has(t))delete i[t];else throw Error(`Key ${t} not found in enum`);return new ea({...t,checks:[],...p(r),entries:i})}});function ta(e,t){let n=Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e;return new ea({type:`enum`,entries:n,...p(t)})}const na=d(`ZodLiteral`,(e,t)=>{In.init(e,t),_.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,`value`,{get(){if(t.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function C(e,t){return new na({type:`literal`,values:Array.isArray(e)?e:[e],...p(t)})}const ra=d(`ZodTransform`,(e,t)=>{Ln.init(e,t),_.init(e,t),e._zod.parse=(n,r)=>{if(r.direction===`backward`)throw new re(e.constructor.name);n.addIssue=r=>{if(typeof r==`string`)n.issues.push(Ie(r,n.value,t));else{let t=r;t.fatal&&(t.continue=!1),t.code??=`custom`,t.input??=n.value,t.inst??=e,n.issues.push(Ie(t))}};let i=t.transform(n.value,n);return i instanceof Promise?i.then(e=>(n.value=e,n)):(n.value=i,n)}});function ia(e){return new ra({type:`transform`,transform:e})}const aa=d(`ZodOptional`,(e,t)=>{zn.init(e,t),_.init(e,t),e.unwrap=()=>e._zod.def.innerType});function oa(e){return new aa({type:`optional`,innerType:e})}const sa=d(`ZodNullable`,(e,t)=>{Bn.init(e,t),_.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ca(e){return new sa({type:`nullable`,innerType:e})}const la=d(`ZodDefault`,(e,t)=>{Vn.init(e,t),_.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function ua(e,t){return new la({type:`default`,innerType:e,get defaultValue(){return typeof t==`function`?t():ye(t)}})}const da=d(`ZodPrefault`,(e,t)=>{Un.init(e,t),_.init(e,t),e.unwrap=()=>e._zod.def.innerType});function fa(e,t){return new da({type:`prefault`,innerType:e,get defaultValue(){return typeof t==`function`?t():ye(t)}})}const pa=d(`ZodNonOptional`,(e,t)=>{Wn.init(e,t),_.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ma(e,t){return new pa({type:`nonoptional`,innerType:e,...p(t)})}const ha=d(`ZodCatch`,(e,t)=>{Kn.init(e,t),_.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function ga(e,t){return new ha({type:`catch`,innerType:e,catchValue:typeof t==`function`?t:()=>t})}const _a=d(`ZodPipe`,(e,t)=>{qn.init(e,t),_.init(e,t),e.in=t.in,e.out=t.out});function va(e,t){return new _a({type:`pipe`,in:e,out:t})}const ya=d(`ZodReadonly`,(e,t)=>{Yn.init(e,t),_.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ba(e){return new ya({type:`readonly`,innerType:e})}const xa=d(`ZodCustom`,(e,t)=>{Zn.init(e,t),_.init(e,t)});function Sa(e,t={}){return Jr(xa,e,t)}function Ca(e){return Yr(e)}var wa=c(te(),1);function Ta(e){let t=e.match(/^[ \t]+/);return t?t[0]:``}function Ea(e){let t=e.match(/(?<=(\r\n|\r|\n))[ \t]+$/);return t?t[0]:``}function Da(e,...t){let n=``,r=(typeof e==`string`?e.split(/(?=\r\n|\r|\n)/):e.map(e=>e)).map((e,r)=>(e.match(/\r\n|\r|\n/)&&(n=Ea(e)||n),e+(t[r]||``).replace(/\r\n|\r|\n/g,`
`+n))).join(``).split(/\r\n|\r|\n/),i=Math.min(...r.filter(e=>!!e.match(/[^ \t]/)).map(e=>Ta(e).length));return r.map(e=>e.slice(i)).join(`
`).replace(/^\n|\n[ \t]*$/g,``)}function Oa(e){return e.map(e=>typeof e==`string`?{value:e,description:``}:{...e,description:e.description??``})}var ka=class{_output=null;constructor(e){this.fields=e}},Aa=class e{_metadata;_defined=void 0;_output=void 0;get metadata(){return{...this._metadata}}constructor(e,t,n,r){this.fields=n,this._metadata={type:e,required:!0},t&&(t.optional===!0&&(this._metadata.required=!1,t.assertNonNull===!0&&(this._metadata.assertNonNull=!0)),t.array===!0&&(this._metadata.array=!0)),r&&(this._metadata.allowedValues=Oa(r))}static create(t,n,r,i){return new e(t,n,r,i)}description(e){return this._metadata.description=e,this}};const ja=Aa.create;function Ma(e){return ja(`uuid`,e)}function Na(e){return ja(`string`,e)}function Pa(e){return ja(`boolean`,e)}function Fa(e){return ja(`integer`,e)}function Ia(e){return ja(`float`,e)}function La(e){return ja(`date`,e)}function Ra(e){return ja(`datetime`,e)}function za(e){return ja(`time`,e)}function Ba(...e){let t,n,r=e[e.length-1];return typeof r==`object`&&!(`value`in r)?(t=e.slice(0,-1),n=r):(t=e,n=void 0),ja(`enum`,n,void 0,t)}function Va(e,t){return ja(`nested`,t,e)}function Ha(e){return new ka(e)}const Ua={type:Ha,uuid:Ma,string:Na,bool:Pa,int:Fa,float:Ia,date:La,datetime:Ra,time:za,enum:Ba,object:Va},Wa=class e extends Aa{_ref=void 0;get reference(){return u(this._ref)}get metadata(){return{...this._metadata}}get config(){return{...this._metadata,validate:this._metadata.validate?.map(e=>{let{fn:t,message:n}=typeof e==`function`?{fn:e,message:`failed by \`${e.toString().trim()}\``}:{fn:e[0],message:e[1]};return{script:{expr:`(${t.toString().trim()})({ value: _value, user })`},errorMessage:n}}),hooks:this._metadata.hooks?{create:this._metadata.hooks.create?{expr:`(${this._metadata.hooks.create.toString().trim()})({ value: _value, data: _data, user })`}:void 0,update:this._metadata.hooks.update?{expr:`(${this._metadata.hooks.update.toString().trim()})({ value: _value, data: _data, user })`}:void 0}:void 0,serial:this._metadata.serial?{start:this._metadata.serial.start,maxValue:this._metadata.serial.maxValue,format:`format`in this._metadata.serial?this._metadata.serial.format:void 0}:void 0}}constructor(e,t,n,r){super(e,t,n,r)}static create(t,n,r,i){return new e(t,n,r,i)}description(e){return super.description(e)}relation(e){let t=this,n=e?.toward?.type===`self`;if(t._metadata.index=!0,t._metadata.foreignKey=!0,t._metadata.unique=[`oneToOne`,`1-1`].includes(e.type),!n){let n=e.toward.type;t._metadata.foreignKeyType=n.name}if(e.type===`keyOnly`)return t;let r=e?.toward?.key??`id`,i=e?.backward??``;if(n){let n=e;return t._pendingSelfRelation={as:n.toward.as,key:r,backward:i,relationType:n.type},t._metadata.relation=!0,t}let a=e,o=a.toward.type,s=a.toward.as??wa.camelize(o.name,!0);return this._ref={type:o,nameMap:[s,i],key:r},t._metadata.relation=!0,t}index(){return this._metadata.index=!0,this}unique(){return this._metadata.unique=!0,this._metadata.index=!0,this}vector(){return this._metadata.vector=!0,this}hooks(e){return this._metadata.hooks=e,this}validate(...e){return this._metadata.validate=e,this}serial(e){return this._metadata.serial=e,this}}.create;function Ga(e){return Wa(`uuid`,e)}Ga();const Ka=S({VaultName:v(),SecretKey:v()}),qa=S({kind:C(`SAML`),spCertBase64:Ka,spKeyBase64:Ka}),Ja=S({kind:C(`OIDC`),clientID:v(),clientSecret:Ka,providerURL:v(),issuerURL:v().optional(),usernameClaim:v().optional()}),Ya=Yi([qa.extend({metadataURL:v()}),qa.extend({rawMetadata:v()})]),Xa=S({kind:C(`IDToken`),providerURL:v(),issuerURL:v().optional(),clientID:v(),usernameClaim:v().optional()}),Za=S({kind:C(`BuiltInIdP`),namespace:v(),clientName:v()}),Qa=S({name:v(),config:Yi([Ja,Ya,Xa,Za])}),$a=Yi([C(`authorization_code`),C(`refresh_token`)]),eo=S({description:v().optional(),grantTypes:x($a).optional(),redirectURIs:x(v()),clientType:Yi([C(`confidential`),C(`public`),C(`browser`)]).optional()}),to=S({type:Yi([C(`oauth2`),C(`bearer`)]),bearerSecret:Ka.optional()}),no=Yi([C(`string`),C(`number`),C(`boolean`),C(`datetime`),C(`complex`)]),ro=S({type:no,name:v(),description:v().optional(),mutability:Yi([C(`readOnly`),C(`readWrite`),C(`writeOnly`)]).optional(),required:Bi().optional(),multiValued:Bi().optional(),uniqueness:Yi([C(`none`),C(`server`),C(`global`)]).optional(),canonicalValues:x(v()).nullable().optional(),get subAttributes(){return x(ro).nullable().optional()}}),io=S({name:v(),attributes:x(ro)}),ao=S({tailorDBField:v(),scimPath:v()}),oo=S({name:v(),tailorDBNamespace:v(),tailorDBType:v(),coreSchema:io,attributeMapping:x(ao)}),so=S({machineUserName:v(),authorization:to,resources:x(oo)}),co=S({namespace:v(),type:v(),signatureField:v()}),lo=S({type:S({name:v(),referenced:b(),fields:b(),metadata:b(),hooks:b(),validate:b(),features:b(),indexes:b(),files:b(),permission:b(),gqlPermission:b(),_output:b()}),usernameField:v(),attributes:$i(v(),C(!0)).optional(),attributeList:x(v()).optional()}),uo=Yi([v(),Bi(),x(v()),x(Bi())]),fo=S({attributes:$i(v(),uo).optional(),attributeList:x(b()).optional()});S({name:v(),userProfile:lo.optional(),machineUsers:$i(v(),fo).optional(),oauth2Clients:$i(v(),eo).optional(),idProviderConfigs:x(Qa).optional(),scimConfig:so.optional(),tenantProviderConfig:co.optional()}).brand(`AuthConfig`);var po=class{_output=null;_context=null;#steps;get steps(){return this.#steps}#options;get options(){return this.#options}#output=null;get output(){return this.#output}#outputMapper=null;get outputMapper(){return this.#outputMapper}constructor(e,t,n,r={defaults:{}}){this.queryType=e,this.name=t,this.input=n,this.#steps=[],this.#options=r}fnStep(e,t,n){return this.#steps.push([`fn`,e,t,n]),this}returns(e,t){return this.#outputMapper=e,this.#output=t,this}};function mo(e,t,n){return t&&`_output`in t?new po(`query`,e,t,n):new po(`query`,e,void 0,t)}Da`
  import { SqlClient } from "@tailor-platform/tailor-sdk";
  import {
    ColumnType,
    DummyDriver,
    Kysely,
    PostgresAdapter,
    PostgresIntrospector,
    PostgresQueryCompiler,
    type CompiledQuery,
  } from "kysely";

  type ArrayType<T> = ArrayTypeImpl<T> extends (infer U)[]
    ? U[]
    : ArrayTypeImpl<T>;
  type ArrayTypeImpl<T> = T extends ColumnType<infer S, infer I, infer U>
    ? ColumnType<S[], I[], U[]>
    : T[];
  type Generated<T> = T extends ColumnType<infer S, infer I, infer U>
    ? ColumnType<S, I | undefined, U>
    : ColumnType<T, T | undefined, T>;
  type Json = JsonValue;
  type JsonArray = JsonValue[];
  type JsonObject = {
    [x: string]: JsonValue | undefined;
  };
  type JsonPrimitive = boolean | number | string | null;
  type JsonValue = JsonArray | JsonObject | JsonPrimitive;
  type Timestamp = ColumnType<Date, Date | string, Date | string>;
`,Da`
  const getDB = () => {
    return new Kysely<DB>({
      dialect: {
        createAdapter: () => new PostgresAdapter(),
        createDriver: () => new DummyDriver(),
        createIntrospector: (db: Kysely<unknown>) => new PostgresIntrospector(db),
        createQueryCompiler: () => new PostgresQueryCompiler(),
      },
    });
  };

  type QueryReturnType<T> = T extends CompiledQuery<infer U> ? U : never;

  export async function kyselyWrapper<const C extends { client: SqlClient }, R>(
    context: C,
    callback: (
      context: Omit<C, "client"> & {
        db: ReturnType<typeof getDB>;
        client: {
          exec: <Q extends CompiledQuery>(
            query: Q,
          ) => Promise<QueryReturnType<Q>[]>;
        };
      },
    ) => Promise<R>,
  ) {
    const db = getDB();
    const clientWrapper = {
      exec: async <Q extends CompiledQuery>(query: Q) => {
        return await context.client.exec<QueryReturnType<Q>[]>(query.sql, query.parameters);
      },
    };

    return await callback({ ...context, db, client: clientWrapper });
  }
`,Da`
  const $connect_tailordb = async (namespace) => {
    const baseClient = namespace ? new tailordb.Client({ namespace }) : { connect: () => {}, end: () => {} };
    await baseClient.connect();

    const client = {
      async exec(query, params) {
        const result = await baseClient.queryObject(query, params ?? []);
        return result.rows;
      },
      async execOne(query, params) {
        const result = await baseClient.queryObject(query, params ?? []);
        return result.rows[0];
      },
    };
    return {
      ...client,
      async transaction(callback) {
        try {
          await client.exec("BEGIN");
          const result = await callback(client);
          await client.exec("COMMIT");
          return result;
        } catch (e) {
          console.error("Transaction failed:", e);
          try {
            await client.exec("ROLLBACK");
          } catch (e) {
            console.error("Failed to rollback transaction:", e);
          }
        }
      },
      async end() {
        try {
          await baseClient.end();
        } catch (e) {
          console.error("Error ending connection:", e);
        }
      }
    };
  };

  const ${`$tailor_db_wrapper`} = async (namespace, fn) => {
    return async (args) => {
      const client = await $connect_tailordb(namespace);
      try {
        return await fn({ ...args, client });
      } finally {
        await client.end();
      }
    };
  };
`;const ho={...Ua},go=6048e5,_o=3600*24;_o*7,_o*365.2425;const vo=Symbol.for(`constructDateFrom`);function yo(e,t){return typeof e==`function`?e(t):e&&typeof e==`object`&&vo in e?e[vo](t):e instanceof Date?new e.constructor(t):new Date(t)}function w(e,t){return yo(t||e,e)}let bo={};function xo(){return bo}function So(e,t){let n=xo(),r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,i=w(e,t?.in),a=i.getDay(),o=(a<r?7:0)+a-r;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function Co(e,t){return So(e,{...t,weekStartsOn:1})}function wo(e,t){let n=w(e,t?.in),r=n.getFullYear(),i=yo(n,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);let a=Co(i),o=yo(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);let s=Co(o);return n.getTime()>=a.getTime()?r+1:n.getTime()>=s.getTime()?r:r-1}function To(e){let t=w(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),e-+n}function Eo(e,...t){let n=yo.bind(null,e||t.find(e=>typeof e==`object`));return t.map(n)}function Do(e,t){let n=w(e,t?.in);return n.setHours(0,0,0,0),n}function Oo(e,t,n){let[r,i]=Eo(n?.in,e,t),a=Do(r),o=Do(i),s=+a-To(a),c=+o-To(o);return Math.round((s-c)/864e5)}function ko(e,t){let n=wo(e,t),r=yo(t?.in||e,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),Co(r)}function Ao(e){return e instanceof Date||typeof e==`object`&&Object.prototype.toString.call(e)===`[object Date]`}function jo(e){return!(!Ao(e)&&typeof e!=`number`||isNaN(+w(e)))}function Mo(e,t){let n=w(e,t?.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const No={lessThanXSeconds:{one:`less than a second`,other:`less than {{count}} seconds`},xSeconds:{one:`1 second`,other:`{{count}} seconds`},halfAMinute:`half a minute`,lessThanXMinutes:{one:`less than a minute`,other:`less than {{count}} minutes`},xMinutes:{one:`1 minute`,other:`{{count}} minutes`},aboutXHours:{one:`about 1 hour`,other:`about {{count}} hours`},xHours:{one:`1 hour`,other:`{{count}} hours`},xDays:{one:`1 day`,other:`{{count}} days`},aboutXWeeks:{one:`about 1 week`,other:`about {{count}} weeks`},xWeeks:{one:`1 week`,other:`{{count}} weeks`},aboutXMonths:{one:`about 1 month`,other:`about {{count}} months`},xMonths:{one:`1 month`,other:`{{count}} months`},aboutXYears:{one:`about 1 year`,other:`about {{count}} years`},xYears:{one:`1 year`,other:`{{count}} years`},overXYears:{one:`over 1 year`,other:`over {{count}} years`},almostXYears:{one:`almost 1 year`,other:`almost {{count}} years`}},Po=(e,t,n)=>{let r,i=No[e];return r=typeof i==`string`?i:t===1?i.one:i.other.replace(`{{count}}`,t.toString()),n?.addSuffix?n.comparison&&n.comparison>0?`in `+r:r+` ago`:r};function Fo(e){return(t={})=>{let n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const Io={date:Fo({formats:{full:`EEEE, MMMM do, y`,long:`MMMM do, y`,medium:`MMM d, y`,short:`MM/dd/yyyy`},defaultWidth:`full`}),time:Fo({formats:{full:`h:mm:ss a zzzz`,long:`h:mm:ss a z`,medium:`h:mm:ss a`,short:`h:mm a`},defaultWidth:`full`}),dateTime:Fo({formats:{full:`{{date}} 'at' {{time}}`,long:`{{date}} 'at' {{time}}`,medium:`{{date}}, {{time}}`,short:`{{date}}, {{time}}`},defaultWidth:`full`})},Lo={lastWeek:`'last' eeee 'at' p`,yesterday:`'yesterday at' p`,today:`'today at' p`,tomorrow:`'tomorrow at' p`,nextWeek:`eeee 'at' p`,other:`P`},Ro=(e,t,n,r)=>Lo[e];function zo(e){return(t,n)=>{let r=n?.context?String(n.context):`standalone`,i;if(r===`formatting`&&e.formattingValues){let t=e.defaultFormattingWidth||e.defaultWidth,r=n?.width?String(n.width):t;i=e.formattingValues[r]||e.formattingValues[t]}else{let t=e.defaultWidth,r=n?.width?String(n.width):e.defaultWidth;i=e.values[r]||e.values[t]}let a=e.argumentCallback?e.argumentCallback(t):t;return i[a]}}const Bo={ordinalNumber:(e,t)=>{let n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+`st`;case 2:return n+`nd`;case 3:return n+`rd`}return n+`th`},era:zo({values:{narrow:[`B`,`A`],abbreviated:[`BC`,`AD`],wide:[`Before Christ`,`Anno Domini`]},defaultWidth:`wide`}),quarter:zo({values:{narrow:[`1`,`2`,`3`,`4`],abbreviated:[`Q1`,`Q2`,`Q3`,`Q4`],wide:[`1st quarter`,`2nd quarter`,`3rd quarter`,`4th quarter`]},defaultWidth:`wide`,argumentCallback:e=>e-1}),month:zo({values:{narrow:[`J`,`F`,`M`,`A`,`M`,`J`,`J`,`A`,`S`,`O`,`N`,`D`],abbreviated:[`Jan`,`Feb`,`Mar`,`Apr`,`May`,`Jun`,`Jul`,`Aug`,`Sep`,`Oct`,`Nov`,`Dec`],wide:[`January`,`February`,`March`,`April`,`May`,`June`,`July`,`August`,`September`,`October`,`November`,`December`]},defaultWidth:`wide`}),day:zo({values:{narrow:[`S`,`M`,`T`,`W`,`T`,`F`,`S`],short:[`Su`,`Mo`,`Tu`,`We`,`Th`,`Fr`,`Sa`],abbreviated:[`Sun`,`Mon`,`Tue`,`Wed`,`Thu`,`Fri`,`Sat`],wide:[`Sunday`,`Monday`,`Tuesday`,`Wednesday`,`Thursday`,`Friday`,`Saturday`]},defaultWidth:`wide`}),dayPeriod:zo({values:{narrow:{am:`a`,pm:`p`,midnight:`mi`,noon:`n`,morning:`morning`,afternoon:`afternoon`,evening:`evening`,night:`night`},abbreviated:{am:`AM`,pm:`PM`,midnight:`midnight`,noon:`noon`,morning:`morning`,afternoon:`afternoon`,evening:`evening`,night:`night`},wide:{am:`a.m.`,pm:`p.m.`,midnight:`midnight`,noon:`noon`,morning:`morning`,afternoon:`afternoon`,evening:`evening`,night:`night`}},defaultWidth:`wide`,formattingValues:{narrow:{am:`a`,pm:`p`,midnight:`mi`,noon:`n`,morning:`in the morning`,afternoon:`in the afternoon`,evening:`in the evening`,night:`at night`},abbreviated:{am:`AM`,pm:`PM`,midnight:`midnight`,noon:`noon`,morning:`in the morning`,afternoon:`in the afternoon`,evening:`in the evening`,night:`at night`},wide:{am:`a.m.`,pm:`p.m.`,midnight:`midnight`,noon:`noon`,morning:`in the morning`,afternoon:`in the afternoon`,evening:`in the evening`,night:`at night`}},defaultFormattingWidth:`wide`})};function Vo(e){return(t,n={})=>{let r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(i);if(!a)return null;let o=a[0],s=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(s)?Uo(s,e=>e.test(o)):Ho(s,e=>e.test(o)),l;l=e.valueCallback?e.valueCallback(c):c,l=n.valueCallback?n.valueCallback(l):l;let ee=t.slice(o.length);return{value:l,rest:ee}}}function Ho(e,t){for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n}function Uo(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n}function Wo(e){return(t,n={})=>{let r=t.match(e.matchPattern);if(!r)return null;let i=r[0],a=t.match(e.parsePattern);if(!a)return null;let o=e.valueCallback?e.valueCallback(a[0]):a[0];o=n.valueCallback?n.valueCallback(o):o;let s=t.slice(i.length);return{value:o,rest:s}}}const Go={ordinalNumber:Wo({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:Vo({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:`wide`,parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:`any`}),quarter:Vo({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:`wide`,parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:`any`,valueCallback:e=>e+1}),month:Vo({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:`wide`,parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:`any`}),day:Vo({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:`wide`,parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:`any`}),dayPeriod:Vo({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:`any`,parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:`any`})},Ko={code:`en-US`,formatDistance:Po,formatLong:Io,formatRelative:Ro,localize:Bo,match:Go,options:{weekStartsOn:0,firstWeekContainsDate:1}};function qo(e,t){let n=w(e,t?.in);return Oo(n,Mo(n))+1}function Jo(e,t){let n=w(e,t?.in),r=Co(n)-+ko(n);return Math.round(r/go)+1}function Yo(e,t){let n=w(e,t?.in),r=n.getFullYear(),i=xo(),a=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,o=yo(t?.in||e,0);o.setFullYear(r+1,0,a),o.setHours(0,0,0,0);let s=So(o,t),c=yo(t?.in||e,0);c.setFullYear(r,0,a),c.setHours(0,0,0,0);let l=So(c,t);return+n>=+s?r+1:+n>=+l?r:r-1}function Xo(e,t){let n=xo(),r=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,i=Yo(e,t),a=yo(t?.in||e,0);return a.setFullYear(i,0,r),a.setHours(0,0,0,0),So(a,t)}function Zo(e,t){let n=w(e,t?.in),r=So(n,t)-+Xo(n,t);return Math.round(r/go)+1}function T(e,t){let n=e<0?`-`:``,r=Math.abs(e).toString().padStart(t,`0`);return n+r}const Qo={y(e,t){let n=e.getFullYear(),r=n>0?n:1-n;return T(t===`yy`?r%100:r,t.length)},M(e,t){let n=e.getMonth();return t===`M`?String(n+1):T(n+1,2)},d(e,t){return T(e.getDate(),t.length)},a(e,t){let n=e.getHours()/12>=1?`pm`:`am`;switch(t){case`a`:case`aa`:return n.toUpperCase();case`aaa`:return n;case`aaaaa`:return n[0];case`aaaa`:default:return n===`am`?`a.m.`:`p.m.`}},h(e,t){return T(e.getHours()%12||12,t.length)},H(e,t){return T(e.getHours(),t.length)},m(e,t){return T(e.getMinutes(),t.length)},s(e,t){return T(e.getSeconds(),t.length)},S(e,t){let n=t.length,r=e.getMilliseconds(),i=Math.trunc(r*10**(n-3));return T(i,t.length)}},$o={am:`am`,pm:`pm`,midnight:`midnight`,noon:`noon`,morning:`morning`,afternoon:`afternoon`,evening:`evening`,night:`night`},es={G:function(e,t,n){let r=e.getFullYear()>0?1:0;switch(t){case`G`:case`GG`:case`GGG`:return n.era(r,{width:`abbreviated`});case`GGGGG`:return n.era(r,{width:`narrow`});case`GGGG`:default:return n.era(r,{width:`wide`})}},y:function(e,t,n){if(t===`yo`){let t=e.getFullYear(),r=t>0?t:1-t;return n.ordinalNumber(r,{unit:`year`})}return Qo.y(e,t)},Y:function(e,t,n,r){let i=Yo(e,r),a=i>0?i:1-i;if(t===`YY`){let e=a%100;return T(e,2)}return t===`Yo`?n.ordinalNumber(a,{unit:`year`}):T(a,t.length)},R:function(e,t){let n=wo(e);return T(n,t.length)},u:function(e,t){let n=e.getFullYear();return T(n,t.length)},Q:function(e,t,n){let r=Math.ceil((e.getMonth()+1)/3);switch(t){case`Q`:return String(r);case`QQ`:return T(r,2);case`Qo`:return n.ordinalNumber(r,{unit:`quarter`});case`QQQ`:return n.quarter(r,{width:`abbreviated`,context:`formatting`});case`QQQQQ`:return n.quarter(r,{width:`narrow`,context:`formatting`});case`QQQQ`:default:return n.quarter(r,{width:`wide`,context:`formatting`})}},q:function(e,t,n){let r=Math.ceil((e.getMonth()+1)/3);switch(t){case`q`:return String(r);case`qq`:return T(r,2);case`qo`:return n.ordinalNumber(r,{unit:`quarter`});case`qqq`:return n.quarter(r,{width:`abbreviated`,context:`standalone`});case`qqqqq`:return n.quarter(r,{width:`narrow`,context:`standalone`});case`qqqq`:default:return n.quarter(r,{width:`wide`,context:`standalone`})}},M:function(e,t,n){let r=e.getMonth();switch(t){case`M`:case`MM`:return Qo.M(e,t);case`Mo`:return n.ordinalNumber(r+1,{unit:`month`});case`MMM`:return n.month(r,{width:`abbreviated`,context:`formatting`});case`MMMMM`:return n.month(r,{width:`narrow`,context:`formatting`});case`MMMM`:default:return n.month(r,{width:`wide`,context:`formatting`})}},L:function(e,t,n){let r=e.getMonth();switch(t){case`L`:return String(r+1);case`LL`:return T(r+1,2);case`Lo`:return n.ordinalNumber(r+1,{unit:`month`});case`LLL`:return n.month(r,{width:`abbreviated`,context:`standalone`});case`LLLLL`:return n.month(r,{width:`narrow`,context:`standalone`});case`LLLL`:default:return n.month(r,{width:`wide`,context:`standalone`})}},w:function(e,t,n,r){let i=Zo(e,r);return t===`wo`?n.ordinalNumber(i,{unit:`week`}):T(i,t.length)},I:function(e,t,n){let r=Jo(e);return t===`Io`?n.ordinalNumber(r,{unit:`week`}):T(r,t.length)},d:function(e,t,n){return t===`do`?n.ordinalNumber(e.getDate(),{unit:`date`}):Qo.d(e,t)},D:function(e,t,n){let r=qo(e);return t===`Do`?n.ordinalNumber(r,{unit:`dayOfYear`}):T(r,t.length)},E:function(e,t,n){let r=e.getDay();switch(t){case`E`:case`EE`:case`EEE`:return n.day(r,{width:`abbreviated`,context:`formatting`});case`EEEEE`:return n.day(r,{width:`narrow`,context:`formatting`});case`EEEEEE`:return n.day(r,{width:`short`,context:`formatting`});case`EEEE`:default:return n.day(r,{width:`wide`,context:`formatting`})}},e:function(e,t,n,r){let i=e.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case`e`:return String(a);case`ee`:return T(a,2);case`eo`:return n.ordinalNumber(a,{unit:`day`});case`eee`:return n.day(i,{width:`abbreviated`,context:`formatting`});case`eeeee`:return n.day(i,{width:`narrow`,context:`formatting`});case`eeeeee`:return n.day(i,{width:`short`,context:`formatting`});case`eeee`:default:return n.day(i,{width:`wide`,context:`formatting`})}},c:function(e,t,n,r){let i=e.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case`c`:return String(a);case`cc`:return T(a,t.length);case`co`:return n.ordinalNumber(a,{unit:`day`});case`ccc`:return n.day(i,{width:`abbreviated`,context:`standalone`});case`ccccc`:return n.day(i,{width:`narrow`,context:`standalone`});case`cccccc`:return n.day(i,{width:`short`,context:`standalone`});case`cccc`:default:return n.day(i,{width:`wide`,context:`standalone`})}},i:function(e,t,n){let r=e.getDay(),i=r===0?7:r;switch(t){case`i`:return String(i);case`ii`:return T(i,t.length);case`io`:return n.ordinalNumber(i,{unit:`day`});case`iii`:return n.day(r,{width:`abbreviated`,context:`formatting`});case`iiiii`:return n.day(r,{width:`narrow`,context:`formatting`});case`iiiiii`:return n.day(r,{width:`short`,context:`formatting`});case`iiii`:default:return n.day(r,{width:`wide`,context:`formatting`})}},a:function(e,t,n){let r=e.getHours()/12>=1?`pm`:`am`;switch(t){case`a`:case`aa`:return n.dayPeriod(r,{width:`abbreviated`,context:`formatting`});case`aaa`:return n.dayPeriod(r,{width:`abbreviated`,context:`formatting`}).toLowerCase();case`aaaaa`:return n.dayPeriod(r,{width:`narrow`,context:`formatting`});case`aaaa`:default:return n.dayPeriod(r,{width:`wide`,context:`formatting`})}},b:function(e,t,n){let r=e.getHours(),i;switch(i=r===12?$o.noon:r===0?$o.midnight:r/12>=1?`pm`:`am`,t){case`b`:case`bb`:return n.dayPeriod(i,{width:`abbreviated`,context:`formatting`});case`bbb`:return n.dayPeriod(i,{width:`abbreviated`,context:`formatting`}).toLowerCase();case`bbbbb`:return n.dayPeriod(i,{width:`narrow`,context:`formatting`});case`bbbb`:default:return n.dayPeriod(i,{width:`wide`,context:`formatting`})}},B:function(e,t,n){let r=e.getHours(),i;switch(i=r>=17?$o.evening:r>=12?$o.afternoon:r>=4?$o.morning:$o.night,t){case`B`:case`BB`:case`BBB`:return n.dayPeriod(i,{width:`abbreviated`,context:`formatting`});case`BBBBB`:return n.dayPeriod(i,{width:`narrow`,context:`formatting`});case`BBBB`:default:return n.dayPeriod(i,{width:`wide`,context:`formatting`})}},h:function(e,t,n){if(t===`ho`){let t=e.getHours()%12;return t===0&&(t=12),n.ordinalNumber(t,{unit:`hour`})}return Qo.h(e,t)},H:function(e,t,n){return t===`Ho`?n.ordinalNumber(e.getHours(),{unit:`hour`}):Qo.H(e,t)},K:function(e,t,n){let r=e.getHours()%12;return t===`Ko`?n.ordinalNumber(r,{unit:`hour`}):T(r,t.length)},k:function(e,t,n){let r=e.getHours();return r===0&&(r=24),t===`ko`?n.ordinalNumber(r,{unit:`hour`}):T(r,t.length)},m:function(e,t,n){return t===`mo`?n.ordinalNumber(e.getMinutes(),{unit:`minute`}):Qo.m(e,t)},s:function(e,t,n){return t===`so`?n.ordinalNumber(e.getSeconds(),{unit:`second`}):Qo.s(e,t)},S:function(e,t){return Qo.S(e,t)},X:function(e,t,n){let r=e.getTimezoneOffset();if(r===0)return`Z`;switch(t){case`X`:return ns(r);case`XXXX`:case`XX`:return rs(r);case`XXXXX`:case`XXX`:default:return rs(r,`:`)}},x:function(e,t,n){let r=e.getTimezoneOffset();switch(t){case`x`:return ns(r);case`xxxx`:case`xx`:return rs(r);case`xxxxx`:case`xxx`:default:return rs(r,`:`)}},O:function(e,t,n){let r=e.getTimezoneOffset();switch(t){case`O`:case`OO`:case`OOO`:return`GMT`+ts(r,`:`);case`OOOO`:default:return`GMT`+rs(r,`:`)}},z:function(e,t,n){let r=e.getTimezoneOffset();switch(t){case`z`:case`zz`:case`zzz`:return`GMT`+ts(r,`:`);case`zzzz`:default:return`GMT`+rs(r,`:`)}},t:function(e,t,n){let r=Math.trunc(e/1e3);return T(r,t.length)},T:function(e,t,n){return T(+e,t.length)}};function ts(e,t=``){let n=e>0?`-`:`+`,r=Math.abs(e),i=Math.trunc(r/60),a=r%60;return a===0?n+String(i):n+String(i)+t+T(a,2)}function ns(e,t){return e%60==0?(e>0?`-`:`+`)+T(Math.abs(e)/60,2):rs(e,t)}function rs(e,t=``){let n=e>0?`-`:`+`,r=Math.abs(e),i=T(Math.trunc(r/60),2),a=T(r%60,2);return n+i+t+a}const os=(e,t)=>{switch(e){case`P`:return t.date({width:`short`});case`PP`:return t.date({width:`medium`});case`PPP`:return t.date({width:`long`});case`PPPP`:default:return t.date({width:`full`})}},ss=(e,t)=>{switch(e){case`p`:return t.time({width:`short`});case`pp`:return t.time({width:`medium`});case`ppp`:return t.time({width:`long`});case`pppp`:default:return t.time({width:`full`})}},cs={p:ss,P:(e,t)=>{let n=e.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return os(e,t);let a;switch(r){case`P`:a=t.dateTime({width:`short`});break;case`PP`:a=t.dateTime({width:`medium`});break;case`PPP`:a=t.dateTime({width:`long`});break;case`PPPP`:default:a=t.dateTime({width:`full`});break}return a.replace(`{{date}}`,os(r,t)).replace(`{{time}}`,ss(i,t))}},ls=/^D+$/,us=/^Y+$/,ds=[`D`,`DD`,`YY`,`YYYY`];function fs(e){return ls.test(e)}function ps(e){return us.test(e)}function ms(e,t,n){let r=hs(e,t,n);if(console.warn(r),ds.includes(e))throw RangeError(r)}function hs(e,t,n){let r=e[0]===`Y`?`years`:`days of the month`;return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const gs=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_s=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,vs=/^'([^]*?)'?$/,ys=/''/g,bs=/[a-zA-Z]/;function xs(e,t,n){let r=xo(),i=n?.locale??r.locale??Ko,a=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,o=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,s=w(e,n?.in);if(!jo(s))throw RangeError(`Invalid time value`);let c=t.match(_s).map(e=>{let t=e[0];if(t===`p`||t===`P`){let n=cs[t];return n(e,i.formatLong)}return e}).join(``).match(gs).map(e=>{if(e===`''`)return{isToken:!1,value:`'`};let t=e[0];if(t===`'`)return{isToken:!1,value:Ss(e)};if(es[t])return{isToken:!0,value:e};if(t.match(bs))throw RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});i.localize.preprocessor&&(c=i.localize.preprocessor(s,c));let l={firstWeekContainsDate:a,weekStartsOn:o,locale:i};return c.map(r=>{if(!r.isToken)return r.value;let a=r.value;(!n?.useAdditionalWeekYearTokens&&ps(a)||!n?.useAdditionalDayOfYearTokens&&fs(a))&&ms(a,t,String(e));let o=es[a[0]];return o(s,a,i.localize,l)}).join(``)}function Ss(e){let t=e.match(vs);return t?t[1].replace(ys,`'`):e}function Cs(e){return e===void 0||e===void 0}function E(e){return typeof e==`string`}function ws(e){return typeof e==`number`}function Ts(e){return typeof e==`boolean`}function Es(e){return e===null}function Ds(e){return e instanceof Date}function Os(e){return typeof e==`bigint`}function D(e){return typeof e==`function`}function ks(e){return typeof e==`object`&&!!e}function O(e){return Object.freeze(e)}function As(e){return js(e)?e:[e]}function js(e){return Array.isArray(e)}function Ms(e){return e}const k=O({is(e){return e.kind===`AlterTableNode`},create(e){return O({kind:`AlterTableNode`,table:e})},cloneWithTableProps(e,t){return O({...e,...t})},cloneWithColumnAlteration(e,t){return O({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})}}),A=O({is(e){return e.kind===`IdentifierNode`},create(e){return O({kind:`IdentifierNode`,name:e})}}),Ns=O({is(e){return e.kind===`CreateIndexNode`},create(e){return O({kind:`CreateIndexNode`,name:A.create(e)})},cloneWith(e,t){return O({...e,...t})},cloneWithColumns(e,t){return O({...e,columns:[...e.columns||[],...t]})}}),Ps=O({is(e){return e.kind===`CreateSchemaNode`},create(e,t){return O({kind:`CreateSchemaNode`,schema:A.create(e),...t})},cloneWith(e,t){return O({...e,...t})}}),Fs=[`preserve rows`,`delete rows`,`drop`],j=O({is(e){return e.kind===`CreateTableNode`},create(e){return O({kind:`CreateTableNode`,table:e,columns:O([])})},cloneWithColumn(e,t){return O({...e,columns:O([...e.columns,t])})},cloneWithConstraint(e,t){return O({...e,constraints:e.constraints?O([...e.constraints,t]):O([t])})},cloneWithFrontModifier(e,t){return O({...e,frontModifiers:e.frontModifiers?O([...e.frontModifiers,t]):O([t])})},cloneWithEndModifier(e,t){return O({...e,endModifiers:e.endModifiers?O([...e.endModifiers,t]):O([t])})},cloneWith(e,t){return O({...e,...t})}}),Is=O({is(e){return e.kind===`SchemableIdentifierNode`},create(e){return O({kind:`SchemableIdentifierNode`,identifier:A.create(e)})},createWithSchema(e,t){return O({kind:`SchemableIdentifierNode`,schema:A.create(e),identifier:A.create(t)})}}),Ls=O({is(e){return e.kind===`DropIndexNode`},create(e,t){return O({kind:`DropIndexNode`,name:Is.create(e),...t})},cloneWith(e,t){return O({...e,...t})}}),Rs=O({is(e){return e.kind===`DropSchemaNode`},create(e,t){return O({kind:`DropSchemaNode`,schema:A.create(e),...t})},cloneWith(e,t){return O({...e,...t})}}),zs=O({is(e){return e.kind===`DropTableNode`},create(e,t){return O({kind:`DropTableNode`,table:e,...t})},cloneWith(e,t){return O({...e,...t})}}),Bs=O({is(e){return e.kind===`AliasNode`},create(e,t){return O({kind:`AliasNode`,node:e,alias:t})}}),Vs=O({is(e){return e.kind===`TableNode`},create(e){return O({kind:`TableNode`,table:Is.create(e)})},createWithSchema(e,t){return O({kind:`TableNode`,table:Is.createWithSchema(e,t)})}});function M(e){return ks(e)&&D(e.toOperationNode)}function Hs(e){return ks(e)&&`expressionType`in e&&M(e)}function Us(e){return ks(e)&&`expression`in e&&E(e.alias)&&M(e)}const Ws=O({is(e){return e.kind===`SelectModifierNode`},create(e,t){return O({kind:`SelectModifierNode`,modifier:e,of:t})},createWithExpression(e){return O({kind:`SelectModifierNode`,rawModifier:e})}}),Gs=O({is(e){return e.kind===`AndNode`},create(e,t){return O({kind:`AndNode`,left:e,right:t})}}),Ks=O({is(e){return e.kind===`OrNode`},create(e,t){return O({kind:`OrNode`,left:e,right:t})}}),qs=O({is(e){return e.kind===`OnNode`},create(e){return O({kind:`OnNode`,on:e})},cloneWithOperation(e,t,n){return O({...e,on:t===`And`?Gs.create(e.on,n):Ks.create(e.on,n)})}}),Js=O({is(e){return e.kind===`JoinNode`},create(e,t){return O({kind:`JoinNode`,joinType:e,table:t,on:void 0})},createWithOn(e,t,n){return O({kind:`JoinNode`,joinType:e,table:t,on:qs.create(n)})},cloneWithOn(e,t){return O({...e,on:e.on?qs.cloneWithOperation(e.on,`And`,t):qs.create(t)})}}),Ys=O({is(e){return e.kind===`BinaryOperationNode`},create(e,t,n){return O({kind:`BinaryOperationNode`,leftOperand:e,operator:t,rightOperand:n})}}),Xs=`=.==.!=.<>.>.>=.<.<=.in.not in.is.is not.like.not like.match.ilike.not ilike.@>.<@.^@.&&.?.?&.?|.!<.!>.<=>.!~.~.~*.!~*.@@.@@@.!!.<->.regexp.is distinct from.is not distinct from`.split(`.`),Zs=[`+`,`-`,`*`,`/`,`%`,`^`,`&`,`|`,`#`,`<<`,`>>`],Qs=[`->`,`->>`],$s=[...Xs,...Zs,`&&`,`||`],ec=[`not`,`-`,...[`exists`,`not exists`]],tc=[...$s,...Qs,...ec,`between`,`between symmetric`],nc=O({is(e){return e.kind===`OperatorNode`},create(e){return O({kind:`OperatorNode`,operator:e})}});function rc(e){return E(e)&&Qs.includes(e)}const N=O({is(e){return e.kind===`ColumnNode`},create(e){return O({kind:`ColumnNode`,column:A.create(e)})}}),ic=O({is(e){return e.kind===`SelectAllNode`},create(){return O({kind:`SelectAllNode`})}}),ac=O({is(e){return e.kind===`ReferenceNode`},create(e,t){return O({kind:`ReferenceNode`,table:t,column:e})},createSelectAll(e){return O({kind:`ReferenceNode`,table:e,column:ic.create()})}});var oc=class{#dynamicReference;get dynamicReference(){return this.#dynamicReference}get refType(){}constructor(e){this.#dynamicReference=e}toOperationNode(){return _c(this.#dynamicReference)}};function sc(e){return ks(e)&&M(e)&&E(e.dynamicReference)}const cc=O({is(e){return e.kind===`OrderByItemNode`},create(e,t){return O({kind:`OrderByItemNode`,orderBy:e,direction:t})}}),P=O({is(e){return e.kind===`RawNode`},create(e,t){return O({kind:`RawNode`,sqlFragments:O(e),parameters:O(t)})},createWithSql(e){return P.create([e],[])},createWithChild(e){return P.create([``,``],[e])},createWithChildren(e){return P.create(Array(e.length+1).fill(``),e)}});function lc(e){return e===`asc`||e===`desc`}function uc(e){if(e.length===2)return[dc(e[0],e[1])];if(e.length===1){let[t]=e;return Array.isArray(t)?t.map(e=>dc(e)):[dc(t)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function dc(e,t){let n=fc(e);if(cc.is(n)){if(t)throw Error(`Cannot specify direction twice!`);return n}return cc.create(n,pc(t))}function fc(e){if(rd(e))return td(e);if(sc(e))return e.toOperationNode();let[t,n]=e.split(` `);if(n){if(!lc(n))throw Error(`Invalid order by direction: ${n}`);return cc.create(bc(t),pc(n))}return bc(e)}function pc(e){if(e)return e===`asc`||e===`desc`?P.createWithSql(e):e.toOperationNode()}const mc=O({is(e){return e.kind===`JSONReferenceNode`},create(e,t){return O({kind:`JSONReferenceNode`,reference:e,traversal:t})},cloneWithTraversal(e,t){return O({...e,traversal:t})}}),hc=O({is(e){return e.kind===`JSONOperatorChainNode`},create(e){return O({kind:`JSONOperatorChainNode`,operator:e,values:O([])})},cloneWithValue(e,t){return O({...e,values:O([...e.values,t])})}}),gc=O({is(e){return e.kind===`JSONPathNode`},create(e){return O({kind:`JSONPathNode`,inOperator:e,pathLegs:O([])})},cloneWithLeg(e,t){return O({...e,pathLegs:O([...e.pathLegs,t])})}});function _c(e){return E(e)?bc(e):e.toOperationNode()}function vc(e){return js(e)?e.map(e=>F(e)):[F(e)]}function F(e){return rd(e)?td(e):_c(e)}function yc(e,t){let n=bc(e);if(rc(t))return mc.create(n,hc.create(nc.create(t)));let r=t.slice(0,-1);if(rc(r))return mc.create(n,gc.create(nc.create(r)));throw Error(`Invalid JSON operator: ${t}`)}function bc(e){if(!e.includes(`.`))return ac.create(N.create(e));let t=e.split(`.`).map(Ec);if(t.length===3)return wc(t);if(t.length===2)return Tc(t);throw Error(`invalid column reference ${e}`)}function xc(e){let t=` as `;if(e.includes(t)){let[n,r]=e.split(t).map(Ec);return Bs.create(bc(n),A.create(r))}else return bc(e)}function Sc(e){return N.create(e)}function Cc(e){if(e.includes(` `)){let[t,n]=e.split(` `).map(Ec);if(!lc(n))throw Error(`invalid order direction "${n}" next to "${t}"`);return uc([t,n])[0]}else return Sc(e)}function wc(e){let[t,n,r]=e;return ac.create(N.create(r),Vs.createWithSchema(t,n))}function Tc(e){let[t,n]=e;return ac.create(N.create(n),Vs.create(t))}function Ec(e){return e.trim()}const Dc=O({is(e){return e.kind===`PrimitiveValueListNode`},create(e){return O({kind:`PrimitiveValueListNode`,values:O([...e])})}}),Oc=O({is(e){return e.kind===`ValueListNode`},create(e){return O({kind:`ValueListNode`,values:O(e)})}}),I=O({is(e){return e.kind===`ValueNode`},create(e){return O({kind:`ValueNode`,value:e})},createImmediate(e){return O({kind:`ValueNode`,value:e,immediate:!0})}});function kc(e){return js(e)?Mc(e):L(e)}function L(e){return rd(e)?td(e):I.create(e)}function Ac(e){return ws(e)||Ts(e)||Es(e)}function jc(e){if(!Ac(e))throw Error(`unsafe immediate value ${JSON.stringify(e)}`);return I.createImmediate(e)}function Mc(e){return e.some(rd)?Oc.create(e.map(e=>L(e))):Dc.create(e)}const Nc=O({is(e){return e.kind===`ParensNode`},create(e){return O({kind:`ParensNode`,node:e})}});function R(e){if(e.length===3)return Pc(e[0],e[1],e[2]);if(e.length===1)return L(e[0]);throw Error(`invalid arguments: ${JSON.stringify(e)}`)}function Pc(e,t,n){return Rc(t)&&zc(n)?Ys.create(F(e),Bc(t),I.createImmediate(n)):Ys.create(F(e),Bc(t),kc(n))}function Fc(e,t,n){return Ys.create(F(e),Bc(t),F(n))}function Ic(e,t){return Lc(Object.entries(e).filter(([,e])=>!Cs(e)).map(([e,t])=>Pc(e,zc(t)?`is`:`=`,t)),t)}function Lc(e,t,n=!0){let r=t===`and`?Gs.create:Ks.create;if(e.length===0)return Ys.create(I.createImmediate(1),nc.create(`=`),I.createImmediate(t===`and`?1:0));let i=Vc(e[0]);for(let t=1;t<e.length;++t)i=r(i,Vc(e[t]));return e.length>1&&n?Nc.create(i):i}function Rc(e){return e===`is`||e===`is not`}function zc(e){return Es(e)||Ts(e)}function Bc(e){if(E(e)&&tc.includes(e))return nc.create(e);if(M(e))return e.toOperationNode();throw Error(`invalid operator ${JSON.stringify(e)}`)}function Vc(e){return M(e)?e.toOperationNode():e}const Hc=O({is(e){return e.kind===`OrderByNode`},create(e){return O({kind:`OrderByNode`,items:O([...e])})},cloneWithItems(e,t){return O({...e,items:O([...e.items,...t])})}}),Uc=O({is(e){return e.kind===`PartitionByNode`},create(e){return O({kind:`PartitionByNode`,items:O(e)})},cloneWithItems(e,t){return O({...e,items:O([...e.items,...t])})}}),Wc=O({is(e){return e.kind===`OverNode`},create(){return O({kind:`OverNode`})},cloneWithOrderByItems(e,t){return O({...e,orderBy:e.orderBy?Hc.cloneWithItems(e.orderBy,t):Hc.create(t)})},cloneWithPartitionByItems(e,t){return O({...e,partitionBy:e.partitionBy?Uc.cloneWithItems(e.partitionBy,t):Uc.create(t)})}}),Gc=O({is(e){return e.kind===`FromNode`},create(e){return O({kind:`FromNode`,froms:O(e)})},cloneWithFroms(e,t){return O({...e,froms:O([...e.froms,...t])})}}),Kc=O({is(e){return e.kind===`GroupByNode`},create(e){return O({kind:`GroupByNode`,items:O(e)})},cloneWithItems(e,t){return O({...e,items:O([...e.items,...t])})}}),qc=O({is(e){return e.kind===`HavingNode`},create(e){return O({kind:`HavingNode`,having:e})},cloneWithOperation(e,t,n){return O({...e,having:t===`And`?Gs.create(e.having,n):Ks.create(e.having,n)})}}),z=O({is(e){return e.kind===`SelectQueryNode`},create(e){return O({kind:`SelectQueryNode`,...e&&{with:e}})},createFrom(e,t){return O({kind:`SelectQueryNode`,from:Gc.create(e),...t&&{with:t}})},cloneWithSelections(e,t){return O({...e,selections:e.selections?O([...e.selections,...t]):O(t)})},cloneWithDistinctOn(e,t){return O({...e,distinctOn:e.distinctOn?O([...e.distinctOn,...t]):O(t)})},cloneWithFrontModifier(e,t){return O({...e,frontModifiers:e.frontModifiers?O([...e.frontModifiers,t]):O([t])})},cloneWithOrderByItems(e,t){return O({...e,orderBy:e.orderBy?Hc.cloneWithItems(e.orderBy,t):Hc.create(t)})},cloneWithGroupByItems(e,t){return O({...e,groupBy:e.groupBy?Kc.cloneWithItems(e.groupBy,t):Kc.create(t)})},cloneWithLimit(e,t){return O({...e,limit:t})},cloneWithOffset(e,t){return O({...e,offset:t})},cloneWithFetch(e,t){return O({...e,fetch:t})},cloneWithHaving(e,t){return O({...e,having:e.having?qc.cloneWithOperation(e.having,`And`,t):qc.create(t)})},cloneWithSetOperations(e,t){return O({...e,setOperations:e.setOperations?O([...e.setOperations,...t]):O([...t])})},cloneWithoutSelections(e){return O({...e,selections:[]})},cloneWithoutLimit(e){return O({...e,limit:void 0})},cloneWithoutOffset(e){return O({...e,offset:void 0})},cloneWithoutOrderBy(e){return O({...e,orderBy:void 0})},cloneWithoutGroupBy(e){return O({...e,groupBy:void 0})}});function B(e,t){Object.defineProperties(e.prototype,{then:{enumerable:!1,value:()=>{throw Error(t)}}})}var Jc=class e{#props;constructor(e){this.#props=O(e)}on(...t){return new e({...this.#props,joinNode:Js.cloneWithOn(this.#props.joinNode,R(t))})}onRef(t,n,r){return new e({...this.#props,joinNode:Js.cloneWithOn(this.#props.joinNode,Fc(t,n,r))})}onTrue(){return new e({...this.#props,joinNode:Js.cloneWithOn(this.#props.joinNode,P.createWithSql(`true`))})}$call(e){return e(this)}toOperationNode(){return this.#props.joinNode}};B(Jc,`don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.`);const Yc=O({is(e){return e.kind===`PartitionByItemNode`},create(e){return O({kind:`PartitionByItemNode`,partitionBy:e})}});function Xc(e){return vc(e).map(Yc.create)}var Zc=class e{#props;constructor(e){this.#props=O(e)}orderBy(t,n){return new e({overNode:Wc.cloneWithOrderByItems(this.#props.overNode,uc([t,n]))})}partitionBy(t){return new e({overNode:Wc.cloneWithPartitionByItems(this.#props.overNode,Xc(t))})}$call(e){return e(this)}toOperationNode(){return this.#props.overNode}};B(Zc,`don't await OverBuilder instances. They are never executed directly and are always just a part of a query.`);const Qc=O({is(e){return e.kind===`SelectionNode`},create(e){return O({kind:`SelectionNode`,selection:e})},createSelectAll(){return O({kind:`SelectionNode`,selection:ic.create()})},createSelectAllFromTable(e){return O({kind:`SelectionNode`,selection:ac.createSelectAll(e)})}});function V(e){return D(e)?V(e(ed())):js(e)?e.map(e=>$c(e)):[$c(e)]}function $c(e){return E(e)?Qc.create(xc(e)):sc(e)?Qc.create(e.toOperationNode()):Qc.create(nd(e))}function el(e){return e?Array.isArray(e)?e.map(tl):[tl(e)]:[Qc.createSelectAll()]}function tl(e){if(E(e))return Qc.createSelectAllFromTable(Q(e));throw Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}const nl=O({is(e){return e.kind===`ValuesNode`},create(e){return O({kind:`ValuesNode`,values:O(e)})}}),rl=O({is(e){return e.kind===`DefaultInsertValueNode`},create(){return O({kind:`DefaultInsertValueNode`})}});function il(e){let t=D(e)?e(ed()):e,n=js(t)?t:O([t]);return al(n)}function al(e){let t=ol(e);return[O([...t.keys()].map(N.create)),nl.create(e.map(e=>sl(e,t)))]}function ol(e){let t=new Map;for(let n of e){let e=Object.keys(n);for(let r of e)!t.has(r)&&n[r]!==void 0&&t.set(r,t.size)}return t}function sl(e,t){let n=Object.keys(e),r=Array.from({length:t.size}),i=!1,a=n.length;for(let o of n){let n=t.get(o);if(Cs(n)){a--;continue}let s=e[o];(Cs(s)||rd(s))&&(i=!0),r[n]=s}if(a<t.size||i){let e=rl.create();return Oc.create(r.map(t=>Cs(t)?e:L(t)))}return Dc.create(r)}const H=O({is(e){return e.kind===`InsertQueryNode`},create(e,t,n){return O({kind:`InsertQueryNode`,into:e,...t&&{with:t},replace:n})},createWithoutInto(){return O({kind:`InsertQueryNode`})},cloneWith(e,t){return O({...e,...t})}}),cl=O({is(e){return e.kind===`UpdateQueryNode`},create(e,t){return O({kind:`UpdateQueryNode`,table:e,...t&&{with:t}})},createWithoutTable(){return O({kind:`UpdateQueryNode`})},cloneWithFromItems(e,t){return O({...e,from:e.from?Gc.cloneWithFroms(e.from,t):Gc.create(t)})},cloneWithUpdates(e,t){return O({...e,updates:e.updates?O([...e.updates,...t]):t})},cloneWithLimit(e,t){return O({...e,limit:t})}}),ll=O({is(e){return e.kind===`UsingNode`},create(e){return O({kind:`UsingNode`,tables:O(e)})},cloneWithTables(e,t){return O({...e,tables:O([...e.tables,...t])})}}),ul=O({is(e){return e.kind===`DeleteQueryNode`},create(e,t){return O({kind:`DeleteQueryNode`,from:Gc.create(e),...t&&{with:t}})},cloneWithOrderByItems(e,t){return O({...e,orderBy:e.orderBy?Hc.cloneWithItems(e.orderBy,t):Hc.create(t)})},cloneWithoutOrderBy(e){return O({...e,orderBy:void 0})},cloneWithLimit(e,t){return O({...e,limit:t})},cloneWithoutLimit(e){return O({...e,limit:void 0})},cloneWithUsing(e,t){return O({...e,using:e.using===void 0?ll.create(t):ll.cloneWithTables(e.using,t)})}}),U=O({is(e){return e.kind===`WhereNode`},create(e){return O({kind:`WhereNode`,where:e})},cloneWithOperation(e,t,n){return O({...e,where:t===`And`?Gs.create(e.where,n):Ks.create(e.where,n)})}}),dl=O({is(e){return e.kind===`ReturningNode`},create(e){return O({kind:`ReturningNode`,selections:O(e)})},cloneWithSelections(e,t){return O({...e,selections:e.selections?O([...e.selections,...t]):O(t)})}}),fl=O({is(e){return e.kind===`ExplainNode`},create(e,t){return O({kind:`ExplainNode`,format:e,options:t})}}),pl=O({is(e){return e.kind===`WhenNode`},create(e){return O({kind:`WhenNode`,condition:e})},cloneWithResult(e,t){return O({...e,result:t})}}),W=O({is(e){return e.kind===`MergeQueryNode`},create(e,t){return O({kind:`MergeQueryNode`,into:e,...t&&{with:t}})},cloneWithUsing(e,t){return O({...e,using:t})},cloneWithWhen(e,t){return O({...e,whens:e.whens?O([...e.whens,t]):O([t])})},cloneWithThen(e,t){return O({...e,whens:e.whens?O([...e.whens.slice(0,-1),pl.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}}),ml=O({is(e){return e.kind===`OutputNode`},create(e){return O({kind:`OutputNode`,selections:O(e)})},cloneWithSelections(e,t){return O({...e,selections:e.selections?O([...e.selections,...t]):O(t)})}}),G=O({is(e){return z.is(e)||H.is(e)||cl.is(e)||ul.is(e)||W.is(e)},cloneWithEndModifier(e,t){return O({...e,endModifiers:e.endModifiers?O([...e.endModifiers,t]):O([t])})},cloneWithWhere(e,t){return O({...e,where:e.where?U.cloneWithOperation(e.where,`And`,t):U.create(t)})},cloneWithJoin(e,t){return O({...e,joins:e.joins?O([...e.joins,t]):O([t])})},cloneWithReturning(e,t){return O({...e,returning:e.returning?dl.cloneWithSelections(e.returning,t):dl.create(t)})},cloneWithoutReturning(e){return O({...e,returning:void 0})},cloneWithoutWhere(e){return O({...e,where:void 0})},cloneWithExplain(e,t,n){return O({...e,explain:fl.create(t,n?.toOperationNode())})},cloneWithTop(e,t){return O({...e,top:t})},cloneWithOutput(e,t){return O({...e,output:e.output?ml.cloneWithSelections(e.output,t):ml.create(t)})}}),hl=O({is(e){return e.kind===`ColumnUpdateNode`},create(e,t){return O({kind:`ColumnUpdateNode`,column:e,value:t})}});function gl(...e){return e.length===2?[hl.create(F(e[0]),L(e[1]))]:_l(e[0])}function _l(e){let t=D(e)?e(ed()):e;return Object.entries(t).filter(([e,t])=>t!==void 0).map(([e,t])=>hl.create(N.create(e),L(t)))}const vl=O({is(e){return e.kind===`OnDuplicateKeyNode`},create(e){return O({kind:`OnDuplicateKeyNode`,updates:e})}});var yl=class{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}},bl=class extends Error{node;constructor(e){super(`no result`),this.node=e}};function xl(e){return Object.prototype.hasOwnProperty.call(e,`prototype`)}const K=O({is(e){return e.kind===`OnConflictNode`},create(){return O({kind:`OnConflictNode`})},cloneWith(e,t){return O({...e,...t})},cloneWithIndexWhere(e,t){return O({...e,indexWhere:e.indexWhere?U.cloneWithOperation(e.indexWhere,`And`,t):U.create(t)})},cloneWithIndexOrWhere(e,t){return O({...e,indexWhere:e.indexWhere?U.cloneWithOperation(e.indexWhere,`Or`,t):U.create(t)})},cloneWithUpdateWhere(e,t){return O({...e,updateWhere:e.updateWhere?U.cloneWithOperation(e.updateWhere,`And`,t):U.create(t)})},cloneWithUpdateOrWhere(e,t){return O({...e,updateWhere:e.updateWhere?U.cloneWithOperation(e.updateWhere,`Or`,t):U.create(t)})},cloneWithoutIndexWhere(e){return O({...e,indexWhere:void 0})},cloneWithoutUpdateWhere(e){return O({...e,updateWhere:void 0})}});var Sl=class e{#props;constructor(e){this.#props=O(e)}column(t){let n=N.create(t);return new e({...this.#props,onConflictNode:K.cloneWith(this.#props.onConflictNode,{columns:this.#props.onConflictNode.columns?O([...this.#props.onConflictNode.columns,n]):O([n])})})}columns(t){let n=t.map(N.create);return new e({...this.#props,onConflictNode:K.cloneWith(this.#props.onConflictNode,{columns:this.#props.onConflictNode.columns?O([...this.#props.onConflictNode.columns,...n]):O(n)})})}constraint(t){return new e({...this.#props,onConflictNode:K.cloneWith(this.#props.onConflictNode,{constraint:A.create(t)})})}expression(t){return new e({...this.#props,onConflictNode:K.cloneWith(this.#props.onConflictNode,{indexExpression:t.toOperationNode()})})}where(...t){return new e({...this.#props,onConflictNode:K.cloneWithIndexWhere(this.#props.onConflictNode,R(t))})}whereRef(t,n,r){return new e({...this.#props,onConflictNode:K.cloneWithIndexWhere(this.#props.onConflictNode,Fc(t,n,r))})}clearWhere(){return new e({...this.#props,onConflictNode:K.cloneWithoutIndexWhere(this.#props.onConflictNode)})}doNothing(){return new Cl({...this.#props,onConflictNode:K.cloneWith(this.#props.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new wl({...this.#props,onConflictNode:K.cloneWith(this.#props.onConflictNode,{updates:_l(e)})})}$call(e){return e(this)}};B(Sl,`don't await OnConflictBuilder instances.`);var Cl=class{#props;constructor(e){this.#props=O(e)}toOperationNode(){return this.#props.onConflictNode}};B(Cl,`don't await OnConflictDoNothingBuilder instances.`);var wl=class e{#props;constructor(e){this.#props=O(e)}where(...t){return new e({...this.#props,onConflictNode:K.cloneWithUpdateWhere(this.#props.onConflictNode,R(t))})}whereRef(t,n,r){return new e({...this.#props,onConflictNode:K.cloneWithUpdateWhere(this.#props.onConflictNode,Fc(t,n,r))})}clearWhere(){return new e({...this.#props,onConflictNode:K.cloneWithoutUpdateWhere(this.#props.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#props.onConflictNode}};B(wl,`don't await OnConflictUpdateBuilder instances.`);const Tl=O({is(e){return e.kind===`TopNode`},create(e,t){return O({kind:`TopNode`,expression:e,modifiers:t})}});function El(e,t){if(!ws(e)&&!Os(e))throw Error(`Invalid top expression: ${e}`);if(!Cs(t)&&!Dl(t))throw Error(`Invalid top modifiers: ${t}`);return Tl.create(e,t)}function Dl(e){return e===`percent`||e===`with ties`||e===`percent with ties`}var Ol=class e{#props;constructor(e){this.#props=O(e)}values(t){let[n,r]=il(t);return new e({...this.#props,queryNode:H.cloneWith(this.#props.queryNode,{columns:n,values:r})})}columns(t){return new e({...this.#props,queryNode:H.cloneWith(this.#props.queryNode,{columns:O(t.map(N.create))})})}expression(t){return new e({...this.#props,queryNode:H.cloneWith(this.#props.queryNode,{values:td(t)})})}defaultValues(){return new e({...this.#props,queryNode:H.cloneWith(this.#props.queryNode,{defaultValues:!0})})}modifyEnd(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,t.toOperationNode())})}ignore(){return new e({...this.#props,queryNode:H.cloneWith(this.#props.queryNode,{ignore:!0})})}top(t,n){return new e({...this.#props,queryNode:G.cloneWithTop(this.#props.queryNode,El(t,n))})}onConflict(t){return new e({...this.#props,queryNode:H.cloneWith(this.#props.queryNode,{onConflict:t(new Sl({onConflictNode:K.create()})).toOperationNode()})})}onDuplicateKeyUpdate(t){return new e({...this.#props,queryNode:H.cloneWith(this.#props.queryNode,{onDuplicateKey:vl.create(_l(t))})})}returning(t){return new e({...this.#props,queryNode:G.cloneWithReturning(this.#props.queryNode,V(t))})}returningAll(){return new e({...this.#props,queryNode:G.cloneWithReturning(this.#props.queryNode,el())})}output(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,V(t))})}outputAll(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,el(t))})}clearReturning(){return new e({...this.#props,queryNode:G.cloneWithoutReturning(this.#props.queryNode)})}$call(e){return e(this)}$if(t,n){return t?n(this):new e({...this.#props})}$castTo(){return new e(this.#props)}$narrowType(){return new e(this.#props)}$assertType(){return new e(this.#props)}withPlugin(t){return new e({...this.#props,executor:this.#props.executor.withPlugin(t)})}toOperationNode(){return this.#props.executor.transformQuery(this.#props.queryNode,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){let e=this.compile(),t=await this.#props.executor.executeQuery(e,this.#props.queryId),{adapter:n}=this.#props.executor,r=e.query;return r.returning&&n.supportsReturning||r.output&&n.supportsOutput?t.rows:[new yl(t.insertId,t.numAffectedRows??t.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bl){let t=await this.executeTakeFirst();if(t===void 0)throw xl(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){let t=this.compile(),n=this.#props.executor.stream(t,e,this.#props.queryId);for await(let e of n)yield*e.rows}async explain(t,n){return await new e({...this.#props,queryNode:G.cloneWithExplain(this.#props.queryNode,t,n)}).execute()}};B(Ol,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var kl=class{numDeletedRows;constructor(e){this.numDeletedRows=e}};const Al=O({is(e){return e.kind===`LimitNode`},create(e){return O({kind:`LimitNode`,limit:e})}});var jl=class e{#props;constructor(e){this.#props=O(e)}where(...t){return new e({...this.#props,queryNode:G.cloneWithWhere(this.#props.queryNode,R(t))})}whereRef(t,n,r){return new e({...this.#props,queryNode:G.cloneWithWhere(this.#props.queryNode,Fc(t,n,r))})}clearWhere(){return new e({...this.#props,queryNode:G.cloneWithoutWhere(this.#props.queryNode)})}top(t,n){return new e({...this.#props,queryNode:G.cloneWithTop(this.#props.queryNode,El(t,n))})}using(t){return new e({...this.#props,queryNode:ul.cloneWithUsing(this.#props.queryNode,id(t))})}innerJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`InnerJoin`,t))})}leftJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`LeftJoin`,t))})}rightJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`RightJoin`,t))})}fullJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`FullJoin`,t))})}returning(t){return new e({...this.#props,queryNode:G.cloneWithReturning(this.#props.queryNode,V(t))})}returningAll(t){return new e({...this.#props,queryNode:G.cloneWithReturning(this.#props.queryNode,el(t))})}output(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,V(t))})}outputAll(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,el(t))})}clearReturning(){return new e({...this.#props,queryNode:G.cloneWithoutReturning(this.#props.queryNode)})}clearLimit(){return new e({...this.#props,queryNode:ul.cloneWithoutLimit(this.#props.queryNode)})}clearOrderBy(){return new e({...this.#props,queryNode:ul.cloneWithoutOrderBy(this.#props.queryNode)})}orderBy(t,n){return new e({...this.#props,queryNode:ul.cloneWithOrderByItems(this.#props.queryNode,uc([t,n]))})}limit(t){return new e({...this.#props,queryNode:ul.cloneWithLimit(this.#props.queryNode,Al.create(L(t)))})}modifyEnd(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,t.toOperationNode())})}$call(e){return e(this)}$if(t,n){return t?n(this):new e({...this.#props})}$castTo(){return new e(this.#props)}$narrowType(){return new e(this.#props)}$assertType(){return new e(this.#props)}withPlugin(t){return new e({...this.#props,executor:this.#props.executor.withPlugin(t)})}toOperationNode(){return this.#props.executor.transformQuery(this.#props.queryNode,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){let e=this.compile(),t=await this.#props.executor.executeQuery(e,this.#props.queryId),{adapter:n}=this.#props.executor,r=e.query;return r.returning&&n.supportsReturning||r.output&&n.supportsOutput?t.rows:[new kl(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bl){let t=await this.executeTakeFirst();if(t===void 0)throw xl(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){let t=this.compile(),n=this.#props.executor.stream(t,e,this.#props.queryId);for await(let e of n)yield*e.rows}async explain(t,n){return await new e({...this.#props,queryNode:G.cloneWithExplain(this.#props.queryNode,t,n)}).execute()}};B(jl,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Ml=class{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}},Nl=class e{#props;constructor(e){this.#props=O(e)}where(...t){return new e({...this.#props,queryNode:G.cloneWithWhere(this.#props.queryNode,R(t))})}whereRef(t,n,r){return new e({...this.#props,queryNode:G.cloneWithWhere(this.#props.queryNode,Fc(t,n,r))})}clearWhere(){return new e({...this.#props,queryNode:G.cloneWithoutWhere(this.#props.queryNode)})}top(t,n){return new e({...this.#props,queryNode:G.cloneWithTop(this.#props.queryNode,El(t,n))})}from(t){return new e({...this.#props,queryNode:cl.cloneWithFromItems(this.#props.queryNode,id(t))})}innerJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`InnerJoin`,t))})}leftJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`LeftJoin`,t))})}rightJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`RightJoin`,t))})}fullJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`FullJoin`,t))})}limit(t){return new e({...this.#props,queryNode:cl.cloneWithLimit(this.#props.queryNode,Al.create(L(t)))})}set(...t){return new e({...this.#props,queryNode:cl.cloneWithUpdates(this.#props.queryNode,gl(...t))})}returning(t){return new e({...this.#props,queryNode:G.cloneWithReturning(this.#props.queryNode,V(t))})}returningAll(t){return new e({...this.#props,queryNode:G.cloneWithReturning(this.#props.queryNode,el(t))})}output(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,V(t))})}outputAll(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,el(t))})}modifyEnd(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,t.toOperationNode())})}clearReturning(){return new e({...this.#props,queryNode:G.cloneWithoutReturning(this.#props.queryNode)})}$call(e){return e(this)}$if(t,n){return t?n(this):new e({...this.#props})}$castTo(){return new e(this.#props)}$narrowType(){return new e(this.#props)}$assertType(){return new e(this.#props)}withPlugin(t){return new e({...this.#props,executor:this.#props.executor.withPlugin(t)})}toOperationNode(){return this.#props.executor.transformQuery(this.#props.queryNode,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){let e=this.compile(),t=await this.#props.executor.executeQuery(e,this.#props.queryId),{adapter:n}=this.#props.executor,r=e.query;return r.returning&&n.supportsReturning||r.output&&n.supportsOutput?t.rows:[new Ml(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bl){let t=await this.executeTakeFirst();if(t===void 0)throw xl(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){let t=this.compile(),n=this.#props.executor.stream(t,e,this.#props.queryId);for await(let e of n)yield*e.rows}async explain(t,n){return await new e({...this.#props,queryNode:G.cloneWithExplain(this.#props.queryNode,t,n)}).execute()}};B(Nl,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const Pl=O({is(e){return e.kind===`CommonTableExpressionNameNode`},create(e,t){return O({kind:`CommonTableExpressionNameNode`,table:Vs.create(e),columns:t?O(t.map(N.create)):void 0})}}),Fl=O({is(e){return e.kind===`CommonTableExpressionNode`},create(e,t){return O({kind:`CommonTableExpressionNode`,name:e,expression:t})},cloneWith(e,t){return O({...e,...t})}});var Il=class e{#props;constructor(e){this.#props=O(e)}materialized(){return new e({...this.#props,node:Fl.cloneWith(this.#props.node,{materialized:!0})})}notMaterialized(){return new e({...this.#props,node:Fl.cloneWith(this.#props.node,{materialized:!1})})}toOperationNode(){return this.#props.node}};B(Il,`don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.`);function Ll(e,t){let n=t(fu()).toOperationNode();return D(e)?e(Rl(n)).toOperationNode():Fl.create(zl(e),n)}function Rl(e){return t=>new Il({node:Fl.create(zl(t),e)})}function zl(e){if(e.includes(`(`)){let t=e.split(/[\(\)]/),n=t[0],r=t[1].split(`,`).map(e=>e.trim());return Pl.create(n,r)}else return Pl.create(e)}const Bl=O({is(e){return e.kind===`WithNode`},create(e,t){return O({kind:`WithNode`,expressions:O([e]),...t})},cloneWithExpression(e,t){return O({...e,expressions:O([...e.expressions,t])})}}),Vl=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`.split(``);function Hl(e){let t=``;for(let n=0;n<e;++n)t+=Ul();return t}function Ul(){return Vl[~~(Math.random()*Vl.length)]}function q(){return new Wl}var Wl=class{#queryId;get queryId(){return this.#queryId===void 0&&(this.#queryId=Hl(8)),this.#queryId}};function J(e){return e}var Gl=class{nodeStack=[];#transformers=O({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);let t=this.transformNodeImpl(e);return this.nodeStack.pop(),O(t)}transformNodeImpl(e){return this.#transformers[e.kind](e)}transformNodeList(e){return e&&O(e.map(e=>this.transformNode(e)))}transformSelectQuery(e){return J({kind:`SelectQueryNode`,from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)})}transformSelection(e){return J({kind:`SelectionNode`,selection:this.transformNode(e.selection)})}transformColumn(e){return J({kind:`ColumnNode`,column:this.transformNode(e.column)})}transformAlias(e){return J({kind:`AliasNode`,node:this.transformNode(e.node),alias:this.transformNode(e.alias)})}transformTable(e){return J({kind:`TableNode`,table:this.transformNode(e.table)})}transformFrom(e){return J({kind:`FromNode`,froms:this.transformNodeList(e.froms)})}transformReference(e){return J({kind:`ReferenceNode`,column:this.transformNode(e.column),table:this.transformNode(e.table)})}transformAnd(e){return J({kind:`AndNode`,left:this.transformNode(e.left),right:this.transformNode(e.right)})}transformOr(e){return J({kind:`OrNode`,left:this.transformNode(e.left),right:this.transformNode(e.right)})}transformValueList(e){return J({kind:`ValueListNode`,values:this.transformNodeList(e.values)})}transformParens(e){return J({kind:`ParensNode`,node:this.transformNode(e.node)})}transformJoin(e){return J({kind:`JoinNode`,joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)})}transformRaw(e){return J({kind:`RawNode`,sqlFragments:O([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)})}transformWhere(e){return J({kind:`WhereNode`,where:this.transformNode(e.where)})}transformInsertQuery(e){return J({kind:`InsertQueryNode`,into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top),output:this.transformNode(e.output)})}transformValues(e){return J({kind:`ValuesNode`,values:this.transformNodeList(e.values)})}transformDeleteQuery(e){return J({kind:`DeleteQueryNode`,from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top),output:this.transformNode(e.output)})}transformReturning(e){return J({kind:`ReturningNode`,selections:this.transformNodeList(e.selections)})}transformCreateTable(e){return J({kind:`CreateTableNode`,table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)})}transformColumnDefinition(e){return J({kind:`ColumnDefinitionNode`,column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists})}transformAddColumn(e){return J({kind:`AddColumnNode`,column:this.transformNode(e.column)})}transformDropTable(e){return J({kind:`DropTableNode`,table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade})}transformOrderBy(e){return J({kind:`OrderByNode`,items:this.transformNodeList(e.items)})}transformOrderByItem(e){return J({kind:`OrderByItemNode`,orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)})}transformGroupBy(e){return J({kind:`GroupByNode`,items:this.transformNodeList(e.items)})}transformGroupByItem(e){return J({kind:`GroupByItemNode`,groupBy:this.transformNode(e.groupBy)})}transformUpdateQuery(e){return J({kind:`UpdateQueryNode`,table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top),output:this.transformNode(e.output)})}transformColumnUpdate(e){return J({kind:`ColumnUpdateNode`,column:this.transformNode(e.column),value:this.transformNode(e.value)})}transformLimit(e){return J({kind:`LimitNode`,limit:this.transformNode(e.limit)})}transformOffset(e){return J({kind:`OffsetNode`,offset:this.transformNode(e.offset)})}transformOnConflict(e){return J({kind:`OnConflictNode`,columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing})}transformOnDuplicateKey(e){return J({kind:`OnDuplicateKeyNode`,updates:this.transformNodeList(e.updates)})}transformCreateIndex(e){return J({kind:`CreateIndexNode`,name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct})}transformList(e){return J({kind:`ListNode`,items:this.transformNodeList(e.items)})}transformDropIndex(e){return J({kind:`DropIndexNode`,name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade})}transformPrimaryKeyConstraint(e){return J({kind:`PrimaryKeyConstraintNode`,columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)})}transformUniqueConstraint(e){return J({kind:`UniqueConstraintNode`,columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct})}transformForeignKeyConstraint(e){return J({kind:`ForeignKeyConstraintNode`,columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate})}transformSetOperation(e){return J({kind:`SetOperationNode`,operator:e.operator,expression:this.transformNode(e.expression),all:e.all})}transformReferences(e){return J({kind:`ReferencesNode`,table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate})}transformCheckConstraint(e){return J({kind:`CheckConstraintNode`,expression:this.transformNode(e.expression),name:this.transformNode(e.name)})}transformWith(e){return J({kind:`WithNode`,expressions:this.transformNodeList(e.expressions),recursive:e.recursive})}transformCommonTableExpression(e){return J({kind:`CommonTableExpressionNode`,name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)})}transformCommonTableExpressionName(e){return J({kind:`CommonTableExpressionNameNode`,table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)})}transformHaving(e){return J({kind:`HavingNode`,having:this.transformNode(e.having)})}transformCreateSchema(e){return J({kind:`CreateSchemaNode`,schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists})}transformDropSchema(e){return J({kind:`DropSchemaNode`,schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade})}transformAlterTable(e){return J({kind:`AlterTableNode`,table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)})}transformDropColumn(e){return J({kind:`DropColumnNode`,column:this.transformNode(e.column)})}transformRenameColumn(e){return J({kind:`RenameColumnNode`,column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)})}transformAlterColumn(e){return J({kind:`AlterColumnNode`,column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull})}transformModifyColumn(e){return J({kind:`ModifyColumnNode`,column:this.transformNode(e.column)})}transformAddConstraint(e){return J({kind:`AddConstraintNode`,constraint:this.transformNode(e.constraint)})}transformDropConstraint(e){return J({kind:`DropConstraintNode`,constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier})}transformCreateView(e){return J({kind:`CreateViewNode`,name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)})}transformDropView(e){return J({kind:`DropViewNode`,name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade})}transformGenerated(e){return J({kind:`GeneratedNode`,byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)})}transformDefaultValue(e){return J({kind:`DefaultValueNode`,defaultValue:this.transformNode(e.defaultValue)})}transformOn(e){return J({kind:`OnNode`,on:this.transformNode(e.on)})}transformSelectModifier(e){return J({kind:`SelectModifierNode`,modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)})}transformCreateType(e){return J({kind:`CreateTypeNode`,name:this.transformNode(e.name),enum:this.transformNode(e.enum)})}transformDropType(e){return J({kind:`DropTypeNode`,name:this.transformNode(e.name),ifExists:e.ifExists})}transformExplain(e){return J({kind:`ExplainNode`,format:e.format,options:this.transformNode(e.options)})}transformSchemableIdentifier(e){return J({kind:`SchemableIdentifierNode`,schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)})}transformAggregateFunction(e){return J({kind:`AggregateFunctionNode`,aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,orderBy:this.transformNode(e.orderBy),filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)})}transformOver(e){return J({kind:`OverNode`,orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)})}transformPartitionBy(e){return J({kind:`PartitionByNode`,items:this.transformNodeList(e.items)})}transformPartitionByItem(e){return J({kind:`PartitionByItemNode`,partitionBy:this.transformNode(e.partitionBy)})}transformBinaryOperation(e){return J({kind:`BinaryOperationNode`,leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)})}transformUnaryOperation(e){return J({kind:`UnaryOperationNode`,operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)})}transformUsing(e){return J({kind:`UsingNode`,tables:this.transformNodeList(e.tables)})}transformFunction(e){return J({kind:`FunctionNode`,func:e.func,arguments:this.transformNodeList(e.arguments)})}transformCase(e){return J({kind:`CaseNode`,value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement})}transformWhen(e){return J({kind:`WhenNode`,condition:this.transformNode(e.condition),result:this.transformNode(e.result)})}transformJSONReference(e){return J({kind:`JSONReferenceNode`,reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)})}transformJSONPath(e){return J({kind:`JSONPathNode`,inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)})}transformJSONPathLeg(e){return J({kind:`JSONPathLegNode`,type:e.type,value:e.value})}transformJSONOperatorChain(e){return J({kind:`JSONOperatorChainNode`,operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)})}transformTuple(e){return J({kind:`TupleNode`,values:this.transformNodeList(e.values)})}transformMergeQuery(e){return J({kind:`MergeQueryNode`,into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top),endModifiers:this.transformNodeList(e.endModifiers),output:this.transformNode(e.output)})}transformMatched(e){return J({kind:`MatchedNode`,not:e.not,bySource:e.bySource})}transformAddIndex(e){return J({kind:`AddIndexNode`,name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists})}transformCast(e){return J({kind:`CastNode`,expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)})}transformFetch(e){return J({kind:`FetchNode`,rowCount:this.transformNode(e.rowCount),modifier:e.modifier})}transformTop(e){return J({kind:`TopNode`,expression:e.expression,modifiers:e.modifiers})}transformOutput(e){return J({kind:`OutputNode`,selections:this.transformNodeList(e.selections)})}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}};const Kl=O({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),ql={json_agg:!0,to_json:!0};var Jl=class extends Gl{#schema;#schemableIds=new Set;#ctes=new Set;constructor(e){super(),this.#schema=e}transformNodeImpl(e){if(!this.#isRootOperationNode(e))return super.transformNodeImpl(e);let t=this.#collectCTEs(e);for(let e of t)this.#ctes.add(e);let n=this.#collectSchemableIds(e);for(let e of n)this.#schemableIds.add(e);let r=super.transformNodeImpl(e);for(let e of n)this.#schemableIds.delete(e);for(let e of t)this.#ctes.delete(e);return r}transformSchemableIdentifier(e){let t=super.transformSchemableIdentifier(e);return t.schema||!this.#schemableIds.has(e.identifier.name)?t:{...t,schema:A.create(this.#schema)}}transformReferences(e){let t=super.transformReferences(e);return t.table.table.schema?t:{...t,table:Vs.createWithSchema(this.#schema,t.table.table.identifier.name)}}transformAggregateFunction(e){return{...super.transformAggregateFunction({...e,aggregated:[]}),aggregated:this.#transformTableArgsWithoutSchemas(e,`aggregated`)}}transformFunction(e){return{...super.transformFunction({...e,arguments:[]}),arguments:this.#transformTableArgsWithoutSchemas(e,`arguments`)}}#transformTableArgsWithoutSchemas(e,t){return ql[e.func]?e[t].map(e=>!Vs.is(e)||e.table.schema?this.transformNode(e):{...e,table:this.transformIdentifier(e.table.identifier)}):this.transformNodeList(e[t])}#isRootOperationNode(e){return e.kind in Kl}#collectSchemableIds(e){let t=new Set;if(`name`in e&&e.name&&Is.is(e.name)&&this.#collectSchemableId(e.name,t),`from`in e&&e.from)for(let n of e.from.froms)this.#collectSchemableIdsFromTableExpr(n,t);if(`into`in e&&e.into&&this.#collectSchemableIdsFromTableExpr(e.into,t),`table`in e&&e.table&&this.#collectSchemableIdsFromTableExpr(e.table,t),`joins`in e&&e.joins)for(let n of e.joins)this.#collectSchemableIdsFromTableExpr(n.table,t);return`using`in e&&e.using&&this.#collectSchemableIdsFromTableExpr(e.using,t),t}#collectCTEs(e){let t=new Set;return`with`in e&&e.with&&this.#collectCTEIds(e.with,t),t}#collectSchemableIdsFromTableExpr(e,t){let n=Vs.is(e)?e:Bs.is(e)&&Vs.is(e.node)?e.node:null;n&&this.#collectSchemableId(n.table,t)}#collectSchemableId(e,t){let n=e.identifier.name;!this.#schemableIds.has(n)&&!this.#ctes.has(n)&&t.add(n)}#collectCTEIds(e,t){for(let n of e.expressions){let e=n.name.table.table.identifier.name;this.#ctes.has(e)||t.add(e)}}},Yl=class{#transformer;constructor(e){this.#transformer=new Jl(e)}transformQuery(e){return this.#transformer.transformNode(e.node)}async transformResult(e){return e.result}};const Xl=O({is(e){return e.kind===`MatchedNode`},create(e,t=!1){return O({kind:`MatchedNode`,not:e,bySource:t})}});function Zl(e,t,n){return pl.create(Lc([Xl.create(!e.isMatched,e.bySource),...t&&t.length>0?[t.length===3&&n?Fc(t[0],t[1],t[2]):R(t)]:[]],`and`,!1))}function Ql(e){return E(e)?P.create([e],[]):M(e)?e.toOperationNode():e}var $l=class{#promise;#resolve;#reject;constructor(){this.#promise=new Promise((e,t)=>{this.#reject=t,this.#resolve=e})}get promise(){return this.#promise}resolve=e=>{this.#resolve&&this.#resolve(e)};reject=e=>{this.#reject&&this.#reject(e)}};const eu=new Set;function tu(e){eu.has(e)||(eu.add(e),console.log(e))}const nu=O([]);var ru=class{#plugins;constructor(e=nu){this.#plugins=e}get plugins(){return this.#plugins}transformQuery(e,t){for(let n of this.#plugins){let r=n.transformQuery({node:e,queryId:t});if(r.kind===e.kind)e=r;else throw Error([`KyselyPlugin.transformQuery must return a node`,`of the same kind that was given to it.`,`The plugin was given a ${e.kind}`,`but it returned a ${r.kind}`].join(` `))}return e}async executeQuery(e,t){return await this.provideConnection(async n=>{let r=await n.executeQuery(e),i=await this.#transformResult(r,t);return iu(r,i),i})}async*stream(e,t,n){let r=new $l,i=new $l;this.provideConnection(async e=>(r.resolve(e),await i.promise)).catch(e=>r.reject(e));let a=await r.promise;try{for await(let r of a.streamQuery(e,t))yield await this.#transformResult(r,n)}finally{i.resolve()}}async#transformResult(e,t){for(let n of this.#plugins)e=await n.transformResult({result:e,queryId:t});return e}};function iu(e,t){let{numAffectedRows:n}=e;n===void 0&&e.numUpdatedOrDeletedRows===void 0||n!==void 0&&t.numAffectedRows!==void 0||tu(`kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.`)}const au=new class e extends ru{get adapter(){throw Error(`this query cannot be compiled to SQL`)}compileQuery(){throw Error(`this query cannot be compiled to SQL`)}provideConnection(){throw Error(`this query cannot be executed`)}withConnectionProvider(){throw Error(`this query cannot have a connection provider`)}withPlugin(t){return new e([...this.plugins,t])}withPlugins(t){return new e([...this.plugins,...t])}withPluginAtFront(t){return new e([t,...this.plugins])}withoutPlugins(){return new e([])}};var ou=class{numChangedRows;constructor(e){this.numChangedRows=e}},su=class e{#props;constructor(e){this.#props=O(e)}modifyEnd(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,t.toOperationNode())})}top(t,n){return new e({...this.#props,queryNode:G.cloneWithTop(this.#props.queryNode,El(t,n))})}using(...e){return new cu({...this.#props,queryNode:W.cloneWithUsing(this.#props.queryNode,Y(`Using`,e))})}output(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,V(t))})}outputAll(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,el(t))})}};B(su,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var cu=class e{#props;constructor(e){this.#props=O(e)}modifyEnd(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,t.toOperationNode())})}top(t,n){return new e({...this.#props,queryNode:G.cloneWithTop(this.#props.queryNode,El(t,n))})}whenMatched(){return this.#whenMatched([])}whenMatchedAnd(...e){return this.#whenMatched(e)}whenMatchedAndRef(e,t,n){return this.#whenMatched([e,t,n],!0)}#whenMatched(e,t){return new lu({...this.#props,queryNode:W.cloneWithWhen(this.#props.queryNode,Zl({isMatched:!0},e,t))})}whenNotMatched(){return this.#whenNotMatched([])}whenNotMatchedAnd(...e){return this.#whenNotMatched(e)}whenNotMatchedAndRef(e,t,n){return this.#whenNotMatched([e,t,n],!0)}whenNotMatchedBySource(){return this.#whenNotMatched([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#whenNotMatched(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,n){return this.#whenNotMatched([e,t,n],!0,!0)}output(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,V(t))})}outputAll(t){return new e({...this.#props,queryNode:G.cloneWithOutput(this.#props.queryNode,el(t))})}#whenNotMatched(e,t=!1,n=!1){let r={...this.#props,queryNode:W.cloneWithWhen(this.#props.queryNode,Zl({isMatched:!1,bySource:n},e,t))};return new(n?lu:uu)(r)}$call(e){return e(this)}$if(t,n){return t?n(this):new e({...this.#props})}toOperationNode(){return this.#props.executor.transformQuery(this.#props.queryNode,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){let e=this.compile(),t=await this.#props.executor.executeQuery(e,this.#props.queryId);return e.query.output&&this.#props.executor.adapter.supportsOutput?t.rows:[new ou(t.numAffectedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bl){let t=await this.executeTakeFirst();if(t===void 0)throw xl(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}};B(cu,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");var lu=class{#props;constructor(e){this.#props=O(e)}thenDelete(){return new cu({...this.#props,queryNode:W.cloneWithThen(this.#props.queryNode,Ql(`delete`))})}thenDoNothing(){return new cu({...this.#props,queryNode:W.cloneWithThen(this.#props.queryNode,Ql(`do nothing`))})}thenUpdate(e){return new cu({...this.#props,queryNode:W.cloneWithThen(this.#props.queryNode,Ql(e(new Nl({queryId:this.#props.queryId,executor:au,queryNode:cl.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(t=>t.set(...e))}};B(lu,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var uu=class{#props;constructor(e){this.#props=O(e)}thenDoNothing(){return new cu({...this.#props,queryNode:W.cloneWithThen(this.#props.queryNode,Ql(`do nothing`))})}thenInsertValues(e){let[t,n]=il(e);return new cu({...this.#props,queryNode:W.cloneWithThen(this.#props.queryNode,Ql(H.cloneWith(H.createWithoutInto(),{columns:t,values:n})))})}};B(uu,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var du=class e{#props;constructor(e){this.#props=O(e)}selectFrom(e){return ku({queryId:q(),executor:this.#props.executor,queryNode:z.createFrom(id(e),this.#props.withNode)})}selectNoFrom(e){return ku({queryId:q(),executor:this.#props.executor,queryNode:z.cloneWithSelections(z.create(this.#props.withNode),V(e))})}insertInto(e){return new Ol({queryId:q(),executor:this.#props.executor,queryNode:H.create(Q(e),this.#props.withNode)})}replaceInto(e){return new Ol({queryId:q(),executor:this.#props.executor,queryNode:H.create(Q(e),this.#props.withNode,!0)})}deleteFrom(e){return new jl({queryId:q(),executor:this.#props.executor,queryNode:ul.create(id(e),this.#props.withNode)})}updateTable(e){return new Nl({queryId:q(),executor:this.#props.executor,queryNode:cl.create(ad(e),this.#props.withNode)})}mergeInto(e){return new su({queryId:q(),executor:this.#props.executor,queryNode:W.create(od(e),this.#props.withNode)})}with(t,n){let r=Ll(t,n);return new e({...this.#props,withNode:this.#props.withNode?Bl.cloneWithExpression(this.#props.withNode,r):Bl.create(r)})}withRecursive(t,n){let r=Ll(t,n);return new e({...this.#props,withNode:this.#props.withNode?Bl.cloneWithExpression(this.#props.withNode,r):Bl.create(r,{recursive:!0})})}withPlugin(t){return new e({...this.#props,executor:this.#props.executor.withPlugin(t)})}withoutPlugins(){return new e({...this.#props,executor:this.#props.executor.withoutPlugins()})}withSchema(t){return new e({...this.#props,executor:this.#props.executor.withPluginAtFront(new Yl(t))})}};function fu(){return new du({executor:au})}function pu(e,t){return new Jc({joinNode:Js.create(e,ad(t))})}function mu(){return new Zc({overNode:Wc.create()})}function Y(e,t){if(t.length===3)return gu(e,t[0],t[1],t[2]);if(t.length===2)return hu(e,t[0],t[1]);throw Error(`not implemented`)}function hu(e,t,n){return n(pu(e,t)).toOperationNode()}function gu(e,t,n,r){return Js.createWithOn(e,ad(t),Fc(n,`=`,r))}const _u=O({is(e){return e.kind===`OffsetNode`},create(e){return O({kind:`OffsetNode`,offset:e})}}),vu=O({is(e){return e.kind===`GroupByItemNode`},create(e){return O({kind:`GroupByItemNode`,groupBy:e})}});function yu(e){return e=D(e)?e(ed()):e,vc(e).map(vu.create)}const bu=O({is(e){return e.kind===`SetOperationNode`},create(e,t,n){return O({kind:`SetOperationNode`,operator:e,expression:t,all:n})}});function xu(e,t,n){return D(t)&&(t=t($u())),js(t)||(t=[t]),t.map(t=>bu.create(e,td(t),n))}var X=class e{#node;constructor(e){this.#node=e}get expressionType(){}as(e){return new Su(this,e)}or(...e){return new Cu(Ks.create(this.#node,R(e)))}and(...e){return new wu(Gs.create(this.#node,R(e)))}$castTo(){return new e(this.#node)}$notNull(){return new e(this.#node)}toOperationNode(){return this.#node}},Su=class{#expr;#alias;constructor(e,t){this.#expr=e,this.#alias=t}get expression(){return this.#expr}get alias(){return this.#alias}toOperationNode(){return Bs.create(this.#expr.toOperationNode(),M(this.#alias)?this.#alias.toOperationNode():A.create(this.#alias))}},Cu=class e{#node;constructor(e){this.#node=e}get expressionType(){}as(e){return new Su(this,e)}or(...t){return new e(Ks.create(this.#node,R(t)))}$castTo(){return new e(this.#node)}toOperationNode(){return Nc.create(this.#node)}},wu=class e{#node;constructor(e){this.#node=e}get expressionType(){}as(e){return new Su(this,e)}and(...t){return new e(Gs.create(this.#node,R(t)))}$castTo(){return new e(this.#node)}toOperationNode(){return Nc.create(this.#node)}};const Tu={is(e){return e.kind===`FetchNode`},create(e,t){return{kind:`FetchNode`,rowCount:I.create(e),modifier:t}}};function Eu(e,t){if(!ws(e)&&!Os(e))throw Error(`Invalid fetch row count: ${e}`);if(!Du(t))throw Error(`Invalid fetch modifier: ${t}`);return Tu.create(e,t)}function Du(e){return e===`only`||e===`with ties`}var Ou=class e{#props;constructor(e){this.#props=O(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...t){return new e({...this.#props,queryNode:G.cloneWithWhere(this.#props.queryNode,R(t))})}whereRef(t,n,r){return new e({...this.#props,queryNode:G.cloneWithWhere(this.#props.queryNode,Fc(t,n,r))})}having(...t){return new e({...this.#props,queryNode:z.cloneWithHaving(this.#props.queryNode,R(t))})}havingRef(t,n,r){return new e({...this.#props,queryNode:z.cloneWithHaving(this.#props.queryNode,Fc(t,n,r))})}select(t){return new e({...this.#props,queryNode:z.cloneWithSelections(this.#props.queryNode,V(t))})}distinctOn(t){return new e({...this.#props,queryNode:z.cloneWithDistinctOn(this.#props.queryNode,vc(t))})}modifyFront(t){return new e({...this.#props,queryNode:z.cloneWithFrontModifier(this.#props.queryNode,Ws.createWithExpression(t.toOperationNode()))})}modifyEnd(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,Ws.createWithExpression(t.toOperationNode()))})}distinct(){return new e({...this.#props,queryNode:z.cloneWithFrontModifier(this.#props.queryNode,Ws.create(`Distinct`))})}forUpdate(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,Ws.create(`ForUpdate`,t?As(t).map(Q):void 0))})}forShare(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,Ws.create(`ForShare`,t?As(t).map(Q):void 0))})}forKeyShare(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,Ws.create(`ForKeyShare`,t?As(t).map(Q):void 0))})}forNoKeyUpdate(t){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,Ws.create(`ForNoKeyUpdate`,t?As(t).map(Q):void 0))})}skipLocked(){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,Ws.create(`SkipLocked`))})}noWait(){return new e({...this.#props,queryNode:G.cloneWithEndModifier(this.#props.queryNode,Ws.create(`NoWait`))})}selectAll(t){return new e({...this.#props,queryNode:z.cloneWithSelections(this.#props.queryNode,el(t))})}innerJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`InnerJoin`,t))})}leftJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`LeftJoin`,t))})}rightJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`RightJoin`,t))})}fullJoin(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`FullJoin`,t))})}innerJoinLateral(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`LateralInnerJoin`,t))})}leftJoinLateral(...t){return new e({...this.#props,queryNode:G.cloneWithJoin(this.#props.queryNode,Y(`LateralLeftJoin`,t))})}orderBy(...t){return new e({...this.#props,queryNode:z.cloneWithOrderByItems(this.#props.queryNode,uc(t))})}groupBy(t){return new e({...this.#props,queryNode:z.cloneWithGroupByItems(this.#props.queryNode,yu(t))})}limit(t){return new e({...this.#props,queryNode:z.cloneWithLimit(this.#props.queryNode,Al.create(L(t)))})}offset(t){return new e({...this.#props,queryNode:z.cloneWithOffset(this.#props.queryNode,_u.create(L(t)))})}fetch(t,n=`only`){return new e({...this.#props,queryNode:z.cloneWithFetch(this.#props.queryNode,Eu(t,n))})}top(t,n){return new e({...this.#props,queryNode:G.cloneWithTop(this.#props.queryNode,El(t,n))})}union(t){return new e({...this.#props,queryNode:z.cloneWithSetOperations(this.#props.queryNode,xu(`union`,t,!1))})}unionAll(t){return new e({...this.#props,queryNode:z.cloneWithSetOperations(this.#props.queryNode,xu(`union`,t,!0))})}intersect(t){return new e({...this.#props,queryNode:z.cloneWithSetOperations(this.#props.queryNode,xu(`intersect`,t,!1))})}intersectAll(t){return new e({...this.#props,queryNode:z.cloneWithSetOperations(this.#props.queryNode,xu(`intersect`,t,!0))})}except(t){return new e({...this.#props,queryNode:z.cloneWithSetOperations(this.#props.queryNode,xu(`except`,t,!1))})}exceptAll(t){return new e({...this.#props,queryNode:z.cloneWithSetOperations(this.#props.queryNode,xu(`except`,t,!0))})}as(e){return new Au(this,e)}clearSelect(){return new e({...this.#props,queryNode:z.cloneWithoutSelections(this.#props.queryNode)})}clearWhere(){return new e({...this.#props,queryNode:G.cloneWithoutWhere(this.#props.queryNode)})}clearLimit(){return new e({...this.#props,queryNode:z.cloneWithoutLimit(this.#props.queryNode)})}clearOffset(){return new e({...this.#props,queryNode:z.cloneWithoutOffset(this.#props.queryNode)})}clearOrderBy(){return new e({...this.#props,queryNode:z.cloneWithoutOrderBy(this.#props.queryNode)})}clearGroupBy(){return new e({...this.#props,queryNode:z.cloneWithoutGroupBy(this.#props.queryNode)})}$call(e){return e(this)}$if(t,n){return t?n(this):new e({...this.#props})}$castTo(){return new e(this.#props)}$narrowType(){return new e(this.#props)}$assertType(){return new e(this.#props)}$asTuple(){return new X(this.toOperationNode())}withPlugin(t){return new e({...this.#props,executor:this.#props.executor.withPlugin(t)})}toOperationNode(){return this.#props.executor.transformQuery(this.#props.queryNode,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){let e=this.compile();return(await this.#props.executor.executeQuery(e,this.#props.queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bl){let t=await this.executeTakeFirst();if(t===void 0)throw xl(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){let t=this.compile(),n=this.#props.executor.stream(t,e,this.#props.queryId);for await(let e of n)yield*e.rows}async explain(t,n){return await new e({...this.#props,queryNode:G.cloneWithExplain(this.#props.queryNode,t,n)}).execute()}};B(Ou,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function ku(e){return new Ou(e)}var Au=class{#queryBuilder;#alias;constructor(e,t){this.#queryBuilder=e,this.#alias=t}get expression(){return this.#queryBuilder}get alias(){return this.#alias}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Bs.create(this.#queryBuilder.toOperationNode(),A.create(this.#alias))}};B(Au,`don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.`);const ju=O({is(e){return e.kind===`AggregateFunctionNode`},create(e,t=[]){return O({kind:`AggregateFunctionNode`,func:e,aggregated:t})},cloneWithDistinct(e){return O({...e,distinct:!0})},cloneWithOrderBy(e,t){return O({...e,orderBy:e.orderBy?Hc.cloneWithItems(e.orderBy,t):Hc.create(t)})},cloneWithFilter(e,t){return O({...e,filter:e.filter?U.cloneWithOperation(e.filter,`And`,t):U.create(t)})},cloneWithOrFilter(e,t){return O({...e,filter:e.filter?U.cloneWithOperation(e.filter,`Or`,t):U.create(t)})},cloneWithOver(e,t){return O({...e,over:t})}}),Mu=O({is(e){return e.kind===`FunctionNode`},create(e,t){return O({kind:`FunctionNode`,func:e,arguments:t})}});var Nu=class e{#props;constructor(e){this.#props=O(e)}get expressionType(){}as(e){return new Pu(this,e)}distinct(){return new e({...this.#props,aggregateFunctionNode:ju.cloneWithDistinct(this.#props.aggregateFunctionNode)})}orderBy(t,n){return new e({...this.#props,aggregateFunctionNode:ju.cloneWithOrderBy(this.#props.aggregateFunctionNode,uc([t,n]))})}filterWhere(...t){return new e({...this.#props,aggregateFunctionNode:ju.cloneWithFilter(this.#props.aggregateFunctionNode,R(t))})}filterWhereRef(t,n,r){return new e({...this.#props,aggregateFunctionNode:ju.cloneWithFilter(this.#props.aggregateFunctionNode,Fc(t,n,r))})}over(t){let n=mu();return new e({...this.#props,aggregateFunctionNode:ju.cloneWithOver(this.#props.aggregateFunctionNode,(t?t(n):n).toOperationNode())})}$call(e){return e(this)}$castTo(){return new e(this.#props)}$notNull(){return new e(this.#props)}toOperationNode(){return this.#props.aggregateFunctionNode}};B(Nu,`don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.`);var Pu=class{#aggregateFunctionBuilder;#alias;constructor(e,t){this.#aggregateFunctionBuilder=e,this.#alias=t}get expression(){return this.#aggregateFunctionBuilder}get alias(){return this.#alias}toOperationNode(){return Bs.create(this.#aggregateFunctionBuilder.toOperationNode(),A.create(this.#alias))}};function Fu(){let e=(e,t)=>new X(Mu.create(e,vc(t??[]))),t=(e,t)=>new Nu({aggregateFunctionNode:ju.create(e,t?vc(t):void 0)});return Object.assign(e,{agg:t,avg(e){return t(`avg`,[e])},coalesce(...t){return e(`coalesce`,t)},count(e){return t(`count`,[e])},countAll(e){return new Nu({aggregateFunctionNode:ju.create(`count`,el(e))})},max(e){return t(`max`,[e])},min(e){return t(`min`,[e])},sum(e){return t(`sum`,[e])},any(t){return e(`any`,[t])},jsonAgg(e){return new Nu({aggregateFunctionNode:ju.create(`json_agg`,[E(e)?Q(e):e.toOperationNode()])})},toJson(e){return new X(Mu.create(`to_json`,[E(e)?Q(e):e.toOperationNode()]))}})}const Iu=O({is(e){return e.kind===`UnaryOperationNode`},create(e,t){return O({kind:`UnaryOperationNode`,operator:e,operand:t})}});function Lu(e,t){return Iu.create(nc.create(e),F(t))}const Z=O({is(e){return e.kind===`CaseNode`},create(e){return O({kind:`CaseNode`,value:e})},cloneWithWhen(e,t){return O({...e,when:O(e.when?[...e.when,t]:[t])})},cloneWithThen(e,t){return O({...e,when:e.when?O([...e.when.slice(0,-1),pl.cloneWithResult(e.when[e.when.length-1],t)]):void 0})},cloneWith(e,t){return O({...e,...t})}});var Ru=class{#props;constructor(e){this.#props=O(e)}when(...e){return new zu({...this.#props,node:Z.cloneWithWhen(this.#props.node,pl.create(R(e)))})}},zu=class{#props;constructor(e){this.#props=O(e)}then(e){return new Bu({...this.#props,node:Z.cloneWithThen(this.#props.node,Ac(e)?jc(e):L(e))})}},Bu=class{#props;constructor(e){this.#props=O(e)}when(...e){return new zu({...this.#props,node:Z.cloneWithWhen(this.#props.node,pl.create(R(e)))})}else(e){return new Vu({...this.#props,node:Z.cloneWith(this.#props.node,{else:Ac(e)?jc(e):L(e)})})}end(){return new X(Z.cloneWith(this.#props.node,{isStatement:!1}))}endCase(){return new X(Z.cloneWith(this.#props.node,{isStatement:!0}))}},Vu=class{#props;constructor(e){this.#props=O(e)}end(){return new X(Z.cloneWith(this.#props.node,{isStatement:!1}))}endCase(){return new X(Z.cloneWith(this.#props.node,{isStatement:!0}))}};const Hu=O({is(e){return e.kind===`JSONPathLegNode`},create(e,t){return O({kind:`JSONPathLegNode`,type:e,value:t})}});var Uu=class{#node;constructor(e){this.#node=e}at(e){return this.#createBuilderWithPathLeg(`ArrayLocation`,e)}key(e){return this.#createBuilderWithPathLeg(`Member`,e)}#createBuilderWithPathLeg(e,t){return mc.is(this.#node)?new Wu(mc.cloneWithTraversal(this.#node,gc.is(this.#node.traversal)?gc.cloneWithLeg(this.#node.traversal,Hu.create(e,t)):hc.cloneWithValue(this.#node.traversal,I.createImmediate(t)))):new Wu(gc.cloneWithLeg(this.#node,Hu.create(e,t)))}},Wu=class e extends Uu{#node;constructor(e){super(e),this.#node=e}get expressionType(){}as(e){return new Gu(this,e)}$castTo(){return new e(this.#node)}$notNull(){return new e(this.#node)}toOperationNode(){return this.#node}},Gu=class{#jsonPath;#alias;constructor(e,t){this.#jsonPath=e,this.#alias=t}get expression(){return this.#jsonPath}get alias(){return this.#alias}toOperationNode(){return Bs.create(this.#jsonPath.toOperationNode(),M(this.#alias)?this.#alias.toOperationNode():A.create(this.#alias))}};const Ku=O({is(e){return e.kind===`TupleNode`},create(e){return O({kind:`TupleNode`,values:O(e)})}}),qu=`varchar.char.text.integer.int2.int4.int8.smallint.bigint.boolean.real.double precision.float4.float8.decimal.numeric.binary.bytea.date.datetime.time.timetz.timestamp.timestamptz.serial.bigserial.uuid.json.jsonb.blob.varbinary.int4range.int4multirange.int8range.int8multirange.numrange.nummultirange.tsrange.tsmultirange.tstzrange.tstzmultirange.daterange.datemultirange`.split(`.`),Ju=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],Yu=O({is(e){return e.kind===`DataTypeNode`},create(e){return O({kind:`DataTypeNode`,dataType:e})}});function Xu(e){return!!(qu.includes(e)||Ju.some(t=>t.test(e)))}function Zu(e){if(M(e))return e.toOperationNode();if(Xu(e))return Yu.create(e);throw Error(`invalid column data type ${JSON.stringify(e)}`)}const Qu=O({is(e){return e.kind===`CastNode`},create(e,t){return O({kind:`CastNode`,expression:e,dataType:t})}});function $u(e=au){function t(e,t,n){return new X(Pc(e,t,n))}function n(e,t){return new X(Lu(e,t))}let r=Object.assign(t,{fn:void 0,eb:void 0,selectFrom(t){return ku({queryId:q(),executor:e,queryNode:z.createFrom(id(t))})},case(e){return new Ru({node:Z.create(Cs(e)?void 0:F(e))})},ref(e,t){return Cs(t)?new X(bc(e)):new Uu(yc(e,t))},jsonPath(){return new Uu(gc.create())},table(e){return new X(Q(e))},val(e){return new X(L(e))},refTuple(...e){return new X(Ku.create(e.map(F)))},tuple(...e){return new X(Ku.create(e.map(L)))},lit(e){return new X(jc(e))},unary:n,not(e){return n(`not`,e)},exists(e){return n(`exists`,e)},neg(e){return n(`-`,e)},between(e,t,n){return new X(Ys.create(F(e),nc.create(`between`),Gs.create(L(t),L(n))))},betweenSymmetric(e,t,n){return new X(Ys.create(F(e),nc.create(`between symmetric`),Gs.create(L(t),L(n))))},and(e){return js(e)?new X(Lc(e,`and`)):new X(Ic(e,`and`))},or(e){return js(e)?new X(Lc(e,`or`)):new X(Ic(e,`or`))},parens(...e){let t=R(e);return Nc.is(t)?new X(t):new X(Nc.create(t))},cast(e,t){return new X(Qu.create(F(e),Zu(t)))},withSchema(t){return $u(e.withPluginAtFront(new Yl(t)))}});return r.fn=Fu(),r.eb=r,r}function ed(e){return $u()}function td(e){if(M(e))return e.toOperationNode();if(D(e))return e(ed()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(e)}`)}function nd(e){if(M(e))return e.toOperationNode();if(D(e))return e(ed()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function rd(e){return Hs(e)||Us(e)||D(e)}function id(e){return js(e)?e.map(e=>ad(e)):[ad(e)]}function ad(e){return E(e)?od(e):nd(e)}function od(e){let t=` as `;if(e.includes(t)){let[n,r]=e.split(t).map(sd);return Bs.create(Q(n),A.create(r))}else return Q(e)}function Q(e){if(e.includes(`.`)){let[t,n]=e.split(`.`).map(sd);return Vs.createWithSchema(t,n)}else return Vs.create(e)}function sd(e){return e.trim()}const cd=O({is(e){return e.kind===`AddColumnNode`},create(e){return O({kind:`AddColumnNode`,column:e})}}),$=O({is(e){return e.kind===`ColumnDefinitionNode`},create(e,t){return O({kind:`ColumnDefinitionNode`,column:N.create(e),dataType:t})},cloneWithFrontModifier(e,t){return O({...e,frontModifiers:e.frontModifiers?O([...e.frontModifiers,t]):[t]})},cloneWithEndModifier(e,t){return O({...e,endModifiers:e.endModifiers?O([...e.endModifiers,t]):[t]})},cloneWith(e,t){return O({...e,...t})}}),ld=O({is(e){return e.kind===`DropColumnNode`},create(e){return O({kind:`DropColumnNode`,column:N.create(e)})}}),ud=O({is(e){return e.kind===`RenameColumnNode`},create(e,t){return O({kind:`RenameColumnNode`,column:N.create(e),renameTo:N.create(t)})}}),dd=O({is(e){return e.kind===`CheckConstraintNode`},create(e,t){return O({kind:`CheckConstraintNode`,expression:e,name:t?A.create(t):void 0})}}),fd=[`no action`,`restrict`,`cascade`,`set null`,`set default`],pd=O({is(e){return e.kind===`ReferencesNode`},create(e,t){return O({kind:`ReferencesNode`,table:e,columns:O([...t])})},cloneWithOnDelete(e,t){return O({...e,onDelete:t})},cloneWithOnUpdate(e,t){return O({...e,onUpdate:t})}});function md(e){return M(e)?e.toOperationNode():I.createImmediate(e)}const hd=O({is(e){return e.kind===`GeneratedNode`},create(e){return O({kind:`GeneratedNode`,...e})},createWithExpression(e){return O({kind:`GeneratedNode`,always:!0,expression:e})},cloneWith(e,t){return O({...e,...t})}}),gd=O({is(e){return e.kind===`DefaultValueNode`},create(e){return O({kind:`DefaultValueNode`,defaultValue:e})}});function _d(e){if(fd.includes(e))return e;throw Error(`invalid OnModifyForeignAction ${e}`)}var vd=class e{#node;constructor(e){this.#node=e}autoIncrement(){return new e($.cloneWith(this.#node,{autoIncrement:!0}))}identity(){return new e($.cloneWith(this.#node,{identity:!0}))}primaryKey(){return new e($.cloneWith(this.#node,{primaryKey:!0}))}references(t){let n=bc(t);if(!n.table||ic.is(n.column))throw Error(`invalid call references('${t}'). The reference must have format table.column or schema.table.column`);return new e($.cloneWith(this.#node,{references:pd.create(n.table,[n.column])}))}onDelete(t){if(!this.#node.references)throw Error(`on delete constraint can only be added for foreign keys`);return new e($.cloneWith(this.#node,{references:pd.cloneWithOnDelete(this.#node.references,_d(t))}))}onUpdate(t){if(!this.#node.references)throw Error(`on update constraint can only be added for foreign keys`);return new e($.cloneWith(this.#node,{references:pd.cloneWithOnUpdate(this.#node.references,_d(t))}))}unique(){return new e($.cloneWith(this.#node,{unique:!0}))}notNull(){return new e($.cloneWith(this.#node,{notNull:!0}))}unsigned(){return new e($.cloneWith(this.#node,{unsigned:!0}))}defaultTo(t){return new e($.cloneWith(this.#node,{defaultTo:gd.create(md(t))}))}check(t){return new e($.cloneWith(this.#node,{check:dd.create(t.toOperationNode())}))}generatedAlwaysAs(t){return new e($.cloneWith(this.#node,{generated:hd.createWithExpression(t.toOperationNode())}))}generatedAlwaysAsIdentity(){return new e($.cloneWith(this.#node,{generated:hd.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new e($.cloneWith(this.#node,{generated:hd.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#node.generated)throw Error(`stored() can only be called after generatedAlwaysAs`);return new e($.cloneWith(this.#node,{generated:hd.cloneWith(this.#node.generated,{stored:!0})}))}modifyFront(t){return new e($.cloneWithFrontModifier(this.#node,t.toOperationNode()))}nullsNotDistinct(){return new e($.cloneWith(this.#node,{nullsNotDistinct:!0}))}ifNotExists(){return new e($.cloneWith(this.#node,{ifNotExists:!0}))}modifyEnd(t){return new e($.cloneWithEndModifier(this.#node,t.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#node}};B(vd,`don't await ColumnDefinitionBuilder instances directly.`);const yd=O({is(e){return e.kind===`ModifyColumnNode`},create(e){return O({kind:`ModifyColumnNode`,column:e})}}),bd=O({is(e){return e.kind===`ForeignKeyConstraintNode`},create(e,t,n,r){return O({kind:`ForeignKeyConstraintNode`,columns:e,references:pd.create(t,n),name:r?A.create(r):void 0})},cloneWith(e,t){return O({...e,...t})}});var xd=class e{#node;constructor(e){this.#node=e}onDelete(t){return new e(bd.cloneWith(this.#node,{onDelete:_d(t)}))}onUpdate(t){return new e(bd.cloneWith(this.#node,{onUpdate:_d(t)}))}$call(e){return e(this)}toOperationNode(){return this.#node}};B(xd,`don't await ForeignKeyConstraintBuilder instances directly.`);const Sd=O({is(e){return e.kind===`AddConstraintNode`},create(e){return O({kind:`AddConstraintNode`,constraint:e})}}),Cd=O({is(e){return e.kind===`UniqueConstraintNode`},create(e,t,n){return O({kind:`UniqueConstraintNode`,columns:O(e.map(N.create)),name:t?A.create(t):void 0,nullsNotDistinct:n})},cloneWith(e,t){return O({...e,...t})}}),wd=O({is(e){return e.kind===`DropConstraintNode`},create(e){return O({kind:`DropConstraintNode`,constraintName:A.create(e)})},cloneWith(e,t){return O({...e,...t})}}),Td=O({is(e){return e.kind===`AlterColumnNode`},create(e,t,n){return O({kind:`AlterColumnNode`,column:N.create(e),[t]:n})}});var Ed=class{#column;constructor(e){this.#column=e}setDataType(e){return new Dd(Td.create(this.#column,`dataType`,Zu(e)))}setDefault(e){return new Dd(Td.create(this.#column,`setDefault`,md(e)))}dropDefault(){return new Dd(Td.create(this.#column,`dropDefault`,!0))}setNotNull(){return new Dd(Td.create(this.#column,`setNotNull`,!0))}dropNotNull(){return new Dd(Td.create(this.#column,`dropNotNull`,!0))}$call(e){return e(this)}};B(Ed,`don't await AlterColumnBuilder instances`);var Dd=class{#alterColumnNode;constructor(e){this.#alterColumnNode=e}toOperationNode(){return this.#alterColumnNode}};B(Dd,`don't await AlteredColumnBuilder instances`);var Od=class{#props;constructor(e){this.#props=O(e)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Od,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var kd=class e{#props;constructor(e){this.#props=O(e)}onDelete(t){return new e({...this.#props,constraintBuilder:this.#props.constraintBuilder.onDelete(t)})}onUpdate(t){return new e({...this.#props,constraintBuilder:this.#props.constraintBuilder.onUpdate(t)})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(k.cloneWithTableProps(this.#props.node,{addConstraint:Sd.create(this.#props.constraintBuilder.toOperationNode())}),this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(kd,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var Ad=class e{#props;constructor(e){this.#props=O(e)}ifExists(){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{dropConstraint:wd.cloneWith(this.#props.node.dropConstraint,{ifExists:!0})})})}cascade(){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{dropConstraint:wd.cloneWith(this.#props.node.dropConstraint,{modifier:`cascade`})})})}restrict(){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{dropConstraint:wd.cloneWith(this.#props.node.dropConstraint,{modifier:`restrict`})})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Ad,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const jd=O({is(e){return e.kind===`PrimaryKeyConstraintNode`},create(e,t){return O({kind:`PrimaryKeyConstraintNode`,columns:O(e.map(N.create)),name:t?A.create(t):void 0})}}),Md=O({is(e){return e.kind===`AddIndexNode`},create(e){return O({kind:`AddIndexNode`,name:A.create(e)})},cloneWith(e,t){return O({...e,...t})},cloneWithColumns(e,t){return O({...e,columns:[...e.columns||[],...t]})}});var Nd=class e{#props;constructor(e){this.#props=O(e)}unique(){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addIndex:Md.cloneWith(this.#props.node.addIndex,{unique:!0})})})}column(t){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addIndex:Md.cloneWithColumns(this.#props.node.addIndex,[Cc(t)])})})}columns(t){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addIndex:Md.cloneWithColumns(this.#props.node.addIndex,t.map(Cc))})})}expression(t){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addIndex:Md.cloneWithColumns(this.#props.node.addIndex,[t.toOperationNode()])})})}using(t){return new e({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addIndex:Md.cloneWith(this.#props.node.addIndex,{using:P.createWithSql(t)})})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Nd,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var Pd=class e{#node;constructor(e){this.#node=e}toOperationNode(){return this.#node}nullsNotDistinct(){return new e(Cd.cloneWith(this.#node,{nullsNotDistinct:!0}))}};B(Pd,`don't await UniqueConstraintNodeBuilder instances directly.`);var Fd=class{#props;constructor(e){this.#props=O(e)}renameTo(e){return new Od({...this.#props,node:k.cloneWithTableProps(this.#props.node,{renameTo:Q(e)})})}setSchema(e){return new Od({...this.#props,node:k.cloneWithTableProps(this.#props.node,{setSchema:A.create(e)})})}alterColumn(e,t){let n=t(new Ed(e));return new Id({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,n.toOperationNode())})}dropColumn(e){return new Id({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,ld.create(e))})}renameColumn(e,t){return new Id({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,ud.create(e,t))})}addColumn(e,t,n=Ms){let r=n(new vd($.create(e,Zu(t))));return new Id({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,cd.create(r.toOperationNode()))})}modifyColumn(e,t,n=Ms){let r=n(new vd($.create(e,Zu(t))));return new Id({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,yd.create(r.toOperationNode()))})}addUniqueConstraint(e,t,n=Ms){let r=n(new Pd(Cd.create(t,e)));return new Od({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addConstraint:Sd.create(r.toOperationNode())})})}addCheckConstraint(e,t){return new Od({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addConstraint:Sd.create(dd.create(t.toOperationNode(),e))})})}addForeignKeyConstraint(e,t,n,r){return new kd({...this.#props,constraintBuilder:new xd(bd.create(t.map(N.create),Q(n),r.map(N.create),e))})}addPrimaryKeyConstraint(e,t){return new Od({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addConstraint:Sd.create(jd.create(t,e))})})}dropConstraint(e){return new Ad({...this.#props,node:k.cloneWithTableProps(this.#props.node,{dropConstraint:wd.create(e)})})}addIndex(e){return new Nd({...this.#props,node:k.cloneWithTableProps(this.#props.node,{addIndex:Md.create(e)})})}dropIndex(e){return new Od({...this.#props,node:k.cloneWithTableProps(this.#props.node,{dropIndex:Ls.create(e)})})}$call(e){return e(this)}};B(Fd,`don't await AlterTableBuilder instances`);var Id=class e{#props;constructor(e){this.#props=O(e)}alterColumn(t,n){let r=n(new Ed(t));return new e({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,r.toOperationNode())})}dropColumn(t){return new e({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,ld.create(t))})}renameColumn(t,n){return new e({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,ud.create(t,n))})}addColumn(t,n,r=Ms){let i=r(new vd($.create(t,Zu(n))));return new e({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,cd.create(i.toOperationNode()))})}modifyColumn(t,n,r=Ms){let i=r(new vd($.create(t,Zu(n))));return new e({...this.#props,node:k.cloneWithColumnAlteration(this.#props.node,yd.create(i.toOperationNode()))})}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Id,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");var Ld=class extends Gl{transformValue(e){return{...super.transformValue(e),immediate:!0}}},Rd=class e{#props;constructor(e){this.#props=O(e)}ifNotExists(){return new e({...this.#props,node:Ns.cloneWith(this.#props.node,{ifNotExists:!0})})}unique(){return new e({...this.#props,node:Ns.cloneWith(this.#props.node,{unique:!0})})}nullsNotDistinct(){return new e({...this.#props,node:Ns.cloneWith(this.#props.node,{nullsNotDistinct:!0})})}on(t){return new e({...this.#props,node:Ns.cloneWith(this.#props.node,{table:Q(t)})})}column(t){return new e({...this.#props,node:Ns.cloneWithColumns(this.#props.node,[Cc(t)])})}columns(t){return new e({...this.#props,node:Ns.cloneWithColumns(this.#props.node,t.map(Cc))})}expression(t){return new e({...this.#props,node:Ns.cloneWithColumns(this.#props.node,[t.toOperationNode()])})}using(t){return new e({...this.#props,node:Ns.cloneWith(this.#props.node,{using:P.createWithSql(t)})})}where(...t){let n=new Ld;return new e({...this.#props,node:G.cloneWithWhere(this.#props.node,n.transformNode(R(t)))})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Rd,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var zd=class e{#props;constructor(e){this.#props=O(e)}ifNotExists(){return new e({...this.#props,node:Ps.cloneWith(this.#props.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(zd,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function Bd(e){if(Fs.includes(e))return e;throw Error(`invalid OnCommitAction ${e}`)}var Vd=class e{#props;constructor(e){this.#props=O(e)}temporary(){return new e({...this.#props,node:j.cloneWith(this.#props.node,{temporary:!0})})}onCommit(t){return new e({...this.#props,node:j.cloneWith(this.#props.node,{onCommit:Bd(t)})})}ifNotExists(){return new e({...this.#props,node:j.cloneWith(this.#props.node,{ifNotExists:!0})})}addColumn(t,n,r=Ms){let i=r(new vd($.create(t,Zu(n))));return new e({...this.#props,node:j.cloneWithColumn(this.#props.node,i.toOperationNode())})}addPrimaryKeyConstraint(t,n){return new e({...this.#props,node:j.cloneWithConstraint(this.#props.node,jd.create(n,t))})}addUniqueConstraint(t,n,r=Ms){let i=r(new Pd(Cd.create(n,t)));return new e({...this.#props,node:j.cloneWithConstraint(this.#props.node,i.toOperationNode())})}addCheckConstraint(t,n){return new e({...this.#props,node:j.cloneWithConstraint(this.#props.node,dd.create(n.toOperationNode(),t))})}addForeignKeyConstraint(t,n,r,i,a=Ms){let o=a(new xd(bd.create(n.map(N.create),Q(r),i.map(N.create),t)));return new e({...this.#props,node:j.cloneWithConstraint(this.#props.node,o.toOperationNode())})}modifyFront(t){return new e({...this.#props,node:j.cloneWithFrontModifier(this.#props.node,t.toOperationNode())})}modifyEnd(t){return new e({...this.#props,node:j.cloneWithEndModifier(this.#props.node,t.toOperationNode())})}as(t){return new e({...this.#props,node:j.cloneWith(this.#props.node,{selectQuery:td(t)})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Vd,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Hd=class e{#props;constructor(e){this.#props=O(e)}on(t){return new e({...this.#props,node:Ls.cloneWith(this.#props.node,{table:Q(t)})})}ifExists(){return new e({...this.#props,node:Ls.cloneWith(this.#props.node,{ifExists:!0})})}cascade(){return new e({...this.#props,node:Ls.cloneWith(this.#props.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Hd,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var Ud=class e{#props;constructor(e){this.#props=O(e)}ifExists(){return new e({...this.#props,node:Rs.cloneWith(this.#props.node,{ifExists:!0})})}cascade(){return new e({...this.#props,node:Rs.cloneWith(this.#props.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Ud,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var Wd=class e{#props;constructor(e){this.#props=O(e)}ifExists(){return new e({...this.#props,node:zs.cloneWith(this.#props.node,{ifExists:!0})})}cascade(){return new e({...this.#props,node:zs.cloneWith(this.#props.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Wd,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const Gd=O({is(e){return e.kind===`CreateViewNode`},create(e){return O({kind:`CreateViewNode`,name:Is.create(e)})},cloneWith(e,t){return O({...e,...t})}});var Kd=class{#transformer=new Ld;transformQuery(e){return this.#transformer.transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}},qd=class e{#props;constructor(e){this.#props=O(e)}temporary(){return new e({...this.#props,node:Gd.cloneWith(this.#props.node,{temporary:!0})})}materialized(){return new e({...this.#props,node:Gd.cloneWith(this.#props.node,{materialized:!0})})}ifNotExists(){return new e({...this.#props,node:Gd.cloneWith(this.#props.node,{ifNotExists:!0})})}orReplace(){return new e({...this.#props,node:Gd.cloneWith(this.#props.node,{orReplace:!0})})}columns(t){return new e({...this.#props,node:Gd.cloneWith(this.#props.node,{columns:t.map(Sc)})})}as(t){let n=t.withPlugin(new Kd).toOperationNode();return new e({...this.#props,node:Gd.cloneWith(this.#props.node,{as:n})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(qd,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const Jd=O({is(e){return e.kind===`DropViewNode`},create(e){return O({kind:`DropViewNode`,name:Is.create(e)})},cloneWith(e,t){return O({...e,...t})}});var Yd=class e{#props;constructor(e){this.#props=O(e)}materialized(){return new e({...this.#props,node:Jd.cloneWith(this.#props.node,{materialized:!0})})}ifExists(){return new e({...this.#props,node:Jd.cloneWith(this.#props.node,{ifExists:!0})})}cascade(){return new e({...this.#props,node:Jd.cloneWith(this.#props.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Yd,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Xd=O({is(e){return e.kind===`CreateTypeNode`},create(e){return O({kind:`CreateTypeNode`,name:e})},cloneWithEnum(e,t){return O({...e,enum:Oc.create(t.map(e=>I.createImmediate(e)))})}});var Zd=class e{#props;constructor(e){this.#props=O(e)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}asEnum(t){return new e({...this.#props,node:Xd.cloneWithEnum(this.#props.node,t)})}$call(e){return e(this)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B(Zd,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Qd=O({is(e){return e.kind===`DropTypeNode`},create(e){return O({kind:`DropTypeNode`,name:e})},cloneWith(e,t){return O({...e,...t})}});var $d=class e{#props;constructor(e){this.#props=O(e)}ifExists(){return new e({...this.#props,node:Qd.cloneWith(this.#props.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#props.executor.transformQuery(this.#props.node,this.#props.queryId)}compile(){return this.#props.executor.compileQuery(this.toOperationNode(),this.#props.queryId)}async execute(){await this.#props.executor.executeQuery(this.compile(),this.#props.queryId)}};B($d,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function ef(e){if(e.includes(`.`)){let t=e.split(`.`).map(tf);if(t.length===2)return Is.createWithSchema(t[0],t[1]);throw Error(`invalid schemable identifier ${e}`)}else return Is.create(e)}function tf(e){return e.trim()}var nf=class e{#executor;constructor(e){this.#executor=e}createTable(e){return new Vd({queryId:q(),executor:this.#executor,node:j.create(Q(e))})}dropTable(e){return new Wd({queryId:q(),executor:this.#executor,node:zs.create(Q(e))})}createIndex(e){return new Rd({queryId:q(),executor:this.#executor,node:Ns.create(e)})}dropIndex(e){return new Hd({queryId:q(),executor:this.#executor,node:Ls.create(e)})}createSchema(e){return new zd({queryId:q(),executor:this.#executor,node:Ps.create(e)})}dropSchema(e){return new Ud({queryId:q(),executor:this.#executor,node:Rs.create(e)})}alterTable(e){return new Fd({queryId:q(),executor:this.#executor,node:k.create(Q(e))})}createView(e){return new qd({queryId:q(),executor:this.#executor,node:Gd.create(e)})}dropView(e){return new Yd({queryId:q(),executor:this.#executor,node:Jd.create(e)})}createType(e){return new Zd({queryId:q(),executor:this.#executor,node:Xd.create(ef(e))})}dropType(e){return new $d({queryId:q(),executor:this.#executor,node:Qd.create(ef(e))})}withPlugin(t){return new e(this.#executor.withPlugin(t))}withoutPlugins(){return new e(this.#executor.withoutPlugins())}withSchema(t){return new e(this.#executor.withPluginAtFront(new Yl(t)))}},rf=class{ref(e){return new oc(e)}},af=class{#driver;constructor(e){this.#driver=e}async provideConnection(e){let t=await this.#driver.acquireConnection();try{return await e(t)}finally{await this.#driver.releaseConnection(t)}}},sf=class e extends ru{#compiler;#adapter;#connectionProvider;constructor(e,t,n,r=[]){super(r),this.#compiler=e,this.#adapter=t,this.#connectionProvider=n}get adapter(){return this.#adapter}compileQuery(e){return this.#compiler.compileQuery(e)}provideConnection(e){return this.#connectionProvider.provideConnection(e)}withPlugins(t){return new e(this.#compiler,this.#adapter,this.#connectionProvider,[...this.plugins,...t])}withPlugin(t){return new e(this.#compiler,this.#adapter,this.#connectionProvider,[...this.plugins,t])}withPluginAtFront(t){return new e(this.#compiler,this.#adapter,this.#connectionProvider,[t,...this.plugins])}withConnectionProvider(t){return new e(this.#compiler,this.#adapter,t,[...this.plugins])}withoutPlugins(){return new e(this.#compiler,this.#adapter,this.#connectionProvider,[])}};function cf(){return typeof performance<`u`&&D(performance.now)?performance.now():Date.now()}var lf=class{#driver;#log;#initPromise;#initDone;#destroyPromise;#connections=new WeakSet;constructor(e,t){this.#initDone=!1,this.#driver=e,this.#log=t}async init(){if(this.#destroyPromise)throw Error(`driver has already been destroyed`);this.#initPromise||=this.#driver.init().then(()=>{this.#initDone=!0}).catch(e=>(this.#initPromise=void 0,Promise.reject(e))),await this.#initPromise}async acquireConnection(){if(this.#destroyPromise)throw Error(`driver has already been destroyed`);this.#initDone||await this.init();let e=await this.#driver.acquireConnection();return this.#connections.has(e)||(this.#needsLogging()&&this.#addLogging(e),this.#connections.add(e)),e}async releaseConnection(e){await this.#driver.releaseConnection(e)}beginTransaction(e,t){return this.#driver.beginTransaction(e,t)}commitTransaction(e){return this.#driver.commitTransaction(e)}rollbackTransaction(e){return this.#driver.rollbackTransaction(e)}async destroy(){this.#initPromise&&(await this.#initPromise,this.#destroyPromise||=this.#driver.destroy().catch(e=>(this.#destroyPromise=void 0,Promise.reject(e))),await this.#destroyPromise)}#needsLogging(){return this.#log.isLevelEnabled(`query`)||this.#log.isLevelEnabled(`error`)}#addLogging(e){let t=e.executeQuery;e.executeQuery=async n=>{let r,i=cf();try{return await t.call(e,n)}catch(e){throw r=e,await this.#logError(e,n,i),e}finally{r||await this.#logQuery(n,i)}}}async#logError(e,t,n){await this.#log.error(()=>({level:`error`,error:e,query:t,queryDurationMillis:this.#calculateDurationMillis(n)}))}async#logQuery(e,t){await this.#log.query(()=>({level:`query`,query:e,queryDurationMillis:this.#calculateDurationMillis(t)}))}#calculateDurationMillis(e){return cf()-e}};const uf=()=>{};var df=class{#connection;#runningPromise;constructor(e){this.#connection=e}async provideConnection(e){for(;this.#runningPromise;)await this.#runningPromise.catch(uf);return this.#runningPromise=this.#run(e).finally(()=>{this.#runningPromise=void 0}),this.#runningPromise}async#run(e){return await e(this.#connection)}};const ff=[`read uncommitted`,`read committed`,`repeatable read`,`serializable`,`snapshot`];O([`query`,`error`]);var pf=class{#levels;#logger;constructor(e){D(e)?(this.#logger=e,this.#levels=O({query:!0,error:!0})):(this.#logger=mf,this.#levels=O({query:e.includes(`query`),error:e.includes(`error`)}))}isLevelEnabled(e){return this.#levels[e]}async query(e){this.#levels.query&&await this.#logger(e())}async error(e){this.#levels.error&&await this.#logger(e())}};function mf(e){e.level===`query`?(console.log(`kysely:query: ${e.query.sql}`),console.log(`kysely:query: duration: ${e.queryDurationMillis.toFixed(1)}ms`)):e.level===`error`&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}function hf(e){return ks(e)&&D(e.compile)}var gf=class e extends du{#props;constructor(e){let t,n;if(vf(e))t={executor:e.executor},n={...e};else{let r=e.dialect,i=r.createDriver(),a=r.createQueryCompiler(),o=r.createAdapter(),s=new pf(e.log??[]),c=new lf(i,s),l=new af(c),ee=new sf(a,o,l,e.plugins??[]);t={executor:ee},n={config:e,executor:ee,dialect:r,driver:c}}super(t),this.#props=O(n)}get schema(){return new nf(this.#props.executor)}get dynamic(){return new rf}get introspection(){return this.#props.dialect.createIntrospector(this.withoutPlugins())}case(e){return new Ru({node:Z.create(Cs(e)?void 0:td(e))})}get fn(){return Fu()}transaction(){return new bf({...this.#props})}connection(){return new yf({...this.#props})}withPlugin(t){return new e({...this.#props,executor:this.#props.executor.withPlugin(t)})}withoutPlugins(){return new e({...this.#props,executor:this.#props.executor.withoutPlugins()})}withSchema(t){return new e({...this.#props,executor:this.#props.executor.withPluginAtFront(new Yl(t))})}withTables(){return new e({...this.#props})}async destroy(){await this.#props.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#props.executor}executeQuery(e,t=q()){let n=hf(e)?e.compile():e;return this.getExecutor().executeQuery(n,t)}},_f=class e extends gf{#props;constructor(e){super(e),this.#props=e}get isTransaction(){return!0}transaction(){throw Error(`calling the transaction method for a Transaction is not supported`)}connection(){throw Error(`calling the connection method for a Transaction is not supported`)}async destroy(){throw Error(`calling the destroy method for a Transaction is not supported`)}withPlugin(t){return new e({...this.#props,executor:this.#props.executor.withPlugin(t)})}withoutPlugins(){return new e({...this.#props,executor:this.#props.executor.withoutPlugins()})}withSchema(t){return new e({...this.#props,executor:this.#props.executor.withPluginAtFront(new Yl(t))})}withTables(){return new e({...this.#props})}};function vf(e){return ks(e)&&ks(e.config)&&ks(e.driver)&&ks(e.executor)&&ks(e.dialect)}var yf=class{#props;constructor(e){this.#props=O(e)}async execute(e){return this.#props.executor.provideConnection(async t=>{let n=this.#props.executor.withConnectionProvider(new df(t)),r=new gf({...this.#props,executor:n});return await e(r)})}};B(yf,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var bf=class e{#props;constructor(e){this.#props=O(e)}setIsolationLevel(t){return new e({...this.#props,isolationLevel:t})}async execute(e){let{isolationLevel:t,...n}=this.#props,r={isolationLevel:t};return xf(r),this.#props.executor.provideConnection(async t=>{let i=this.#props.executor.withConnectionProvider(new df(t)),a=new _f({...n,executor:i});try{await this.#props.driver.beginTransaction(t,r);let n=await e(a);return await this.#props.driver.commitTransaction(t),n}catch(e){throw await this.#props.driver.rollbackTransaction(t),e}})}};B(bf,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function xf(e){if(e.isolationLevel&&!ff.includes(e.isolationLevel))throw Error(`invalid transaction isolation level ${e.isolationLevel}`)}var Sf=class e{#props;constructor(e){this.#props=O(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new wf(this,e)}$castTo(){return new e({...this.#props})}$notNull(){return new e(this.#props)}withPlugin(t){return new e({...this.#props,plugins:this.#props.plugins===void 0?O([t]):O([...this.#props.plugins,t])})}toOperationNode(){return this.#toOperationNode(this.#getExecutor())}compile(e){return this.#compile(this.#getExecutor(e))}async execute(e){let t=this.#getExecutor(e);return t.executeQuery(this.#compile(t),this.#props.queryId)}#getExecutor(e){let t=e===void 0?au:e.getExecutor();return this.#props.plugins===void 0?t:t.withPlugins(this.#props.plugins)}#toOperationNode(e){return e.transformQuery(this.#props.rawNode,this.#props.queryId)}#compile(e){return e.compileQuery(this.#toOperationNode(e),this.#props.queryId)}};function Cf(e){return new Sf(e)}B(Sf,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var wf=class{#rawBuilder;#alias;constructor(e,t){this.#rawBuilder=e,this.#alias=t}get expression(){return this.#rawBuilder}get alias(){return this.#alias}get rawBuilder(){return this.#rawBuilder}toOperationNode(){return Bs.create(this.#rawBuilder.toOperationNode(),M(this.#alias)?this.#alias.toOperationNode():A.create(this.#alias))}};B(wf,`don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.`);const Tf=Object.assign((e,...t)=>Cf({queryId:q(),rawNode:P.create(e,t?.map(Ef)??[])}),{ref(e){return Cf({queryId:q(),rawNode:P.createWithChild(bc(e))})},val(e){return Cf({queryId:q(),rawNode:P.createWithChild(L(e))})},value(e){return this.val(e)},table(e){return Cf({queryId:q(),rawNode:P.createWithChild(Q(e))})},id(...e){let t=Array(e.length+1).fill(`.`);return t[0]=``,t[t.length-1]=``,Cf({queryId:q(),rawNode:P.create(t,e.map(A.create))})},lit(e){return Cf({queryId:q(),rawNode:P.createWithChild(I.createImmediate(e))})},literal(e){return this.lit(e)},raw(e){return Cf({queryId:q(),rawNode:P.createWithSql(e)})},join(e,t=Tf`, `){let n=Array(2*e.length-1),r=t.toOperationNode();for(let t=0;t<e.length;++t)n[2*t]=Ef(e[t]),t!==e.length-1&&(n[2*t+1]=r);return Cf({queryId:q(),rawNode:P.createWithChildren(n)})}});function Ef(e){return M(e)?e.toOperationNode():L(e)}var Df=class{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#visitors=O({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#visitors[e.kind](e),this.nodeStack.pop()}},Of=class extends Df{#sql=``;#parameters=[];get numParameters(){return this.#parameters.length}compileQuery(e){return this.#sql=``,this.#parameters=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),O({query:e,sql:this.getSql(),parameters:[...this.#parameters]})}getSql(){return this.#sql}visitSelectQuery(e){let t=this.parentNode!==void 0&&!Nc.is(this.parentNode)&&!H.is(this.parentNode)&&!j.is(this.parentNode)&&!Gd.is(this.parentNode)&&!bu.is(this.parentNode);this.parentNode===void 0&&e.explain&&(this.visitNode(e.explain),this.append(` `)),t&&this.append(`(`),e.with&&(this.visitNode(e.with),this.append(` `)),this.append(`select`),e.distinctOn&&(this.append(` `),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(` `),this.compileList(e.frontModifiers,` `)),e.top&&(this.append(` `),this.visitNode(e.top)),e.selections&&(this.append(` `),this.compileList(e.selections)),e.from&&(this.append(` `),this.visitNode(e.from)),e.joins&&(this.append(` `),this.compileList(e.joins,` `)),e.where&&(this.append(` `),this.visitNode(e.where)),e.groupBy&&(this.append(` `),this.visitNode(e.groupBy)),e.having&&(this.append(` `),this.visitNode(e.having)),e.setOperations&&(this.append(` `),this.compileList(e.setOperations,` `)),e.orderBy&&(this.append(` `),this.visitNode(e.orderBy)),e.limit&&(this.append(` `),this.visitNode(e.limit)),e.offset&&(this.append(` `),this.visitNode(e.offset)),e.fetch&&(this.append(` `),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(` `),this.compileList(this.sortSelectModifiers([...e.endModifiers]),` `)),t&&this.append(`)`)}visitFrom(e){this.append(`from `),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append(`distinct on (`),this.compileList(e),this.append(`)`)}compileList(e,t=`, `){let n=e.length-1;for(let r=0;r<=n;r++)this.visitNode(e[r]),r<n&&this.append(t)}visitWhere(e){this.append(`where `),this.visitNode(e.where)}visitHaving(e){this.append(`having `),this.visitNode(e.having)}visitInsertQuery(e){let t=this.nodeStack.find(G.is),n=t!==e;!n&&e.explain&&(this.visitNode(e.explain),this.append(` `)),n&&!W.is(t)&&this.append(`(`),e.with&&(this.visitNode(e.with),this.append(` `)),this.append(e.replace?`replace`:`insert`),e.ignore&&this.append(` ignore`),e.top&&(this.append(` `),this.visitNode(e.top)),e.into&&(this.append(` into `),this.visitNode(e.into)),e.columns&&(this.append(` (`),this.compileList(e.columns),this.append(`)`)),e.output&&(this.append(` `),this.visitNode(e.output)),e.values&&(this.append(` `),this.visitNode(e.values)),e.defaultValues&&(this.append(` `),this.append(`default values`)),e.onConflict&&(this.append(` `),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(` `),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(` `),this.visitNode(e.returning)),n&&!W.is(t)&&this.append(`)`),e.endModifiers?.length&&(this.append(` `),this.compileList(e.endModifiers,` `))}visitValues(e){this.append(`values `),this.compileList(e.values)}visitDeleteQuery(e){let t=this.nodeStack.find(G.is)!==e;!t&&e.explain&&(this.visitNode(e.explain),this.append(` `)),t&&this.append(`(`),e.with&&(this.visitNode(e.with),this.append(` `)),this.append(`delete `),e.top&&(this.visitNode(e.top),this.append(` `)),this.visitNode(e.from),e.output&&(this.append(` `),this.visitNode(e.output)),e.using&&(this.append(` `),this.visitNode(e.using)),e.joins&&(this.append(` `),this.compileList(e.joins,` `)),e.where&&(this.append(` `),this.visitNode(e.where)),e.orderBy&&(this.append(` `),this.visitNode(e.orderBy)),e.limit&&(this.append(` `),this.visitNode(e.limit)),e.returning&&(this.append(` `),this.visitNode(e.returning)),t&&this.append(`)`),e.endModifiers?.length&&(this.append(` `),this.compileList(e.endModifiers,` `))}visitReturning(e){this.append(`returning `),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(` as `),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(`.`)),this.visitNode(e.column)}visitSelectAll(e){this.append(`*`)}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!E(e.name))throw Error(`a non-string identifier was passed to compileUnwrappedIdentifier.`);this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(` and `),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(` or `),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append(`(`),this.compileList(e.values),this.append(`)`)}visitTuple(e){this.append(`(`),this.compileList(e.values),this.append(`)`)}visitPrimitiveValueList(e){this.append(`(`);let{values:t}=e;for(let e=0;e<t.length;++e)this.appendValue(t[e]),e!==t.length-1&&this.append(`, `);this.append(`)`)}visitParens(e){this.append(`(`),this.visitNode(e.node),this.append(`)`)}visitJoin(e){this.append(jf[e.joinType]),this.append(` `),this.visitNode(e.table),e.on&&(this.append(` `),this.visitNode(e.on))}visitOn(e){this.append(`on `),this.visitNode(e.on)}visitRaw(e){let{sqlFragments:t,parameters:n}=e;for(let e=0;e<t.length;++e)this.append(t[e]),n.length>e&&this.visitNode(n[e])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(`.`)),this.visitNode(e.identifier)}visitCreateTable(e){this.append(`create `),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers,` `),this.append(` `)),e.temporary&&this.append(`temporary `),this.append(`table `),e.ifNotExists&&this.append(`if not exists `),this.visitNode(e.table),e.selectQuery?(this.append(` as `),this.visitNode(e.selectQuery)):(this.append(` (`),this.compileList([...e.columns,...e.constraints??[]]),this.append(`)`),e.onCommit&&(this.append(` on commit `),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(` `),this.compileList(e.endModifiers,` `)))}visitColumnDefinition(e){e.ifNotExists&&this.append(`if not exists `),this.visitNode(e.column),this.append(` `),this.visitNode(e.dataType),e.unsigned&&this.append(` unsigned`),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(` `),this.compileList(e.frontModifiers,` `)),e.generated&&(this.append(` `),this.visitNode(e.generated)),e.identity&&this.append(` identity`),e.defaultTo&&(this.append(` `),this.visitNode(e.defaultTo)),e.notNull&&this.append(` not null`),e.unique&&this.append(` unique`),e.nullsNotDistinct&&this.append(` nulls not distinct`),e.primaryKey&&this.append(` primary key`),e.autoIncrement&&(this.append(` `),this.append(this.getAutoIncrement())),e.references&&(this.append(` `),this.visitNode(e.references)),e.check&&(this.append(` `),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(` `),this.compileList(e.endModifiers,` `))}getAutoIncrement(){return`auto_increment`}visitReferences(e){this.append(`references `),this.visitNode(e.table),this.append(` (`),this.compileList(e.columns),this.append(`)`),e.onDelete&&(this.append(` on delete `),this.append(e.onDelete)),e.onUpdate&&(this.append(` on update `),this.append(e.onUpdate))}visitDropTable(e){this.append(`drop table `),e.ifExists&&this.append(`if exists `),this.visitNode(e.table),e.cascade&&this.append(` cascade`)}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append(`order by `),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.direction&&(this.append(` `),this.visitNode(e.direction))}visitGroupBy(e){this.append(`group by `),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){let t=this.nodeStack.find(G.is),n=t!==e;!n&&e.explain&&(this.visitNode(e.explain),this.append(` `)),n&&!W.is(t)&&this.append(`(`),e.with&&(this.visitNode(e.with),this.append(` `)),this.append(`update `),e.top&&(this.visitNode(e.top),this.append(` `)),e.table&&(this.visitNode(e.table),this.append(` `)),this.append(`set `),e.updates&&this.compileList(e.updates),e.output&&(this.append(` `),this.visitNode(e.output)),e.from&&(this.append(` `),this.visitNode(e.from)),e.joins&&(this.append(` `),this.compileList(e.joins,` `)),e.where&&(this.append(` `),this.visitNode(e.where)),e.limit&&(this.append(` `),this.visitNode(e.limit)),e.returning&&(this.append(` `),this.visitNode(e.returning)),n&&!W.is(t)&&this.append(`)`),e.endModifiers?.length&&(this.append(` `),this.compileList(e.endModifiers,` `))}visitColumnUpdate(e){this.visitNode(e.column),this.append(` = `),this.visitNode(e.value)}visitLimit(e){this.append(`limit `),this.visitNode(e.limit)}visitOffset(e){this.append(`offset `),this.visitNode(e.offset)}visitOnConflict(e){this.append(`on conflict`),e.columns?(this.append(` (`),this.compileList(e.columns),this.append(`)`)):e.constraint?(this.append(` on constraint `),this.visitNode(e.constraint)):e.indexExpression&&(this.append(` (`),this.visitNode(e.indexExpression),this.append(`)`)),e.indexWhere&&(this.append(` `),this.visitNode(e.indexWhere)),e.doNothing===!0?this.append(` do nothing`):e.updates&&(this.append(` do update set `),this.compileList(e.updates),e.updateWhere&&(this.append(` `),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append(`on duplicate key update `),this.compileList(e.updates)}visitCreateIndex(e){this.append(`create `),e.unique&&this.append(`unique `),this.append(`index `),e.ifNotExists&&this.append(`if not exists `),this.visitNode(e.name),e.table&&(this.append(` on `),this.visitNode(e.table)),e.using&&(this.append(` using `),this.visitNode(e.using)),e.columns&&(this.append(` (`),this.compileList(e.columns),this.append(`)`)),e.nullsNotDistinct&&this.append(` nulls not distinct`),e.where&&(this.append(` `),this.visitNode(e.where))}visitDropIndex(e){this.append(`drop index `),e.ifExists&&this.append(`if exists `),this.visitNode(e.name),e.table&&(this.append(` on `),this.visitNode(e.table)),e.cascade&&this.append(` cascade`)}visitCreateSchema(e){this.append(`create schema `),e.ifNotExists&&this.append(`if not exists `),this.visitNode(e.schema)}visitDropSchema(e){this.append(`drop schema `),e.ifExists&&this.append(`if exists `),this.visitNode(e.schema),e.cascade&&this.append(` cascade`)}visitPrimaryKeyConstraint(e){e.name&&(this.append(`constraint `),this.visitNode(e.name),this.append(` `)),this.append(`primary key (`),this.compileList(e.columns),this.append(`)`)}visitUniqueConstraint(e){e.name&&(this.append(`constraint `),this.visitNode(e.name),this.append(` `)),this.append(`unique`),e.nullsNotDistinct&&this.append(` nulls not distinct`),this.append(` (`),this.compileList(e.columns),this.append(`)`)}visitCheckConstraint(e){e.name&&(this.append(`constraint `),this.visitNode(e.name),this.append(` `)),this.append(`check (`),this.visitNode(e.expression),this.append(`)`)}visitForeignKeyConstraint(e){e.name&&(this.append(`constraint `),this.visitNode(e.name),this.append(` `)),this.append(`foreign key (`),this.compileList(e.columns),this.append(`) `),this.visitNode(e.references),e.onDelete&&(this.append(` on delete `),this.append(e.onDelete)),e.onUpdate&&(this.append(` on update `),this.append(e.onUpdate))}visitList(e){this.compileList(e.items)}visitWith(e){this.append(`with `),e.recursive&&this.append(`recursive `),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(` as `),Ts(e.materialized)&&(e.materialized||this.append(`not `),this.append(`materialized `)),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append(`(`),this.compileList(e.columns),this.append(`)`))}visitAlterTable(e){this.append(`alter table `),this.visitNode(e.table),this.append(` `),e.renameTo&&(this.append(`rename to `),this.visitNode(e.renameTo)),e.setSchema&&(this.append(`set schema `),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append(`add column `),this.visitNode(e.column)}visitRenameColumn(e){this.append(`rename column `),this.visitNode(e.column),this.append(` to `),this.visitNode(e.renameTo)}visitDropColumn(e){this.append(`drop column `),this.visitNode(e.column)}visitAlterColumn(e){this.append(`alter column `),this.visitNode(e.column),this.append(` `),e.dataType&&(this.announcesNewColumnDataType()&&this.append(`type `),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append(`using `),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append(`set default `),this.visitNode(e.setDefault)),e.dropDefault&&this.append(`drop default`),e.setNotNull&&this.append(`set not null`),e.dropNotNull&&this.append(`drop not null`)}visitModifyColumn(e){this.append(`modify column `),this.visitNode(e.column)}visitAddConstraint(e){this.append(`add `),this.visitNode(e.constraint)}visitDropConstraint(e){this.append(`drop constraint `),e.ifExists&&this.append(`if exists `),this.visitNode(e.constraintName),e.modifier===`cascade`?this.append(` cascade`):e.modifier===`restrict`&&this.append(` restrict`)}visitSetOperation(e){this.append(e.operator),this.append(` `),e.all&&this.append(`all `),this.visitNode(e.expression)}visitCreateView(e){this.append(`create `),e.orReplace&&this.append(`or replace `),e.materialized&&this.append(`materialized `),e.temporary&&this.append(`temporary `),this.append(`view `),e.ifNotExists&&this.append(`if not exists `),this.visitNode(e.name),this.append(` `),e.columns&&(this.append(`(`),this.compileList(e.columns),this.append(`) `)),e.as&&(this.append(`as `),this.visitNode(e.as))}visitDropView(e){this.append(`drop `),e.materialized&&this.append(`materialized `),this.append(`view `),e.ifExists&&this.append(`if exists `),this.visitNode(e.name),e.cascade&&this.append(` cascade`)}visitGenerated(e){this.append(`generated `),e.always&&this.append(`always `),e.byDefault&&this.append(`by default `),this.append(`as `),e.identity&&this.append(`identity`),e.expression&&(this.append(`(`),this.visitNode(e.expression),this.append(`)`)),e.stored&&this.append(` stored`)}visitDefaultValue(e){this.append(`default `),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append(kf[e.modifier]),e.of&&(this.append(` of `),this.compileList(e.of,`, `))}visitCreateType(e){this.append(`create type `),this.visitNode(e.name),e.enum&&(this.append(` as enum `),this.visitNode(e.enum))}visitDropType(e){this.append(`drop type `),e.ifExists&&this.append(`if exists `),this.visitNode(e.name)}visitExplain(e){this.append(`explain`),(e.options||e.format)&&(this.append(` `),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append(`format`),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append(`default`)}visitAggregateFunction(e){this.append(e.func),this.append(`(`),e.distinct&&this.append(`distinct `),this.compileList(e.aggregated),e.orderBy&&(this.append(` `),this.visitNode(e.orderBy)),this.append(`)`),e.filter&&(this.append(` filter(`),this.visitNode(e.filter),this.append(`)`)),e.over&&(this.append(` `),this.visitNode(e.over))}visitOver(e){this.append(`over(`),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(` `)),e.orderBy&&this.visitNode(e.orderBy),this.append(`)`)}visitPartitionBy(e){this.append(`partition by `),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(` `),this.visitNode(e.operator),this.append(` `),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(` `),this.visitNode(e.operand)}isMinusOperator(e){return nc.is(e)&&e.operator===`-`}visitUsing(e){this.append(`using `),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append(`(`),this.compileList(e.arguments),this.append(`)`)}visitCase(e){this.append(`case`),e.value&&(this.append(` `),this.visitNode(e.value)),e.when&&(this.append(` `),this.compileList(e.when,` `)),e.else&&(this.append(` else `),this.visitNode(e.else)),this.append(` end`),e.isStatement&&this.append(` case`)}visitWhen(e){this.append(`when `),this.visitNode(e.condition),e.result&&(this.append(` then `),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){e.inOperator&&this.visitNode(e.inOperator),this.append(`'$`);for(let t of e.pathLegs)this.visitNode(t);this.append(`'`)}visitJSONPathLeg(e){let t=e.type===`ArrayLocation`;this.append(t?`[`:`.`),this.append(String(e.value)),t&&this.append(`]`)}visitJSONOperatorChain(e){for(let t=0,n=e.values.length;t<n;t++)t===n-1?this.visitNode(e.operator):this.append(`->`),this.visitNode(e.values[t])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(` `)),this.append(`merge `),e.top&&(this.visitNode(e.top),this.append(` `)),this.append(`into `),this.visitNode(e.into),e.using&&(this.append(` `),this.visitNode(e.using)),e.whens&&(this.append(` `),this.compileList(e.whens,` `)),e.output&&(this.append(` `),this.visitNode(e.output)),e.endModifiers?.length&&(this.append(` `),this.compileList(e.endModifiers,` `))}visitMatched(e){e.not&&this.append(`not `),this.append(`matched`),e.bySource&&this.append(` by source`)}visitAddIndex(e){this.append(`add `),e.unique&&this.append(`unique `),this.append(`index `),this.visitNode(e.name),e.columns&&(this.append(` (`),this.compileList(e.columns),this.append(`)`)),e.using&&(this.append(` using `),this.visitNode(e.using))}visitCast(e){this.append(`cast(`),this.visitNode(e.expression),this.append(` as `),this.visitNode(e.dataType),this.append(`)`)}visitFetch(e){this.append(`fetch next `),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append(`output `),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}append(e){this.#sql+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return`"`}getRightIdentifierWrapper(){return`"`}getCurrentParameterPlaceholder(){return`$`+this.numParameters}getLeftExplainOptionsWrapper(){return`(`}getExplainOptionAssignment(){return` `}getExplainOptionsDelimiter(){return`, `}getRightExplainOptionsWrapper(){return`)`}sanitizeIdentifier(e){let t=this.getLeftIdentifierWrapper(),n=this.getRightIdentifierWrapper(),r=``;for(let i of e)r+=i,i===t?r+=t:i===n&&(r+=n);return r}addParameter(e){this.#parameters.push(e)}appendImmediateValue(e){if(E(e))this.append(`'${e}'`);else if(ws(e)||Ts(e))this.append(e.toString());else if(Es(e))this.append(`null`);else if(Ds(e))this.appendImmediateValue(e.toISOString());else if(Os(e))this.appendImmediateValue(e.toString());else throw Error(`invalid immediate value ${e}`)}sortSelectModifiers(e){return e.sort((e,t)=>e.modifier&&t.modifier?Af[e.modifier]-Af[t.modifier]:1),O(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}};const kf=O({ForKeyShare:`for key share`,ForNoKeyUpdate:`for no key update`,ForUpdate:`for update`,ForShare:`for share`,NoWait:`nowait`,SkipLocked:`skip locked`,Distinct:`distinct`}),Af=O({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),jf=O({InnerJoin:`inner join`,LeftJoin:`left join`,RightJoin:`right join`,FullJoin:`full join`,LateralInnerJoin:`inner join lateral`,LateralLeftJoin:`left join lateral`,Using:`using`});var Mf=class{async init(){}async acquireConnection(){return new Nf}async beginTransaction(){}async commitTransaction(){}async rollbackTransaction(){}async releaseConnection(){}async destroy(){}},Nf=class{async executeQuery(){return{rows:[]}}async*streamQuery(){}},Pf=class{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}};O({__noMigrations__:!0});const Ff=/"/g;var If=class extends Of{sanitizeIdentifier(e){return e.replace(Ff,`""`)}},Lf=class{#db;constructor(e){this.#db=e}async getSchemas(){return(await this.#db.selectFrom(`pg_catalog.pg_namespace`).select(`nspname`).$castTo().execute()).map(e=>({name:e.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#db.selectFrom(`pg_catalog.pg_attribute as a`).innerJoin(`pg_catalog.pg_class as c`,`a.attrelid`,`c.oid`).innerJoin(`pg_catalog.pg_namespace as ns`,`c.relnamespace`,`ns.oid`).innerJoin(`pg_catalog.pg_type as typ`,`a.atttypid`,`typ.oid`).innerJoin(`pg_catalog.pg_namespace as dtns`,`typ.typnamespace`,`dtns.oid`).select([`a.attname as column`,`a.attnotnull as not_null`,`a.atthasdef as has_default`,`c.relname as table`,`c.relkind as table_type`,`ns.nspname as schema`,`typ.typname as type`,`dtns.nspname as type_schema`,Tf`col_description(a.attrelid, a.attnum)`.as(`column_description`),this.#db.selectFrom(`pg_class`).select(Tf`true`.as(`auto_incrementing`)).whereRef(`relnamespace`,`=`,`c.relnamespace`).where(`relkind`,`=`,`S`).where(`relname`,`=`,Tf`c.relname || '_' || a.attname || '_seq'`).as(`auto_incrementing`)]).where(e=>e.or([e(`c.relkind`,`=`,`r`),e(`c.relkind`,`=`,`v`),e(`c.relkind`,`=`,`p`)])).where(`ns.nspname`,`!~`,`^pg_`).where(`ns.nspname`,`!=`,`information_schema`).where(`a.attnum`,`>=`,0).where(`a.attisdropped`,`!=`,!0).orderBy(`ns.nspname`).orderBy(`c.relname`).orderBy(`a.attnum`).$castTo();e.withInternalKyselyTables||(t=t.where(`c.relname`,`!=`,`kysely_migration`).where(`c.relname`,`!=`,`kysely_migration_lock`));let n=await t.execute();return this.#parseTableMetadata(n)}async getMetadata(e){return{tables:await this.getTables(e)}}#parseTableMetadata(e){return e.reduce((e,t)=>{let n=e.find(e=>e.name===t.table&&e.schema===t.schema);return n||(n=O({name:t.table,isView:t.table_type===`v`,schema:t.schema,columns:[]}),e.push(n)),n.columns.push(O({name:t.column,dataType:t.type,dataTypeSchema:t.type_schema,isNullable:!t.not_null,isAutoIncrementing:!!t.auto_incrementing,hasDefaultValue:t.has_default,comment:t.column_description??void 0})),e},[])}};const Rf=BigInt(`3853314791062309107`);var zf=class extends Pf{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e,t){await Tf`select pg_advisory_xact_lock(${Tf.lit(Rf)})`.execute(e)}async releaseMigrationLock(e,t){}};const Bf=()=>new gf({dialect:{createAdapter:()=>new zf,createDriver:()=>new Mf,createIntrospector:e=>new Lf(e),createQueryCompiler:()=>new If}});async function Vf(e,t){let n=Bf(),r={exec:async t=>await e.client.exec(t.sql,t.parameters)};return await t({...e,db:n,client:r})}mo(`stepChain`,ho.type({user:ho.object({name:ho.object({first:ho.string(),last:ho.string()}),activatedAt:ho.datetime({optional:!0})})}),{defaults:{dbNamespace:`tailordb`}}).fnStep(`step1`,e=>`step1: Hello ${e.input.user.name.first} ${e.input.user.name.last} on step1!`).fnStep(`step2`,async()=>`step2: recorded ${xs(new Date,`yyyy-MM-dd HH:mm:ss`)} on step2!`).fnStep(`sqlStep`,async e=>{let t=await e.client.execOne(`SELECT name FROM User ORDER BY createdAt DESC`);return t?t.name:`no user found`}).fnStep(`kyselyStep`,e=>Vf(e,async e=>{let t=e.db.selectFrom(`Supplier`).select([`state`]).compile();return(await e.client.exec(t)).map(e=>e.state).join(`, `)})).returns(e=>({result:{summary:[e.step1,e.step2,e.sqlStep,e.kyselyStep]}}),ho.type({result:ho.object({summary:ho.string({array:!0})})}));const Hf=e=>`step1: Hello ${e.input.user.name.first} ${e.input.user.name.last} on step1!`,Uf=async e=>{let t=e?new tailordb.Client({namespace:e}):{connect:()=>{},end:()=>{}};await t.connect();let n={async exec(e,n){return(await t.queryObject(e,n??[])).rows},async execOne(e,n){return(await t.queryObject(e,n??[])).rows[0]}};return{...n,async transaction(e){try{await n.exec(`BEGIN`);let t=await e(n);return await n.exec(`COMMIT`),t}catch(e){console.error(`Transaction failed:`,e);try{await n.exec(`ROLLBACK`)}catch(e){console.error(`Failed to rollback transaction:`,e)}}},async end(){try{await t.end()}catch(e){console.error(`Error ending connection:`,e)}}}};globalThis.main=await(async(e,t)=>async n=>{let r=await Uf(e);try{return await t({...n,client:r})}finally{await r.end()}})(`tailordb`,Hf);
//# sourceMappingURL=stepChain__step1.js.map