{"version":3,"file":"stepChain__sqlStep.js","names":["e"],"sources":["../resolvers/stepChain.transformed.js","../steps/stepChain__sqlStep.js"],"sourcesContent":["import { format } from \"date-fns\";\nimport { DummyDriver, Kysely, PostgresAdapter, PostgresIntrospector, PostgresQueryCompiler } from \"kysely\";\n\n//#region generated/tailordb.ts\nconst getDB = () => {\n\treturn new Kysely({ dialect: {\n\t\tcreateAdapter: () => new PostgresAdapter(),\n\t\tcreateDriver: () => new DummyDriver(),\n\t\tcreateIntrospector: (db) => new PostgresIntrospector(db),\n\t\tcreateQueryCompiler: () => new PostgresQueryCompiler()\n\t} });\n};\nasync function kyselyWrapper(context, callback) {\n\tconst db = getDB();\n\tconst clientWrapper = { exec: async (query) => {\n\t\treturn await context.client.exec(query.sql);\n\t} };\n\treturn await callback({\n\t\t...context,\n\t\tdb,\n\t\tclient: clientWrapper\n\t});\n}\n\n//#endregion\n//#region resolvers/stepChain/resolver.ts\n\n//#endregion\n\nexport const $tailor_resolver_step__step1 = context=>{return`step1: Hello ${context.input.user.name.first} ${context.input.user.name.last} on step1!`};\nexport const $tailor_resolver_step__step2 = async()=>{return`step2: recorded ${format(new Date,\"yyyy-MM-dd HH:mm:ss\")} on step2!`};\nexport const $tailor_resolver_step__sqlStep = async context=>{const result=await context.client.execOne(`SELECT name FROM User ORDER BY createdAt DESC`);return result?result.name:\"no user found\"};\nexport const $tailor_resolver_step__kyselyStep = context=>kyselyWrapper(context,async context2=>{const query=context2.db.selectFrom(\"Supplier\").select([\"state\"]).compile();return(await context2.client.exec(query)).map(r=>r.state).join(\", \")});\n","import { $tailor_resolver_step__sqlStep } from \"../resolvers/stepChain.transformed.js\";\n\nconst $connect_tailordb = async (namespace) => {\n  const baseClient = namespace ? new tailordb.Client({ namespace }) : { connect: () => {}, end: () => {} };\n  await baseClient.connect();\n\n  const client = {\n    async exec(query) {\n      const result = await baseClient.queryObject(query);\n      return result.rows;\n    },\n    async execOne(query) {\n      const result = await baseClient.queryObject(query);\n      return result.rows[0];\n    },\n  };\n  return {\n    ...client,\n    async transaction(callback) {\n      try {\n        await client.exec(\"BEGIN\");\n        const result = await callback(client);\n        await client.exec(\"COMMIT\");\n        return result;\n      } catch (e) {\n        console.error(\"Transaction failed:\", e);\n        try {\n          await client.exec(\"ROLLBACK\");\n        } catch (e) {\n          console.error(\"Failed to rollback transaction:\", e);\n        }\n      }\n    },\n    async end() {\n      try {\n        await baseClient.end();\n      } catch (e) {\n        console.error(\"Error ending connection:\", e);\n      }\n    }\n  };\n};\n\nconst $tailor_db_wrapper = async (namespace, fn) => {\n  return async (args) => {\n    const client = await $connect_tailordb(namespace);\n    try {\n      return await fn({ ...args, client });\n    } finally {\n      await client.end();\n    }\n  };\n};\nglobalThis.main = await $tailor_db_wrapper(\"tailordb\", $tailor_resolver_step__sqlStep);"],"mappings":"AA+BA,MAAa,EAAiC,MAAM,GAAS,CAAC,IAAM,EAAO,KAAM,GAAQ,OAAO,QAAA,gDAAwD,CAAC,OAAO,EAAO,EAAO,KAAK,eAAgB,EC7B7L,EAAoB,MAAO,GAAc,CAC7C,IAAM,EAAa,EAAY,IAAI,SAAS,OAAO,CAAE,WAAW,GAAI,CAAE,QAAS,IAAM,CAAE,EAAE,IAAK,IAAM,CAAE,CAAE,EACxG,KAAM,GAAW,SAAS,CAE1B,IAAM,EAAS,CACb,MAAM,KAAK,EAAO,CAChB,IAAM,EAAS,KAAM,GAAW,YAAY,EAAM,CAClD,OAAO,EAAO,IACf,EACD,MAAM,QAAQ,EAAO,CACnB,IAAM,EAAS,KAAM,GAAW,YAAY,EAAM,CAClD,OAAO,EAAO,KAAK,EACpB,CACF,EACD,MAAO,CACL,GAAG,EACH,MAAM,YAAY,EAAU,CAC1B,GAAI,CACF,KAAM,GAAO,KAAK,QAAQ,CAC1B,IAAM,EAAS,KAAM,GAAS,EAAO,CAErC,OADA,KAAM,GAAO,KAAK,SAAS,CACpB,CACR,OAAQ,EAAG,CACV,QAAQ,MAAM,sBAAuB,EAAE,CACvC,GAAI,CACF,KAAM,GAAO,KAAK,WAAW,AAC9B,OAAQA,EAAG,CACV,QAAQ,MAAM,kCAAmCA,EAAE,AACpD,CACF,CACF,EACD,MAAM,KAAM,CACV,GAAI,CACF,KAAM,GAAW,KAAK,AACvB,OAAQ,EAAG,CACV,QAAQ,MAAM,2BAA4B,EAAE,AAC7C,CACF,CACF,CACF,EAEK,EAAqB,MAAO,EAAW,IACpC,MAAO,GAAS,CACrB,IAAM,EAAS,KAAM,GAAkB,EAAU,CACjD,GAAI,CACF,OAAO,KAAM,GAAG,CAAE,GAAG,EAAM,QAAQ,EAAC,AACrC,QAAS,CACR,KAAM,GAAO,KAAK,AACnB,CACF,EAEH,WAAW,KAAO,KAAM,GAAmB,WAAY,EAA+B"}