name: Tailor Init Smoke

on:
  pull_request:
    paths:
      - .github/workflows/init-smoke.yml
      - packages/tailor-sdk/**
      - pnpm-lock.yaml
      - package.json
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: false

jobs:
  init-smoke:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0
        with:
          persist-credentials: false

      - name: Install deps
        uses: ./.github/actions/install-deps

      - name: Show CLI version
        run: npx --yes tailor-sdk --version

      - name: Run init non-interactively
        run: |
          # Create into a temp folder under repo root so local bin is used
          npx tailor-sdk init tmp-init-app --template hello-world
          ls -la tmp-init-app

      - name: Verify generated files
        run: |
          test -f tmp-init-app/tailor.config.ts
          test -f tmp-init-app/package.json
          test -f tmp-init-app/tsconfig.json
          test -f tmp-init-app/src/resolvers/hello.ts
